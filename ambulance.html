<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ambulance Dispatch ¬∑ Lifecycle</title>

    <!-- Tailwind (clinical‚Äëfocused config) -->
    <script>
        // Suppress Tailwind CDN production warning (this is intentional for local use)
        const _origWarn = console.warn.bind(console);
        console.warn = (...args) => {
            if (typeof args[0] === 'string' && args[0].includes('cdn.tailwindcss.com')) return;
            _origWarn(...args);
        };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        slate: {
                            850: '#1e293b',
                            900: '#0f172a',
                            950: '#0a0e1a',
                        },
                        clinical: {
                            blue: '#2563eb',
                            red: '#dc2626',
                            green: '#16a34a',
                            amber: '#d97706',
                            gray: '#6b7280',
                        }
                    },
                    backgroundImage: {
                        'grid-subtle': 'linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px)',
                    }
                }
            }
        }
    </script>

    <!-- Fonts + Icons -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Leaflet Core -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-rotatedmarker@0.2.0/leaflet.rotatedMarker.js"></script>

    <style>
        /* ---------- CLINICAL GRADE ‚Äì CLEAN, PROFESSIONAL ---------- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0e1a;
            background-image: radial-gradient(circle at 20% 30%, rgba(37, 99, 235, 0.02) 0%, transparent 30%),
                radial-gradient(circle at 80% 70%, rgba(22, 163, 74, 0.02) 0%, transparent 40%);
            background-attachment: fixed;
        }

        /* ----- Custom Scrollbar (subtle) ----- */
        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }

        /* ----- Clinical Panel ‚Äì clean glass ----- */
        .clinical-panel {
            background: rgba(15, 23, 42, 0.75);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 20px -8px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }

        .clinical-panel:hover {
            border-color: rgba(37, 99, 235, 0.3);
            box-shadow: 0 12px 24px -10px rgba(37, 99, 235, 0.2);
        }

        /* ----- Input ‚Äì clean, no glow ----- */
        .input-clinical {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: 2px solid rgba(37, 99, 235, 0.5);
            transition: all 0.2s ease;
            color: #fff;
        }

        .input-clinical:focus {
            border-color: #2563eb;
            border-bottom-width: 2px;
            box-shadow: 0 4px 12px -6px #2563eb;
            outline: none;
            background: rgba(15, 23, 42, 0.8);
        }

        /* ----- Buttons ----- */
        .btn-clinical {
            background: #2563eb;
            color: white;
            font-weight: 500;
            padding: 0.625rem 1.25rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-clinical:hover {
            background: #1d4ed8;
        }

        .btn-clinical-outline {
            background: rgba(37, 99, 235, 0.1);
            color: #2563eb;
            border: 1px solid rgba(37, 99, 235, 0.3);
        }

        .btn-clinical-outline:hover {
            background: #2563eb;
            color: white;
        }

        /* ----- Digital Clock ----- */
        .clinical-clock {
            font-family: 'JetBrains Mono', monospace;
            color: #e2e8f0;
        }

        /* ----- Table Styling (dark, clinical) ----- */
        #resultsTable {
            width: 100%;
            border-collapse: collapse;
        }

        #resultsTable th {
            background: rgba(2, 6, 23, 0.7);
            color: #94a3b8;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.75rem 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        #resultsTable td {
            padding: 0.75rem 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            color: #e2e8f0;
            font-size: 0.8rem;
        }

        #resultsTable tbody tr:hover {
            background: rgba(37, 99, 235, 0.06);
        }

        .rank-1 {
            background: rgba(22, 163, 74, 0.1);
            border-left: 3px solid #16a34a;
        }

        /* ----- Map container ‚Äì original OSM light theme ----- */
        #map {
            border-radius: 0.5rem;
            background: #f8fafc;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ----- Lifecycle view containers ----- */
        .lifecycle-view {
            margin-top: 1.5rem;
        }

        /* ----- Status badge ----- */
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: rgba(37, 99, 235, 0.1);
            color: #2563eb;
            border: 1px solid rgba(37, 99, 235, 0.3);
        }

        /* ----- AI Triage Upload Widget ----- */
        .triage-upload-bar {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.6rem 0.75rem;
            background: rgba(37, 99, 235, 0.06);
            border: 1px dashed rgba(37, 99, 235, 0.35);
            border-radius: 0.6rem;
        }

        .triage-upload-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.9rem;
            background: rgba(37, 99, 235, 0.15);
            border: 1px solid rgba(37, 99, 235, 0.4);
            border-radius: 0.5rem;
            color: #93c5fd;
            font-size: 0.72rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.15s, color 0.15s;
            white-space: nowrap;
        }

        .triage-upload-btn:hover {
            background: rgba(37, 99, 235, 0.3);
            color: #fff;
        }

        .triage-status-text {
            font-size: 0.7rem;
            color: #94a3b8;
            font-family: monospace;
            flex: 1;
        }

        .triage-badge {
            padding: 0.2rem 0.65rem;
            border-radius: 9999px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .triage-badge.triage-red {
            background: rgba(220, 38, 38, 0.2);
            color: #f87171;
            border: 1px solid rgba(220, 38, 38, 0.4);
        }

        .triage-badge.triage-yellow {
            background: rgba(234, 179, 8, 0.2);
            color: #fcd34d;
            border: 1px solid rgba(234, 179, 8, 0.4);
        }

        .triage-badge.triage-green {
            background: rgba(22, 163, 74, 0.2);
            color: #4ade80;
            border: 1px solid rgba(22, 163, 74, 0.4);
        }

        /* ----- Re-Evaluation Modal Overlay ----- */

        .reeval-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .reeval-card {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.97) 0%, rgba(10, 14, 26, 0.97) 100%);
            border: 1px solid rgba(37, 99, 235, 0.4);
            border-top: 3px solid #2563eb;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 420px;
            width: 100%;
            box-shadow: 0 25px 60px -10px rgba(0, 0, 0, 0.6), 0 0 40px -10px rgba(37, 99, 235, 0.3);
            animation: slideInUp 0.25s ease;
        }

        .reroute-card {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.97) 0%, rgba(10, 14, 26, 0.97) 100%);
            border: 1px solid rgba(22, 163, 74, 0.4);
            border-top: 3px solid #16a34a;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 440px;
            width: 100%;
            box-shadow: 0 25px 60px -10px rgba(0, 0, 0, 0.6), 0 0 40px -10px rgba(22, 163, 74, 0.3);
            animation: slideInUp 0.25s ease;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(24px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* ----- Reroute Flash Banner ----- */
        #reroute-banner {
            position: fixed;
            top: 72px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3000;
            background: linear-gradient(90deg, #16a34a 0%, #15803d 100%);
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            font-weight: 700;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 8px 30px -5px rgba(22, 163, 74, 0.6);
            letter-spacing: 0.03em;
            transition: background 1s ease, box-shadow 1s ease;
            white-space: nowrap;
        }

        #reroute-banner.banner-blue {
            background: linear-gradient(90deg, #2563eb 0%, #1d4ed8 100%);
            box-shadow: 0 8px 30px -5px rgba(37, 99, 235, 0.6);
        }

        /* ----- Severity Slider Display ----- */
        .severity-display {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            font-size: 1.5rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            border: 2px solid rgba(37, 99, 235, 0.5);
            background: rgba(37, 99, 235, 0.1);
            color: #2563eb;
            transition: all 0.2s;
        }

        /* ===== EMT ASSESSMENT FORM STYLES ===== */

        /* AVPU Consciousness buttons */
        .avpu-btn {
            flex: 1;
            padding: 0.6rem 0.25rem;
            border-radius: 0.5rem;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(15, 23, 42, 0.6);
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
        }

        .avpu-btn:hover {
            border-color: rgba(255, 255, 255, 0.3);
            color: #e2e8f0;
        }

        .avpu-btn.active-alert {
            background: rgba(22, 163, 74, 0.2);
            border-color: #16a34a;
            color: #4ade80;
        }

        .avpu-btn.active-verbal {
            background: rgba(234, 179, 8, 0.2);
            border-color: #ca8a04;
            color: #fcd34d;
        }

        .avpu-btn.active-pain {
            background: rgba(234, 88, 12, 0.2);
            border-color: #ea580c;
            color: #fb923c;
        }

        .avpu-btn.active-unresponsive {
            background: rgba(220, 38, 38, 0.2);
            border-color: #dc2626;
            color: #f87171;
        }

        /* Injury location / mechanism grid */
        .loc-btn,
        .moi-btn {
            padding: 0.5rem 0.4rem;
            border-radius: 0.5rem;
            font-size: 0.68rem;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(15, 23, 42, 0.5);
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
            line-height: 1.3;
        }

        .loc-btn:hover,
        .moi-btn:hover {
            border-color: rgba(37, 99, 235, 0.5);
            color: #93c5fd;
        }

        .loc-btn.selected {
            background: rgba(220, 38, 38, 0.2);
            border-color: #dc2626;
            color: #f87171;
        }

        .moi-btn.selected {
            background: rgba(37, 99, 235, 0.2);
            border-color: #2563eb;
            color: #93c5fd;
        }

        /* Bleeding toggle */
        .bleeding-toggle {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.85rem 1rem;
            border-radius: 0.6rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(15, 23, 42, 0.5);
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .bleeding-toggle.on {
            border-color: #dc2626;
            background: rgba(220, 38, 38, 0.12);
        }

        .bleeding-toggle .toggle-circle {
            width: 2.75rem;
            height: 1.5rem;
            border-radius: 9999px;
            background: rgba(255, 255, 255, 0.1);
            position: relative;
            transition: background 0.2s;
            flex-shrink: 0;
        }

        .bleeding-toggle.on .toggle-circle {
            background: #dc2626;
        }

        .bleeding-toggle .toggle-circle::after {
            content: '';
            position: absolute;
            top: 0.18rem;
            left: 0.18rem;
            width: 1.1rem;
            height: 1.1rem;
            border-radius: 50%;
            background: white;
            transition: transform 0.2s;
        }

        .bleeding-toggle.on .toggle-circle::after {
            transform: translateX(1.25rem);
        }

        /* Specialty chips */
        .specialty-chip {
            display: inline-block;
            padding: 0.25rem 0.65rem;
            border-radius: 9999px;
            font-size: 0.65rem;
            font-weight: 600;
            border: 1px solid rgba(37, 99, 235, 0.35);
            background: rgba(37, 99, 235, 0.1);
            color: #93c5fd;
            cursor: pointer;
            transition: all 0.15s;
        }

        .specialty-chip:hover {
            background: #2563eb;
            color: white;
        }

        /* ICU prominent toggle */
        .icu-toggle-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 0.6rem;
            border: 2px solid rgba(255, 255, 255, 0.08);
            background: rgba(15, 23, 42, 0.4);
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .icu-toggle-row:has(input:checked) {
            border-color: #dc2626;
            background: rgba(220, 38, 38, 0.08);
        }

        /* Severity slider track coloring */
        input[type=range].sev-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            outline: none;
            cursor: pointer;
            background: linear-gradient(to right,
                    #16a34a 0%, #16a34a 20%,
                    #65a30d 20%, #65a30d 40%,
                    #d97706 40%, #d97706 60%,
                    #ea580c 60%, #ea580c 80%,
                    #dc2626 80%, #dc2626 100%);
        }

        input[type=range].sev-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: white;
            border: 3px solid #2563eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }

        /* Section divider inside form */
        .form-section-hdr {
            font-size: 0.62rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #475569;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding-bottom: 0.4rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* AI scan button (prominent) */
        .ai-scan-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.6rem;
            border: 1px dashed rgba(37, 99, 235, 0.45);
            background: rgba(37, 99, 235, 0.08);
            color: #93c5fd;
            font-size: 0.82rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
        }

        .ai-scan-btn:hover {
            background: rgba(37, 99, 235, 0.2);
            border-color: #2563eb;
            color: white;
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Voice Language Pills ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .voice-lang-pills {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .voice-lang-pills .pill-label {
            font-size: 0.68rem;
            color: #64748b;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .voice-lang-pill {
            padding: 5px 14px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(15, 23, 42, 0.6);
            color: #94a3b8;
            font-size: 0.72rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .voice-lang-pill:hover {
            border-color: rgba(37, 99, 235, 0.5);
            color: #e2e8f0;
        }

        .voice-lang-pill.active {
            background: rgba(37, 99, 235, 0.2);
            border-color: #2563eb;
            color: #60a5fa;
        }

        .voice-rerecord-btn {
            display: none;
            align-items: center;
            gap: 5px;
            margin-top: 0.5rem;
            padding: 5px 14px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(15, 23, 42, 0.5);
            color: #94a3b8;
            font-size: 0.72rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .voice-rerecord-btn:hover {
            border-color: rgba(37, 99, 235, 0.5);
            color: #e2e8f0;
        }

        .voice-rerecord-btn.show {
            display: inline-flex;
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Voice Incident Reporter ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .voice-panel {
            background: rgba(15, 23, 42, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 1rem;
            overflow: hidden;
            backdrop-filter: blur(8px);
        }

        .voice-mic-btn {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            border: 3px solid rgba(37, 99, 235, 0.5);
            background: radial-gradient(circle, rgba(37, 99, 235, 0.15) 0%, transparent 70%);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            outline: none;
        }

        .voice-mic-btn i {
            font-size: 1.5rem;
            color: #60a5fa;
            transition: color 0.3s;
        }

        .voice-mic-btn:hover {
            border-color: #2563eb;
            background: radial-gradient(circle, rgba(37, 99, 235, 0.25) 0%, transparent 70%);
            box-shadow: 0 0 24px rgba(37, 99, 235, 0.25);
        }

        .voice-mic-btn.recording {
            border-color: #dc2626;
            background: radial-gradient(circle, rgba(220, 38, 38, 0.2) 0%, transparent 70%);
            animation: micPulse 1.5s ease-in-out infinite;
        }

        .voice-mic-btn.recording i {
            color: #f87171;
        }

        .voice-mic-btn.processing {
            border-color: #d97706;
            pointer-events: none;
        }

        .voice-mic-btn.processing i {
            color: #fbbf24;
            animation: spin 1s linear infinite;
        }

        @keyframes micPulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.5);
            }

            50% {
                box-shadow: 0 0 0 14px rgba(220, 38, 38, 0);
            }
        }

        @keyframes voiceSpin {
            to {
                transform: rotate(360deg);
            }
        }

        .voice-ring {
            position: absolute;
            inset: -6px;
            border-radius: 50%;
            border: 2px solid transparent;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .voice-mic-btn.recording .voice-ring {
            opacity: 1;
            border-color: rgba(220, 38, 38, 0.3);
            animation: ringExpand 2s ease-out infinite;
        }

        @keyframes ringExpand {
            0% {
                transform: scale(1);
                opacity: 0.6;
            }

            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        .voice-status {
            font-size: 0.75rem;
            color: #94a3b8;
            text-align: center;
            margin-top: 0.5rem;
            min-height: 1.2rem;
            transition: color 0.3s;
        }

        .voice-status.recording {
            color: #f87171;
        }

        .voice-status.success {
            color: #4ade80;
        }

        .voice-status.error {
            color: #fb923c;
        }

        .voice-transcript {
            margin-top: 0.75rem;
            padding: 0.75rem 1rem;
            background: rgba(2, 6, 23, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 0.5rem;
            font-size: 0.8rem;
            color: #cbd5e1;
            line-height: 1.5;
            min-height: 2.4rem;
            max-height: 6rem;
            overflow-y: auto;
            font-style: italic;
            display: none;
        }

        .voice-transcript.visible {
            display: block;
            animation: fadeInVoice 0.2s ease-out;
        }

        @keyframes fadeInVoice {
            from {
                opacity: 0;
                transform: translateY(4px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .voice-preview {
            display: none;
            margin-top: 0.75rem;
            gap: 0.5rem;
        }

        .voice-preview.visible {
            display: grid;
            grid-template-columns: 1fr 1fr;
            animation: fadeInVoice 0.3s ease-out;
        }

        .voice-chip {
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            background: rgba(2, 6, 23, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .voice-chip-label {
            font-size: 0.6rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .voice-chip-value {
            font-size: 0.85rem;
            font-weight: 600;
            color: #e2e8f0;
            font-family: 'JetBrains Mono', monospace;
        }

        .voice-chip-value.sev-high {
            color: #f87171;
        }

        .voice-chip-value.sev-med {
            color: #fbbf24;
        }

        .voice-chip-value.sev-low {
            color: #4ade80;
        }

        .voice-confirm-btn {
            grid-column: 1 / -1;
            margin-top: 0.25rem;
            padding: 0.625rem;
            border-radius: 0.5rem;
            border: none;
            background: linear-gradient(135deg, #16a34a, #15803d);
            color: white;
            font-weight: 600;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .voice-confirm-btn:hover {
            filter: brightness(1.1);
            box-shadow: 0 4px 16px rgba(22, 163, 74, 0.3);
        }

        .voice-divider {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin: 0.75rem 0;
            font-size: 0.65rem;
            color: #475569;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .voice-divider::before,
        .voice-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.06);
        }

        .voice-unsupported {
            text-align: center;
            padding: 1rem;
            font-size: 0.75rem;
            color: #fb923c;
            display: none;
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Language Switcher ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .lang-switcher {
            position: relative;
            display: inline-flex;
            align-items: center;
        }

        .lang-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 5px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(15, 23, 42, 0.7);
            color: #94a3b8;
            font-size: 0.72rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(4px);
        }

        .lang-btn:hover {
            border-color: rgba(37, 99, 235, 0.5);
            color: #e2e8f0;
        }

        .lang-btn i {
            font-size: 0.85rem;
        }

        .lang-dropdown {
            position: absolute;
            top: calc(100% + 6px);
            right: 0;
            min-width: 160px;
            background: rgba(15, 23, 42, 0.97);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 4px;
            z-index: 9999;
            display: none;
            box-shadow: 0 12px 36px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(12px);
        }

        .lang-dropdown.open {
            display: block;
            animation: fadeInVoice 0.15s ease-out;
        }

        .lang-opt {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 7px;
            cursor: pointer;
            transition: background 0.15s;
            font-size: 0.78rem;
            color: #cbd5e1;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .lang-opt:hover {
            background: rgba(37, 99, 235, 0.12);
            color: #fff;
        }

        .lang-opt.active {
            background: rgba(37, 99, 235, 0.2);
            color: #60a5fa;
        }

        .lang-opt .lang-flag {
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .lang-opt .lang-name {
            flex: 1;
        }

        .lang-opt .lang-native {
            font-size: 0.65rem;
            color: #64748b;
        }

        /* RTL support for Urdu */
        [dir="rtl"] .lang-dropdown {
            left: 0;
            right: auto;
        }

        [dir="rtl"] .flex {
            direction: rtl;
        }

        [dir="rtl"] input,
        [dir="rtl"] select,
        [dir="rtl"] button {
            text-align: right;
        }
    </style>
</head>

<body
    class="bg-slate-950 text-slate-200 font-sans antialiased min-h-screen flex flex-col relative bg-grid-subtle selection:bg-clinical-blue/30">

    <!-- ========== HEADER ‚Äì CLEAN CLINICAL (NO BEDS/ICU) ========= -->
    <header class="h-16 border-b border-white/5 bg-slate-950/90 backdrop-blur sticky top-0 z-50 flex-none shadow-md">
        <div class="max-w-7xl mx-auto px-4 h-full flex items-center justify-between">
            <!-- Left: Brand & Status -->
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 bg-clinical-blue/20 rounded-lg flex items-center justify-center border border-clinical-blue/30">
                    <i class="fa-solid fa-ambulance text-clinical-blue text-xl"></i>
                </div>
                <div>
                    <h1 class="text-lg font-semibold tracking-wide text-white flex items-center gap-2">
                        Ambulance Dispatch Interface
                        <span
                            class="text-[10px] font-mono bg-slate-800 px-2 py-0.5 rounded-full text-clinical-blue border border-clinical-blue/30">v2.0</span>
                    </h1>
                    <div class="flex items-center gap-3 text-[10px] font-mono text-slate-400">
                        <span class="flex items-center gap-1">
                            <span class="w-1.5 h-1.5 bg-clinical-green rounded-full"></span>
                            SYSTEM ONLINE
                        </span>
                        <span class="text-slate-600">|</span>
                        <span class="flex items-center gap-1">
                            <i class="fa-solid fa-heart-pulse text-clinical-blue"></i> EMS READY
                        </span>
                    </div>
                </div>
            </div>

            <!-- Right: Language + Clock -->
            <div class="flex items-center gap-4">
                <!-- Language Switcher -->
                <div class="lang-switcher" id="langSwitcher">
                    <button class="lang-btn" onclick="toggleLangDropdown()" id="langToggleBtn">
                        <i class="fa-solid fa-globe"></i>
                        <span id="currentLangLabel">EN</span>
                        <i class="fa-solid fa-chevron-down" style="font-size:0.55rem;opacity:0.5"></i>
                    </button>
                    <div class="lang-dropdown" id="langDropdown">
                        <button class="lang-opt active" onclick="switchLang('en')">
                            <span class="lang-flag">üá¨üáß</span>
                            <span class="lang-name">English</span>
                        </button>
                        <button class="lang-opt" onclick="switchLang('te')">
                            <span class="lang-flag">üáÆüá≥</span>
                            <span class="lang-name">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</span>
                            <span class="lang-native">Telugu</span>
                        </button>
                        <button class="lang-opt" onclick="switchLang('hi')">
                            <span class="lang-flag">üáÆüá≥</span>
                            <span class="lang-name">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</span>
                            <span class="lang-native">Hindi</span>
                        </button>
                        <button class="lang-opt" onclick="switchLang('ur')">
                            <span class="lang-flag">üáµüá∞</span>
                            <span class="lang-name">ÿßÿ±ÿØŸà</span>
                            <span class="lang-native">Urdu</span>
                        </button>
                    </div>
                </div>
                <!-- Clock -->
                <div class="flex flex-col items-end">
                    <p class="text-xl font-mono text-white clinical-clock" id="clock">00:00:00</p>
                    <p class="text-[9px] text-slate-500 font-mono uppercase" data-i18n="local_time">LOCAL TIME</p>
                </div>
            </div>
        </div>
    </header>

    <!-- ========== NAVIGATION OVERLAY (Floating) ========= -->
    <div id="nav-panel"
        class="hidden fixed top-20 left-1/2 -translate-x-1/2 z-[1000] bg-slate-900/90 backdrop-blur border border-clinical-blue/30 rounded-xl p-4 shadow-2xl flex flex-col items-center min-w-[240px] transition-all duration-300">
        <div class="text-[10px] text-clinical-blue uppercase tracking-widest font-bold mb-2 flex items-center gap-2">
            <span class="w-1.5 h-1.5 bg-clinical-blue rounded-full animate-pulse"></span>
            LIVE NAVIGATION
        </div>
        <div class="flex items-center gap-6 w-full justify-between px-2">
            <div class="text-center">
                <div id="nav-eta" class="text-2xl font-mono font-bold text-white">--</div>
                <div class="text-[9px] text-slate-500 font-bold tracking-wider mt-1">MIN</div>
            </div>
            <div class="h-8 w-px bg-white/10"></div>
            <div class="text-center">
                <div id="nav-dist" class="text-2xl font-mono font-bold text-clinical-blue">--</div>
                <div class="text-[9px] text-slate-500 font-bold tracking-wider mt-1">KM</div>
            </div>
        </div>
        <div id="nav-instruction"
            class="mt-3 text-xs text-center text-slate-300 border-t border-white/10 pt-2 w-full font-mono">
            Calculating route...
        </div>
    </div>

    <main class="flex-1 overflow-y-auto p-4 sm:p-6 scroll-smooth relative z-20">
        <div class="max-w-6xl mx-auto relative z-20">

            <!-- ========== LOGIN SECTION ‚Äì CLINICAL ========= -->
            <div id="loginSection" class="max-w-md mx-auto mt-10">
                <div class="clinical-panel rounded-2xl overflow-hidden shadow-xl">
                    <div class="bg-slate-900/80 p-8 text-center border-b border-white/5">
                        <div
                            class="w-20 h-20 mx-auto bg-slate-800 rounded-full flex items-center justify-center mb-4 border border-clinical-blue/30">
                            <i class="fa-solid fa-user-astronaut text-3xl text-clinical-blue"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-white" data-i18n="ambulance_login">Ambulance Login</h2>
                        <p class="text-slate-400 text-xs mt-1 font-mono" data-i18n="enter_credentials">Enter credentials
                            to access dispatch</p>
                    </div>

                    <div class="p-8 space-y-5">
                        <div class="space-y-1">
                            <label
                                class="text-[10px] font-medium text-slate-400 uppercase tracking-wide ml-1 flex items-center gap-1">
                                <i class="fa-solid fa-id-card"></i> Username
                            </label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-slate-500"><i
                                        class="fa-solid fa-id-badge"></i></span>
                                <input type="text" id="loginUsername" placeholder="Enter Username"
                                    class="input-clinical w-full pl-9 pr-4 py-2.5 rounded-lg text-white placeholder-slate-600 font-mono text-sm">
                            </div>
                        </div>

                        <div class="space-y-1">
                            <label
                                class="text-[10px] font-medium text-slate-400 uppercase tracking-wide ml-1 flex items-center gap-1">
                                <i class="fa-solid fa-shield-halbed"></i> Password
                            </label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-slate-500"><i
                                        class="fa-solid fa-key"></i></span>
                                <input type="password" id="loginPassword" placeholder="Enter Password"
                                    class="input-clinical w-full pl-9 pr-4 py-2.5 rounded-lg text-white placeholder-slate-600 font-mono">
                            </div>
                        </div>

                        <button onclick="handleLogin()" class="btn-clinical w-full shadow-md">
                            <span data-i18n="login">Login</span>
                            <i class="fa-solid fa-arrow-right"></i>
                        </button>

                        <div id="loginMessage" class="text-center text-xs font-mono min-h-[24px]"></div>

                        <div id="registerPrompt" class="hidden pt-4 border-t border-white/10 text-center">
                            <button onclick="showRegister()"
                                class="text-slate-400 hover:text-clinical-blue text-xs transition-colors flex items-center justify-center gap-2 mx-auto">
                                <i class="fa-solid fa-plus-circle"></i> Register New Ambulance
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== REGISTER SECTION ‚Äì CLINICAL ========= -->
            <div id="registerSection" class="hidden max-w-lg mx-auto mt-10">
                <div class="clinical-panel rounded-2xl overflow-hidden border-l-4 border-l-clinical-blue">
                    <div class="p-5 border-b border-white/5 flex justify-between items-center bg-slate-900/50">
                        <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                            <i class="fa-solid fa-truck-medical text-clinical-blue"></i> Register Ambulance
                        </h2>
                        <button onclick="showSection('loginSection')"
                            class="text-slate-400 hover:text-white transition-colors">
                            <i class="fa-solid fa-xmark text-xl"></i>
                        </button>
                    </div>

                    <form id="registerForm" onsubmit="handleRegister(event)" class="p-6 space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1">
                                <label class="text-[10px] font-medium text-slate-400 uppercase">Username</label>
                                <input type="text" name="username" required
                                    class="input-clinical w-full p-2.5 rounded text-sm">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-medium text-slate-400 uppercase">Password</label>
                                <input type="password" name="password" required
                                    class="input-clinical w-full p-2.5 rounded text-sm">
                            </div>
                        </div>

                        <div class="space-y-1">
                            <label class="text-[10px] font-medium text-slate-400 uppercase">Registration Number</label>
                            <input type="text" name="registration_number" placeholder="e.g., GVK EMRI" required
                                class="input-clinical w-full p-2.5 rounded text-sm font-mono">
                        </div>

                        <div class="space-y-1">
                            <label class="text-[10px] font-medium text-slate-400 uppercase">Organization</label>
                            <input type="text" name="organization" placeholder="e.g., GVK EMRI" required
                                class="input-clinical w-full p-2.5 rounded text-sm">
                        </div>

                        <div class="p-4 bg-slate-900/50 rounded-lg border border-white/5 space-y-3">
                            <div class="flex justify-between items-center">
                                <label class="text-[11px] font-medium text-clinical-blue uppercase tracking-wide">GPS
                                    Coordinates</label>
                                <button type="button" onclick="fillRegisterLocation()"
                                    class="text-xs bg-clinical-blue/10 text-clinical-blue hover:bg-clinical-blue hover:text-white px-3 py-1.5 rounded transition-colors border border-clinical-blue/30 flex items-center gap-1">
                                    <i class="fa-solid fa-satellite-dish"></i> Auto‚ÄëFix
                                </button>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <input type="number" step="any" name="latitude" id="reg_lat" placeholder="Latitude"
                                    required class="input-clinical w-full p-2 rounded text-xs font-mono text-center">
                                <input type="number" step="any" name="longitude" id="reg_lng" placeholder="Longitude"
                                    required class="input-clinical w-full p-2 rounded text-xs font-mono text-center">
                            </div>
                        </div>

                        <button type="submit"
                            class="w-full bg-slate-700 hover:bg-clinical-blue text-white font-medium py-2.5 rounded-lg transition-colors flex justify-center items-center gap-2">
                            <i class="fa-solid fa-check-double"></i> Register & Login
                        </button>
                    </form>
                    <div id="registerMessage" class="px-6 pb-6 text-center text-xs font-mono text-clinical-blue"></div>
                </div>
            </div>

            <!-- ========== DASHBOARD SECTION ‚Äì LIFECYCLE, CLINICAL ========= -->
            <div id="dashboardSection" class="hidden space-y-6 pb-12">

                <!-- üöë ASSET IDENTITY CARD (ambulance ID & registration) -->
                <div class="clinical-panel p-5 rounded-xl flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex items-center gap-4 z-10 w-full md:w-auto">
                        <div
                            class="w-14 h-14 bg-slate-800/80 rounded-lg flex items-center justify-center border border-clinical-blue/40">
                            <i class="fa-solid fa-truck-medical text-2xl text-white"></i>
                        </div>
                        <div>
                            <div class="text-[10px] text-slate-400 uppercase tracking-wide font-medium">Registration /
                                Name</div>
                            <div class="text-2xl font-mono font-semibold text-white" id="displayRegNum">---</div>
                            <div class="text-xs text-slate-500 font-mono mt-1">ID: <span
                                    id="displayAmbulanceId">---</span></div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="status-badge" id="displayStatus">IDLE</span>
                        <button onclick="handleLogout()"
                            class="bg-slate-700 hover:bg-slate-600 text-white text-xs font-medium py-1.5 px-3 rounded-lg transition-colors flex items-center gap-1">
                            <i class="fa-solid fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>

                <!-- ‚ö† BREAKDOWN SIMULATION -->
                <div class="flex justify-end">
                    <button onclick="simulateBreakdown()"
                        class="text-xs text-clinical-red hover:text-white border border-clinical-red/30 hover:bg-clinical-red/20 px-3 py-1.5 rounded transition-colors flex items-center gap-1">
                        <i class="fa-solid fa-triangle-exclamation"></i> Simulate Breakdown
                    </button>
                </div>

                <!-- üÜï ACTIVE RESERVATION PANEL (Dynamic) -->
                <div id="reservation-info-panel"
                    class="hidden clinical-panel p-4 rounded-xl border-l-4 border-l-clinical-green bg-slate-900/40 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-5 pointer-events-none">
                        <i class="fa-solid fa-hospital-user text-6xl text-white"></i>
                    </div>
                    <div
                        class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 relative z-10">
                        <div>
                            <h4
                                class="text-xs font-semibold text-clinical-green uppercase tracking-wide mb-1 flex items-center gap-2">
                                <i class="fa-solid fa-bed-pulse"></i> Active Reservation
                            </h4>
                            <div class="text-lg text-white font-medium flex flex-wrap gap-x-4 gap-y-1">
                                <span id="res-hospital-name">---</span>
                                <span class="text-slate-500 text-sm font-normal">|</span>
                                <span id="res-bed-type"
                                    class="text-sm font-mono bg-slate-800 px-2 rounded text-slate-300 border border-slate-700">---</span>
                            </div>
                            <div class="text-xs text-slate-400 mt-1 font-mono">
                                ID: <span id="res-id">---</span>
                            </div>
                        </div>
                        <div class="text-right w-full sm:w-auto bg-slate-950/50 p-3 rounded-lg border border-white/5">
                            <div class="text-[10px] text-slate-500 uppercase font-medium">Expires In</div>
                            <div id="res-timer" class="text-xl font-mono text-clinical-amber font-bold">--:--</div>
                        </div>
                    </div>
                </div>

                <!-- ========== LIFECYCLE CONTAINER ========= -->
                <div id="lifecycleContainer" class="space-y-6">

                    <!-- STATE: EN_ROUTE_TO_PATIENT (SOS) -->
                    <div id="view-EN_ROUTE_TO_PATIENT"
                        class="lifecycle-view hidden clinical-panel rounded-xl overflow-hidden">
                        <div class="bg-slate-900/70 px-5 py-3 border-b border-white/5 mx-auto">
                            <h3 class="font-medium text-white flex items-center gap-2 text-sm animate-pulse">
                                <span class="w-2 h-2 bg-clinical-red rounded-full"></span>
                                EMERGENCY RESPONSE: EN ROUTE TO PATIENT
                            </h3>
                        </div>
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h4 class="text-lg font-bold text-white">Responding to SOS</h4>
                                    <p class="text-xs text-slate-400 font-mono">Request ID: <span
                                            id="sos-req-id">---</span></p>
                                </div>
                                <div class="text-right">
                                    <div class="text-clinical-red font-mono text-xl font-bold"><i
                                            class="fa-solid fa-truck-medical"></i></div>
                                </div>
                            </div>

                            <!-- Reusing Map Container logic? We need a map here. 
                                 The existing map div is in view-EN_ROUTE. 
                                 We can either move the map div out of views or duplicate/move it via JS.
                                 Simpler: Add a separate map container for this view or share one.
                                 Given the code structure, let's add a placeholder and we'll use the main 'map' if possible, 
                                 BUT 'map' id is used in view-EN_ROUTE. 
                                 I will rename the map in view-EN_ROUTE to 'map-hospital' and this one 'map-patient'? 
                                 Or better, genericize the map container.
                                 
                                 Actually, `initMap` looks for `map`. 
                                 If I have multiple divs with id='map', it breaks.
                                 I will ensure only one view is valid. 
                                 BUT checking `view-EN_ROUTE`:
                                 <div id="map" class="w-full h-80 rounded-lg"></div>
                                 
                                 I will REMOVE the id="map" from view-EN_ROUTE in the HTML and instead 
                                 create a SHARED map container outside lifecycle views? 
                                 Or just move the element via JS?
                                 
                                 Alternative: Define a new map container here with id `map-sos` and instantiate a map there?
                                 The `initMap` function hardcodes `map`.
                                 
                                 Let's change `initMap` to accept an ID or just handle the DOM.
                                 
                                 Strategy: Add `div id="map-sos"` here. Modify `initMap` or create `initSosMap`.
                                 Actually the easiest way without refactoring everything is:
                                 When switching views, if the generic `map` is needed, ensure it exists.
                                 
                                 Wait, the prompt says "Reuse map logic".
                                 I will essentially copy the map div usage. I'll give this div id="map-sos".
                                 And I will update `initMap` to look for the current visible map container or pass id.
                            -->
                            <div id="map-sos" class="w-full h-64 rounded-lg border border-white/10 bg-slate-900"></div>

                            <div class="mt-4 flex gap-3 justify-center">
                                <button onclick="updateStatus('AT_PATIENT')"
                                    class="bg-clinical-red hover:bg-clinical-red/90 text-white font-medium py-3 px-8 rounded-lg transition-colors shadow-lg shadow-clinical-red/20 flex items-center gap-2">
                                    <i class="fa-solid fa-location-dot"></i> ARRIVED AT SCENE
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- STATE: AT_PATIENT (Assessment) -->
                    <div id="view-AT_PATIENT" class="lifecycle-view hidden clinical-panel rounded-xl overflow-hidden">
                        <div class="bg-slate-900/70 px-5 py-3 border-b border-white/5">
                            <h3 class="font-medium text-white flex items-center gap-2 text-sm">
                                <span class="w-1 h-4 bg-clinical-blue rounded-full"></span>
                                Patient Assessment
                            </h3>
                        </div>

                        <!-- Voice Incident Reporter -->
                        <div class="p-5" id="voiceReporterSectionAssess">
                            <div class="flex items-center gap-2 mb-4">
                                <div class="w-1 h-4 bg-green-500 rounded-full"></div>
                                <h4 class="text-xs font-semibold text-slate-300 uppercase tracking-wide"
                                    data-i18n="voice_reporter">üéôÔ∏è Voice Incident Reporter</h4>
                                <span
                                    class="text-[9px] font-mono bg-green-900/30 text-green-400 px-2 py-0.5 rounded-full border border-green-500/30">AI</span>
                            </div>
                            <p class="text-[11px] text-slate-400 mb-4 leading-relaxed" data-i18n="voice_desc">
                                Tap the mic and describe the incident. The system will auto-detect
                                <strong class="text-slate-200">consciousness</strong>,
                                <strong class="text-slate-200">bleeding</strong>,
                                <strong class="text-slate-200">severity</strong>,
                                and fill the form automatically.
                            </p>
                            <!-- Voice Language Selector -->
                            <div class="voice-lang-pills" id="voiceLangPillsAssess">
                                <span class="pill-label"><i class="fa-solid fa-language"></i> Speak in:</span>
                                <button type="button" class="voice-lang-pill active" onclick="setVoiceLang('en')"
                                    data-vlang="en">üá¨üáß English</button>
                                <button type="button" class="voice-lang-pill" onclick="setVoiceLang('te')"
                                    data-vlang="te">üáÆüá≥ ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
                                <button type="button" class="voice-lang-pill" onclick="setVoiceLang('hi')"
                                    data-vlang="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
                            </div>
                            <div class="flex flex-col items-center">
                                <button type="button" class="voice-mic-btn" id="voiceMicBtnAssess"
                                    onclick="toggleVoiceRecordingAssess()">
                                    <div class="voice-ring"></div>
                                    <i class="fa-solid fa-microphone"></i>
                                </button>
                                <div class="voice-status" id="voiceStatusAssess" data-i18n="voice_tap_mic">Tap mic &
                                    describe the incident</div>
                                <button type="button" class="voice-rerecord-btn" id="voiceRerecordBtnAssess"
                                    onclick="resetVoiceAndRerecordAssess()">
                                    <i class="fa-solid fa-rotate-right"></i> Re-record
                                </button>
                            </div>
                            <div class="voice-transcript" id="voiceTranscriptAssess"></div>
                            <div class="voice-preview" id="voicePreviewAssess">
                                <div class="voice-chip">
                                    <span class="voice-chip-label" data-i18n="consciousness">Consciousness</span>
                                    <span class="voice-chip-value" id="vpConsciousnessAssess">--</span>
                                </div>
                                <div class="voice-chip">
                                    <span class="voice-chip-label" data-i18n="bleeding_label">Bleeding</span>
                                    <span class="voice-chip-value" id="vpBleedingAssess">--</span>
                                </div>
                                <div class="voice-chip">
                                    <span class="voice-chip-label" data-i18n="severity">Severity</span>
                                    <span class="voice-chip-value" id="vpSeverityAssess">--</span>
                                </div>
                                <div class="voice-chip">
                                    <span class="voice-chip-label" data-i18n="condition">Condition</span>
                                    <span class="voice-chip-value" id="vpConditionAssess">--</span>
                                </div>
                                <button type="button" class="voice-confirm-btn" id="voiceConfirmBtnAssess"
                                    onclick="applyVoiceDataAssess()">
                                    <i class="fa-solid fa-check-double"></i> <span data-i18n="apply_autofill">Apply &
                                        Auto-Fill Form</span>
                                </button>
                            </div>
                            <div class="voice-unsupported" id="voiceUnsupportedAssess">
                                <i class="fa-solid fa-exclamation-triangle"></i> Voice input not supported in this
                                browser. Please use Chrome.
                            </div>
                            <div class="voice-divider" data-i18n="or_fill_manually">or fill manually</div>
                        </div>

                        <form id="assessmentForm" onsubmit="handleDecisionRequest(event)" class="p-5 space-y-5"
                            style="padding-top:0">
                            <!-- Hidden fields -->
                            <input type="hidden" name="consciousness_level" id="assess-consciousness" value="ALERT">
                            <input type="hidden" name="injury_location" id="assess-injury-location" value="">
                            <input type="hidden" name="mechanism_of_injury" id="assess-moi" value="">


                            <span id="assessLat" style="display:none"></span>
                            <span id="assessLng" style="display:none"></span>
                            <input type="hidden" name="max_distance_km" value="20">
                            <input type="hidden" name="max_results" value="5">

                            <!-- ‚îÄ‚îÄ SECTION 1: Scene Assessment ‚îÄ‚îÄ -->
                            <div class="space-y-4">
                                <div class="form-section-hdr">
                                    <i class="fa-solid fa-eye text-clinical-blue"></i> <span
                                        data-i18n="scene_assessment">Scene Assessment</span>
                                </div>

                                <!-- AVPU Consciousness -->
                                <div class="space-y-2">
                                    <label class="text-[10px] font-semibold text-slate-400 uppercase tracking-wide"
                                        data-i18n="avpu_label">Consciousness Level (AVPU) *</label>
                                    <div class="flex gap-2" id="assess-avpu-group">
                                        <button type="button" class="avpu-btn active-alert" data-avpu="ALERT"
                                            onclick="selectAVPU('assess','ALERT')">ALERT</button>
                                        <button type="button" class="avpu-btn" data-avpu="VERBAL"
                                            onclick="selectAVPU('assess','VERBAL')">VERBAL</button>
                                        <button type="button" class="avpu-btn" data-avpu="PAIN"
                                            onclick="selectAVPU('assess','PAIN')">PAIN</button>
                                        <button type="button" class="avpu-btn" data-avpu="UNRESPONSIVE"
                                            onclick="selectAVPU('assess','UNRESPONSIVE')">No Response</button>
                                    </div>
                                </div>

                                <!-- Active Bleeding Toggle -->
                                <div class="bleeding-toggle" id="assess-bleeding-toggle"
                                    onclick="toggleBleeding('assess')">
                                    <div class="toggle-circle"></div>
                                    <div>
                                        <div class="text-sm font-semibold text-white" data-i18n="bleeding_toggle">Active
                                            Bleeding Visible</div>
                                        <div class="text-[10px] text-slate-400 mt-0.5">Open wounds, blood-soaked
                                            clothing, pooling</div>
                                    </div>
                                    <i class="fa-solid fa-droplet ml-auto text-slate-600" id="assess-bleed-icon"></i>
                                    <input type="hidden" name="bleeding" id="assess-bleeding-val" value="false">
                                </div>

                                <!-- Injury Location (show when bleeding=ON) -->
                                <div id="assess-location-section" class="hidden space-y-2">
                                    <label class="text-[10px] font-semibold text-slate-400 uppercase tracking-wide"
                                        data-i18n="injury_location">Bleeding / Injury Location *</label>
                                    <div class="grid grid-cols-4 gap-1.5">
                                        <button type="button" class="loc-btn" data-loc="head"
                                            onclick="selectLocation('assess','head')">Head<br>Face</button>
                                        <button type="button" class="loc-btn" data-loc="neck"
                                            onclick="selectLocation('assess','neck')">Neck</button>
                                        <button type="button" class="loc-btn" data-loc="chest"
                                            onclick="selectLocation('assess','chest')">Chest</button>
                                        <button type="button" class="loc-btn" data-loc="abdomen"
                                            onclick="selectLocation('assess','abdomen')">Abdomen</button>
                                        <button type="button" class="loc-btn" data-loc="back"
                                            onclick="selectLocation('assess','back')">Back</button>
                                        <button type="button" class="loc-btn" data-loc="arm"
                                            onclick="selectLocation('assess','arm')">Arm</button>
                                        <button type="button" class="loc-btn" data-loc="leg"
                                            onclick="selectLocation('assess','leg')">Leg</button>
                                        <button type="button" class="loc-btn" data-loc="multiple"
                                            onclick="selectLocation('assess','multiple')">Multiple</button>
                                    </div>
                                </div>

                                <!-- Mechanism of Injury -->
                                <div id="assess-moi-section" class="space-y-2">
                                    <label class="text-[10px] font-semibold text-slate-400 uppercase tracking-wide"
                                        data-i18n="mechanism_of_injury">Mechanism of Injury</label>
                                    <div class="grid grid-cols-3 gap-1.5">
                                        <button type="button" class="moi-btn" data-moi="road_accident"
                                            onclick="selectMOI('assess','road_accident')">üöó<br>Road Accident</button>
                                        <button type="button" class="moi-btn" data-moi="fall"
                                            onclick="selectMOI('assess','fall')">ü™ú<br>Fall</button>
                                        <button type="button" class="moi-btn" data-moi="cardiac_event"
                                            onclick="selectMOI('assess','cardiac_event')">üíä<br>Medical Event</button>
                                        <button type="button" class="moi-btn" data-moi="burns"
                                            onclick="selectMOI('assess','burns')">üî•<br>Burns/Chemical</button>
                                        <button type="button" class="moi-btn" data-moi="assault"
                                            onclick="selectMOI('assess','assault')">‚ö†Ô∏è<br>Assault</button>
                                        <button type="button" class="moi-btn selected" data-moi="unknown"
                                            onclick="selectMOI('assess','unknown')">‚ùì<br>Unknown</button>
                                    </div>
                                </div>
                            </div>

                            <!-- ‚îÄ‚îÄ SECTION 2: Clinical Assessment ‚îÄ‚îÄ -->
                            <div class="space-y-4">
                                <div class="form-section-hdr">
                                    <i class="fa-solid fa-heart-pulse text-clinical-blue"></i> <span
                                        data-i18n="clinical_assessment">Clinical Assessment</span>
                                </div>

                                <!-- Severity Slider -->
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between">
                                        <label class="text-[10px] font-semibold text-slate-400 uppercase tracking-wide"
                                            data-i18n="severity_level">Severity Level *</label>
                                        <div id="assess-sev-display" class="severity-display"
                                            style="width:2.5rem;height:2.5rem;font-size:1.2rem;">3</div>
                                    </div>
                                    <input type="range" name="severity_level" id="assess-severity" class="sev-slider"
                                        min="1" max="5" value="3" step="1"
                                        oninput="updateEMTSeverity('assess', this.value)">
                                    <div class="flex justify-between text-[9px] font-mono text-slate-600 px-0.5">
                                        <span style="color:#16a34a">1 Minor</span><span style="color:#65a30d">2
                                            Mild</span><span style="color:#d97706">3 Moderate</span><span
                                            style="color:#ea580c">4 Serious</span><span style="color:#dc2626">5
                                            Critical</span>
                                    </div>
                                </div>

                                <!-- Requires ICU -->
                                <label class="icu-toggle-row">
                                    <input type="checkbox" name="requires_icu" id="assess-icu"
                                        class="w-5 h-5 rounded accent-red-600 flex-shrink-0">
                                    <div>
                                        <div class="text-sm font-semibold text-white" data-i18n="requires_icu">
                                            Requires ICU</div>
                                        <div class="text-[10px] text-slate-500">Auto-checked for UNRESPONSIVE /
                                            Severity ‚â• 4</div>
                                    </div>
                                    <span id="assess-icu-badge"
                                        class="hidden ml-auto text-[9px] font-bold bg-red-900/40 text-red-400 px-2 py-0.5 rounded-full border border-red-800">ICU</span>
                                </label>

                                <!-- Requires Specialty -->
                                <div class="space-y-2">
                                    <label class="text-[10px] font-semibold text-slate-400 uppercase tracking-wide"
                                        data-i18n="specialty_required">Requires Specialty</label>
                                    <input type="text" name="requires_specialty" id="assess-specialty"
                                        placeholder="e.g., Orthopedics, Neurosurgery"
                                        class="input-clinical w-full p-2.5 rounded-lg text-sm">
                                    <div class="flex flex-wrap gap-1.5 mt-1">
                                        <span class="specialty-chip"
                                            onclick="setSpecialty('assess','Trauma')">Trauma</span>
                                        <span class="specialty-chip"
                                            onclick="setSpecialty('assess','Orthopedics')">Orthopedics</span>
                                        <span class="specialty-chip"
                                            onclick="setSpecialty('assess','Neurosurgery')">Neurosurgery</span>
                                        <span class="specialty-chip"
                                            onclick="setSpecialty('assess','Cardiology')">Cardiology</span>
                                        <span class="specialty-chip" onclick="setSpecialty('assess','Burns Unit')">Burns
                                            Unit</span>
                                        <span class="specialty-chip"
                                            onclick="setSpecialty('assess','General Surgery')">General
                                            Surgery</span>
                                    </div>
                                </div>
                            </div>

                            <!-- ‚îÄ‚îÄ SECTION 3: Location & Constraints ‚îÄ‚îÄ -->
                            <div class="grid grid-cols-2 gap-3">
                                <div class="space-y-1">
                                    <label class="text-[9px] font-medium text-slate-400 uppercase tracking-wide">Current
                                        Latitude</label>
                                    <div class="flex gap-1.5">
                                        <input type="number" step="any" name="latitude" id="assessLatInput" required
                                            class="input-clinical w-full p-2.5 rounded-lg text-xs font-mono flex-1">
                                        <button type="button" onclick="getCurrentLocationAssess()"
                                            class="bg-clinical-blue/10 hover:bg-clinical-blue text-clinical-blue hover:text-white px-2.5 rounded-lg border border-clinical-blue/30 transition-colors"
                                            title="Use current location">
                                            <i class="fa-solid fa-location-dot"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label class="text-[9px] font-medium text-slate-400 uppercase tracking-wide">Current
                                        Longitude</label>
                                    <input type="number" step="any" name="longitude" id="assessLngInput" required
                                        class="input-clinical w-full p-2.5 rounded-lg text-xs font-mono">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-[9px] font-medium text-slate-400 uppercase tracking-wide">Max
                                        Distance (km)</label>
                                    <input type="number" name="max_distance_km" value="20" required
                                        class="input-clinical w-full p-2.5 rounded-lg text-sm font-mono">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-[9px] font-medium text-slate-400 uppercase tracking-wide">Max
                                        Results</label>
                                    <input type="number" name="max_results" value="5" required
                                        class="input-clinical w-full p-2.5 rounded-lg text-sm font-mono">
                                </div>
                            </div>

                            <!-- ‚îÄ‚îÄ SECTION 4: Actions ‚îÄ‚îÄ -->
                            <div class="space-y-3 pt-1">
                                <!-- AI Scan -->
                                <input type="file" id="triageImg-assess" accept="image/*" class="hidden"
                                    onchange="runTriageUpload(this, 'assessmentForm', 'assess')">
                                <button type="button" class="ai-scan-btn"
                                    onclick="document.getElementById('triageImg-assess').click()">
                                    <i class="fa-solid fa-camera-retro"></i> <span data-i18n="ai_scan_injury">üì∑ AI
                                        Scan Injury</span>
                                </button>
                                <div class="flex items-center gap-2 min-h-[22px]">
                                    <span id="triage-status-assess" class="triage-status-text text-[11px]"></span>
                                    <span id="triage-badge-assess" class="triage-badge hidden"></span>
                                </div>

                                <!-- Submit -->
                                <button type="submit" class="btn-clinical w-full text-sm py-3">
                                    <i class="fa-solid fa-search-location"></i>
                                    <span data-i18n="find_best_hospitals">üîç Find Best Hospitals</span>
                                </button>
                            </div>
                        </form>
                        <div id="assessmentMessage" class="px-6 pb-4 text-center text-xs font-mono"></div>
                    </div>

                    <!-- STATE: IDLE -->
                    <div id="view-IDLE" class="lifecycle-view clinical-panel rounded-xl overflow-hidden">
                        <div class="bg-slate-900/70 px-5 py-3 border-b border-white/5">
                            <h3 class="font-medium text-white flex items-center gap-2 text-sm">
                                <span class="w-1 h-4 bg-clinical-blue rounded-full"></span>
                                Start New Case
                            </h3>
                        </div>
                        <!-- Voice Incident Reporter -->
                        <div class="p-5" id="voiceReporterSection">
                            <div class="flex items-center gap-2 mb-4">
                                <div class="w-1 h-4 bg-green-500 rounded-full"></div>
                                <h4 class="text-xs font-semibold text-slate-300 uppercase tracking-wide"
                                    data-i18n="voice_reporter">üéôÔ∏è Voice Incident Reporter</h4>
                                <span
                                    class="text-[9px] font-mono bg-green-900/30 text-green-400 px-2 py-0.5 rounded-full border border-green-500/30">AI</span>
                            </div>
                            <p class="text-[11px] text-slate-400 mb-4 leading-relaxed" data-i18n="voice_desc">
                                Tap the mic and describe the incident. The system will auto-detect
                                <strong class="text-slate-200">consciousness</strong>,
                                <strong class="text-slate-200">bleeding</strong>,
                                <strong class="text-slate-200">severity</strong>,
                                and fill the form automatically.
                            </p>
                            <!-- Voice Language Selector -->
                            <div class="voice-lang-pills" id="voiceLangPills">
                                <span class="pill-label"><i class="fa-solid fa-language"></i> Speak in:</span>
                                <button type="button" class="voice-lang-pill active" onclick="setVoiceLang('en')"
                                    data-vlang="en">üá¨üáß English</button>
                                <button type="button" class="voice-lang-pill" onclick="setVoiceLang('te')"
                                    data-vlang="te">üáÆüá≥ ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
                                <button type="button" class="voice-lang-pill" onclick="setVoiceLang('hi')"
                                    data-vlang="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
                            </div>
                            <div class="flex flex-col items-center">
                                <button type="button" class="voice-mic-btn" id="voiceMicBtn"
                                    onclick="toggleVoiceRecording()">
                                    <div class="voice-ring"></div>
                                    <i class="fa-solid fa-microphone"></i>
                                </button>
                                <div class="voice-status" id="voiceStatus" data-i18n="voice_tap_mic">Tap mic & describe
                                    the incident</div>
                                <button type="button" class="voice-rerecord-btn" id="voiceRerecordBtn"
                                    onclick="resetVoiceAndRerecord()">
                                    <i class="fa-solid fa-rotate-right"></i> Re-record
                                </button>
                            </div>
                            <div class="voice-transcript" id="voiceTranscript"></div>
                            <div class="voice-preview" id="voicePreview">
                                <div class="voice-chip">
                                    <span class="voice-chip-label" data-i18n="consciousness">Consciousness</span>
                                    <span class="voice-chip-value" id="vpConsciousness">--</span>
                                </div>
                                <div class="voice-chip">
                                    <span class="voice-chip-label" data-i18n="bleeding_label">Bleeding</span>
                                    <span class="voice-chip-value" id="vpBleeding">--</span>
                                </div>
                                <div class="voice-chip">
                                    <span class="voice-chip-label" data-i18n="severity">Severity</span>
                                    <span class="voice-chip-value" id="vpSeverity">--</span>
                                </div>
                                <div class="voice-chip">
                                    <span class="voice-chip-label" data-i18n="condition">Condition</span>
                                    <span class="voice-chip-value" id="vpCondition">--</span>
                                </div>
                                <button type="button" class="voice-confirm-btn" id="voiceConfirmBtn"
                                    onclick="applyVoiceData()">
                                    <i class="fa-solid fa-check-double"></i> <span data-i18n="apply_autofill">Apply &
                                        Auto-Fill Form</span>
                                </button>
                            </div>
                            <div class="voice-unsupported" id="voiceUnsupported">
                                <i class="fa-solid fa-exclamation-triangle"></i> Voice input not supported in this
                                browser. Please use Chrome.
                            </div>
                            <div class="voice-divider" data-i18n="or_fill_manually">or fill manually</div>
                        </div>
                        <form id="decisionForm" onsubmit="handleDecisionRequest(event)" class="p-5 space-y-5"
                            style="padding-top:0">
                            <!-- Hidden fields ‚Äî keep unchanged -->
                            <input type="hidden" name="consciousness_level" id="dec-consciousness" value="ALERT">
                            <input type="hidden" name="injury_location" id="dec-injury-location" value="">
                            <input type="hidden" name="mechanism_of_injury" id="dec-moi" value="">

                            <!-- ‚îÄ‚îÄ SECTION 1: Scene Assessment ‚îÄ‚îÄ -->
                            <div class="space-y-4">
                                <div class="form-section-hdr">
                                    <i class="fa-solid fa-eye text-clinical-blue"></i> <span
                                        data-i18n="scene_assessment">Scene Assessment</span>
                                </div>

                                <!-- Field 1: AVPU Consciousness -->
                                <div class="space-y-2">
                                    <label class="text-[10px] font-semibold text-slate-400 uppercase tracking-wide"
                                        data-i18n="avpu_label">Consciousness
                                        Level (AVPU) *</label>
                                    <div class="flex gap-2" id="dec-avpu-group">
                                        <button type="button" class="avpu-btn active-alert" data-avpu="ALERT"
                                            onclick="selectAVPU('dec','ALERT')">ALERT</button>
                                        <button type="button" class="avpu-btn" data-avpu="VERBAL"
                                            onclick="selectAVPU('dec','VERBAL')">VERBAL</button>
                                        <button type="button" class="avpu-btn" data-avpu="PAIN"
                                            onclick="selectAVPU('dec','PAIN')">PAIN</button>
                                        <button type="button" class="avpu-btn" data-avpu="UNRESPONSIVE"
                                            onclick="selectAVPU('dec','UNRESPONSIVE')">No Response</button>
                                    </div>
                                </div>

                                <!-- Field 2: Active Bleeding Toggle -->
                                <div class="bleeding-toggle" id="dec-bleeding-toggle" onclick="toggleBleeding('dec')">
                                    <div class="toggle-circle"></div>
                                    <div>
                                        <div class="text-sm font-semibold text-white" data-i18n="bleeding_toggle">Active
                                            Bleeding Visible</div>
                                        <div class="text-[10px] text-slate-400 mt-0.5">Open wounds, blood-soaked
                                            clothing, pooling</div>
                                    </div>
                                    <i class="fa-solid fa-droplet ml-auto text-slate-600" id="dec-bleed-icon"></i>
                                    <input type="hidden" name="bleeding" id="dec-bleeding-val" value="false">
                                </div>

                                <!-- Field 3: Injury Location (show when bleeding=ON) -->
                                <div id="dec-location-section" class="hidden space-y-2">
                                    <label class="text-[10px] font-semibold text-slate-400 uppercase tracking-wide"
                                        data-i18n="injury_location">Bleeding
                                        / Injury Location *</label>
                                    <div class="grid grid-cols-4 gap-1.5">
                                        <button type="button" class="loc-btn" data-loc="head"
                                            onclick="selectLocation('dec','head')">Head<br>Face</button>
                                        <button type="button" class="loc-btn" data-loc="neck"
                                            onclick="selectLocation('dec','neck')">Neck</button>
                                        <button type="button" class="loc-btn" data-loc="chest"
                                            onclick="selectLocation('dec','chest')">Chest</button>
                                        <button type="button" class="loc-btn" data-loc="abdomen"
                                            onclick="selectLocation('dec','abdomen')">Abdomen</button>
                                        <button type="button" class="loc-btn" data-loc="back"
                                            onclick="selectLocation('dec','back')">Back</button>
                                        <button type="button" class="loc-btn" data-loc="arm"
                                            onclick="selectLocation('dec','arm')">Arm</button>
                                        <button type="button" class="loc-btn" data-loc="leg"
                                            onclick="selectLocation('dec','leg')">Leg</button>
                                        <button type="button" class="loc-btn" data-loc="multiple"
                                            onclick="selectLocation('dec','multiple')">Multiple</button>
                                    </div>
                                </div>

                                <!-- Field 4: Mechanism of Injury (show when bleeding=OFF) -->
                                <div id="dec-moi-section" class="space-y-2">
                                    <label class="text-[10px] font-semibold text-slate-400 uppercase tracking-wide"
                                        data-i18n="mechanism_of_injury">Mechanism
                                        of Injury</label>
                                    <div class="grid grid-cols-3 gap-1.5">
                                        <button type="button" class="moi-btn" data-moi="road_accident"
                                            onclick="selectMOI('dec','road_accident')">üöó<br>Road Accident</button>
                                        <button type="button" class="moi-btn" data-moi="fall"
                                            onclick="selectMOI('dec','fall')">ü™ú<br>Fall</button>
                                        <button type="button" class="moi-btn" data-moi="cardiac_event"
                                            onclick="selectMOI('dec','cardiac_event')">üíä<br>Medical Event</button>
                                        <button type="button" class="moi-btn" data-moi="burns"
                                            onclick="selectMOI('dec','burns')">üî•<br>Burns/Chemical</button>
                                        <button type="button" class="moi-btn" data-moi="assault"
                                            onclick="selectMOI('dec','assault')">‚ö†Ô∏è<br>Assault</button>
                                        <button type="button" class="moi-btn selected" data-moi="unknown"
                                            onclick="selectMOI('dec','unknown')">‚ùì<br>Unknown</button>
                                    </div>
                                </div>
                            </div>

                            <!-- ‚îÄ‚îÄ SECTION 2: Clinical ‚îÄ‚îÄ -->
                            <div class="space-y-4">
                                <div class="form-section-hdr">
                                    <i class="fa-solid fa-heart-pulse text-clinical-blue"></i> <span
                                        data-i18n="clinical_assessment">Clinical Assessment</span>
                                </div>

                                <!-- Field 5: Severity Slider -->
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between">
                                        <label class="text-[10px] font-semibold text-slate-400 uppercase tracking-wide"
                                            data-i18n="severity_level">Severity
                                            Level *</label>
                                        <div id="dec-sev-display" class="severity-display"
                                            style="width:2.5rem;height:2.5rem;font-size:1.2rem;">3</div>
                                    </div>
                                    <input type="range" name="severity_level" id="dec-severity" class="sev-slider"
                                        min="1" max="5" value="3" step="1"
                                        oninput="updateEMTSeverity('dec', this.value)">
                                    <div class="flex justify-between text-[9px] font-mono text-slate-600 px-0.5">
                                        <span style="color:#16a34a">1 Minor</span><span style="color:#65a30d">2
                                            Mild</span><span style="color:#d97706">3 Moderate</span><span
                                            style="color:#ea580c">4 Serious</span><span style="color:#dc2626">5
                                            Critical</span>
                                    </div>
                                </div>

                                <!-- Field 6: Requires ICU -->
                                <label class="icu-toggle-row">
                                    <input type="checkbox" name="requires_icu" id="dec-icu"
                                        class="w-5 h-5 rounded accent-red-600 flex-shrink-0">
                                    <div>
                                        <div class="text-sm font-semibold text-white" data-i18n="requires_icu">Requires
                                            ICU</div>
                                        <div class="text-[10px] text-slate-500">Auto-checked for UNRESPONSIVE / Severity
                                            ‚â• 4</div>
                                    </div>
                                    <span id="dec-icu-badge"
                                        class="hidden ml-auto text-[9px] font-bold bg-red-900/40 text-red-400 px-2 py-0.5 rounded-full border border-red-800">ICU</span>
                                </label>

                                <!-- Field 7: Requires Specialty -->
                                <div class="space-y-2">
                                    <label class="text-[10px] font-semibold text-slate-400 uppercase tracking-wide"
                                        data-i18n="specialty_required">Requires
                                        Specialty</label>
                                    <input type="text" name="requires_specialty" id="dec-specialty"
                                        placeholder="e.g., Orthopedics, Neurosurgery"
                                        class="input-clinical w-full p-2.5 rounded-lg text-sm">
                                    <div class="flex flex-wrap gap-1.5 mt-1">
                                        <span class="specialty-chip"
                                            onclick="setSpecialty('dec','Trauma')">Trauma</span>
                                        <span class="specialty-chip"
                                            onclick="setSpecialty('dec','Orthopedics')">Orthopedics</span>
                                        <span class="specialty-chip"
                                            onclick="setSpecialty('dec','Neurosurgery')">Neurosurgery</span>
                                        <span class="specialty-chip"
                                            onclick="setSpecialty('dec','Cardiology')">Cardiology</span>
                                        <span class="specialty-chip" onclick="setSpecialty('dec','Burns Unit')">Burns
                                            Unit</span>
                                        <span class="specialty-chip"
                                            onclick="setSpecialty('dec','General Surgery')">General Surgery</span>
                                    </div>
                                </div>
                            </div>

                            <!-- ‚îÄ‚îÄ SECTION 3: Location & Constraints ‚îÄ‚îÄ -->
                            <div class="grid grid-cols-2 gap-3">
                                <div class="space-y-1">
                                    <label class="text-[9px] font-medium text-slate-400 uppercase tracking-wide">Current
                                        Latitude</label>
                                    <div class="flex gap-1.5">
                                        <input type="number" step="any" name="latitude" id="currentLat" required
                                            class="input-clinical w-full p-2.5 rounded-lg text-xs font-mono flex-1">
                                        <button type="button" onclick="getCurrentLocation()"
                                            class="bg-clinical-blue/10 hover:bg-clinical-blue text-clinical-blue hover:text-white px-2.5 rounded-lg border border-clinical-blue/30 transition-colors"
                                            title="Use current location">
                                            <i class="fa-solid fa-location-dot"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label class="text-[9px] font-medium text-slate-400 uppercase tracking-wide">Current
                                        Longitude</label>
                                    <input type="number" step="any" name="longitude" id="currentLng" required
                                        class="input-clinical w-full p-2.5 rounded-lg text-xs font-mono">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-[9px] font-medium text-slate-400 uppercase tracking-wide">Max
                                        Distance (km)</label>
                                    <input type="number" name="max_distance_km" value="15" required
                                        class="input-clinical w-full p-2.5 rounded-lg text-sm font-mono">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-[9px] font-medium text-slate-400 uppercase tracking-wide">Max
                                        Results</label>
                                    <input type="number" name="max_results" value="5" required
                                        class="input-clinical w-full p-2.5 rounded-lg text-sm font-mono">
                                </div>
                            </div>

                            <!-- ‚îÄ‚îÄ SECTION 4: Actions ‚îÄ‚îÄ -->
                            <div class="space-y-3 pt-1">
                                <!-- AI Scan -->
                                <input type="file" id="triageImg-decision" accept="image/*" class="hidden"
                                    onchange="runTriageUpload(this, 'decisionForm', 'decision')">
                                <button type="button" class="ai-scan-btn"
                                    onclick="document.getElementById('triageImg-decision').click()">
                                    <i class="fa-solid fa-camera-retro"></i> <span data-i18n="ai_scan_injury">üì∑ AI Scan
                                        Injury</span>
                                </button>
                                <div class="flex items-center gap-2 min-h-[22px]">
                                    <span id="triage-status-decision" class="triage-status-text text-[11px]"></span>
                                    <span id="triage-badge-decision" class="triage-badge hidden"></span>
                                </div>

                                <!-- Submit -->
                                <button type="submit" class="btn-clinical w-full text-sm py-3">
                                    <i class="fa-solid fa-search-location"></i>
                                    <span data-i18n="find_best_hospitals">üîç Find Best Hospitals</span>
                                </button>
                            </div>
                        </form>
                        <div id="decisionMessage" class="px-6 pb-4 text-center text-xs font-mono"></div>
                    </div>




                    <!-- STATE: CASE_CREATED (Results) -->
                    <div id="view-CASE_CREATED" class="lifecycle-view hidden clinical-panel rounded-xl overflow-hidden">
                        <div class="bg-slate-900/70 px-5 py-3 border-b border-white/5">
                            <h3 class="font-medium text-white flex items-center gap-2 text-sm">
                                <span class="w-1 h-4 bg-clinical-amber rounded-full"></span>
                                Select Destination Hospital
                            </h3>
                        </div>
                        <div class="p-6">
                            <div id="resultsArea">
                                <div class="overflow-x-auto">
                                    <table id="resultsTable" class="w-full">
                                        <thead>
                                            <tr>
                                                <th>Rank</th>
                                                <th>Hospital</th>
                                                <th>Distance / ETA</th>
                                                <th>Score</th>
                                                <th>Status Snapshot</th>
                                                <th>Reasoning</th>
                                                <th class="text-right">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-white/5"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="mt-6 flex justify-center">
                                <button onclick="cancelCase()"
                                    class="bg-slate-700 hover:bg-slate-600 text-white font-medium py-2 px-6 rounded-lg transition-colors flex items-center gap-2">
                                    <i class="fa-solid fa-ban"></i> Cancel Case
                                </button>
                            </div>
                        </div>
                    </div>


                    <!-- STATE: HOSPITAL_SELECTED -->
                    <div id="view-HOSPITAL_SELECTED"
                        class="lifecycle-view hidden clinical-panel rounded-xl overflow-hidden">
                        <div class="bg-slate-900/70 px-5 py-3 border-b border-white/5">
                            <h3 class="font-medium text-white flex items-center gap-2 text-sm">
                                <span class="w-1 h-4 bg-clinical-blue rounded-full"></span>
                                Hospital Selected
                            </h3>
                        </div>
                        <div class="p-6 text-center">
                            <div
                                class="w-16 h-16 mx-auto bg-clinical-blue/20 rounded-full flex items-center justify-center mb-4">
                                <i class="fa-solid fa-check text-3xl text-clinical-blue"></i>
                            </div>
                            <p class="text-lg font-semibold text-white">Destination Confirmed</p>
                            <p class="text-sm text-slate-400 mt-1">Target: <span id="lbl-target-hospital"
                                    class="font-mono text-clinical-blue">---</span></p>
                            <p class="text-xs text-slate-500 mt-2">Prepare for transport.</p>
                            <div class="mt-6 flex flex-col sm:flex-row gap-3 justify-center">
                                <button onclick="updateStatus('EN_ROUTE')"
                                    class="btn-clinical bg-clinical-green hover:bg-clinical-green/90">
                                    <i class="fa-solid fa-route"></i> Start Route
                                </button>
                                <button onclick="cancelCase()"
                                    class="bg-slate-700 hover:bg-slate-600 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- STATE: EN_ROUTE -->
                    <div id="view-EN_ROUTE" class="lifecycle-view hidden clinical-panel rounded-xl overflow-hidden">
                        <div class="bg-slate-900/70 px-5 py-3 border-b border-white/5">
                            <h3 class="font-medium text-white flex items-center gap-2 text-sm">
                                <span class="w-1 h-4 bg-clinical-amber rounded-full"></span>
                                En Route to Hospital
                            </h3>
                        </div>
                        <div class="p-6">
                            <div id="map" class="w-full h-80 rounded-lg"></div>
                            <div class="mt-6 flex flex-col items-center gap-3">
                                <button onclick="updateStatus('ARRIVED')"
                                    class="bg-clinical-amber hover:bg-clinical-amber/90 text-white font-medium py-2.5 px-6 rounded-lg transition-colors flex items-center gap-2 w-full max-w-xs justify-center">
                                    <i class="fa-solid fa-location-dot"></i> Mark Arrived
                                </button>
                                <button onclick="openReEvalModal()"
                                    class="btn-clinical-outline font-medium py-2.5 px-6 rounded-lg transition-all flex items-center gap-2 w-full max-w-xs justify-center hover:shadow-lg hover:shadow-clinical-blue/20"
                                    title="Re-run the decision engine with updated severity">
                                    <i class="fa-solid fa-rotate"></i> Re-Evaluate Destination
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- STATE: ARRIVED -->
                    <div id="view-ARRIVED" class="lifecycle-view hidden clinical-panel rounded-xl overflow-hidden">
                        <div class="bg-slate-900/70 px-5 py-3 border-b border-white/5">
                            <h3 class="font-medium text-white flex items-center gap-2 text-sm">
                                <span class="w-1 h-4 bg-clinical-green rounded-full"></span>
                                Arrived at Hospital
                            </h3>
                        </div>
                        <div class="p-6 text-center">
                            <div
                                class="w-16 h-16 mx-auto bg-clinical-green/20 rounded-full flex items-center justify-center mb-4">
                                <i class="fa-solid fa-flag-checkered text-3xl text-clinical-green"></i>
                            </div>
                            <p class="text-white">Transferring patient...</p>
                            <div class="mt-6">
                                <button onclick="updateStatus('PATIENT_ADMITTED')" class="btn-clinical">
                                    <i class="fa-solid fa-user-check"></i> Patient Admitted
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- STATE: PATIENT_ADMITTED -->
                    <div id="view-PATIENT_ADMITTED"
                        class="lifecycle-view hidden clinical-panel rounded-xl overflow-hidden">
                        <div class="bg-slate-900/70 px-5 py-3 border-b border-white/5">
                            <h3 class="font-medium text-white flex items-center gap-2 text-sm">
                                <span class="w-1 h-4 bg-clinical-blue rounded-full"></span>
                                Mission Complete
                            </h3>
                        </div>
                        <div class="p-6 text-center">
                            <div
                                class="w-16 h-16 mx-auto bg-clinical-blue/20 rounded-full flex items-center justify-center mb-4">
                                <i class="fa-solid fa-circle-check text-3xl text-clinical-blue"></i>
                            </div>
                            <p class="text-white">Patient successfully admitted.</p>
                            <div class="mt-6">
                                <button onclick="updateStatus('COMPLETED')" class="btn-clinical">
                                    <i class="fa-solid fa-rotate-left"></i> Complete & Return to Idle
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ========== 100% ORIGINAL JAVASCRIPT LOGIC (PRESERVED) ========== -->
    <script>
        // --------------------------------------------------------------------
        // üöë ORIGINAL AMBULANCE LIFECYCLE LOGIC ‚Äì DO NOT MODIFY
        // --------------------------------------------------------------------
        let currentAmbulance = null;
        const API_BASE = 'http://localhost:3000';

        /** 
         * Robust fetch with timeout to prevent hanging on flaky OSRM demo servers
         * @param {string} resource - The URL to fetch
         * @param {object} options - Fetch options + timeout (default 5000ms)
         */
        async function fetchWithTimeout(resource, options = {}) {
            const { timeout = 5000 } = options;
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), timeout);
            try {
                const response = await fetch(resource, { ...options, signal: controller.signal });
                clearTimeout(id);
                return response;
            } catch (error) {
                clearTimeout(id);
                throw error;
            }
        }

        // Elements
        const loginSection = document.getElementById('loginSection');
        const registerSection = document.getElementById('registerSection');
        const dashboardSection = document.getElementById('dashboardSection');
        const loginMessage = document.getElementById('loginMessage');
        const registerPrompt = document.getElementById('registerPrompt');

        // Map Globals
        let map = null;
        let routeLayer = null;
        let markers = [];
        let ambulanceMarker = null;

        // Custom Ambulance Icon
        const ambulanceIcon = L.icon({
            iconUrl: 'https://cdn-icons-png.flaticon.com/512/263/263058.png',
            iconSize: [32, 32],
            iconAnchor: [16, 16],
            popupAnchor: [0, -16]
        });

        // Initialize Map ‚Äì ORIGINAL OSM LIGHT TILES
        // NOTE: Modified to support multiple containers via initTargetMap
        function initMap() { initTargetMap('map'); }

        // Animate ambulance along route (Vanishing Path)
        let animationInterval = null;
        let animationFrameId = null;
        let navigationMode = false;
        let currentRoutePolyline = null; // Store route geometry for calculations

        function startAnimation(route) {
            // Stop any existing animation
            stopAnimation();

            // Set Navigation Mode
            navigationMode = true;
            document.getElementById('nav-panel').classList.remove('hidden');

            const coords = route.geometry.coordinates; // [lng, lat]
            const routePoints = coords.map(c => L.latLng(c[1], c[0]));

            const routeDuration = route.duration;
            const routeDistance = route.distance;

            // Get initial instruction
            let instruction = "Follow route";
            if (route.legs && route.legs[0] && route.legs[0].steps && route.legs[0].steps[0]) {
                instruction = route.legs[0].steps[0].maneuver.instruction || instruction;
            }

            // ‚îÄ‚îÄ REALISTIC ANIMATION SPEED ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            // Ambulance speed: ~40 km/h city driving (11.11 m/s).
            // Animation duration = how long it takes to drive routeDistance at this speed.
            // Min: 45 s (very short runs still show movement).
            // Max: 180 s (cap for demo usability; real ~20 min routes don't run 20 min).
            const AMBULANCE_SPEED_MPS = 11.11; // 40 km/h in m/s
            const rawDurationMs = (routeDistance / AMBULANCE_SPEED_MPS) * 1000;
            const animationDurationMs = Math.min(Math.max(rawDurationMs, 45000), 180000);

            const startTime = performance.now();

            // Initial UI set
            updateNavUI(routeDuration / 60, routeDistance / 1000, instruction);

            let lastLocationPush = 0;

            function animate(currentTime) {
                if (!navigationMode) return;

                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / animationDurationMs, 1);

                if (progress >= 1) {
                    stopAnimation();
                    // Auto-arrive? User logic handles manual arrival button, but we can stop visual animation.
                    // Ideally we keep the ambulance at end.
                    if (ambulanceMarker) {
                        const lastPt = routePoints[routePoints.length - 1];
                        ambulanceMarker.setLatLng(lastPt);
                        updateCamera(lastPt, 0); // Reset bearing

                        // FIX: Update internal state to match arrival
                        currentAmbulance.latitude = lastPt.lat;
                        currentAmbulance.longitude = lastPt.lng;

                        // Final push to backend to ensure sync
                        updateRealtimeLocation(lastPt.lat, lastPt.lng);
                    }
                    if (routeLayer) map.removeLayer(routeLayer);
                    document.getElementById('nav-instruction').textContent = "Arrived at destination";
                    return;
                }

                // Calculate current position based on progress
                // We need to find which segment we are on.
                // Simplified: interpolate along total length? 
                // Better: find index. 
                const totalPoints = routePoints.length;
                const exactIndex = progress * (totalPoints - 1);
                const index = Math.floor(exactIndex);
                const nextIndex = Math.min(index + 1, totalPoints - 1);
                const segmentProgress = exactIndex - index;

                const p1 = routePoints[index];
                const p2 = routePoints[nextIndex];

                // Interpolate
                const lat = p1.lat + (p2.lat - p1.lat) * segmentProgress;
                const lng = p1.lng + (p2.lng - p1.lng) * segmentProgress;
                const currentPos = L.latLng(lat, lng);

                // Calculate Bearing
                const bearing = calculateBearing(p1.lat, p1.lng, p2.lat, p2.lng);

                // Update Marker
                if (ambulanceMarker) {
                    ambulanceMarker.setLatLng(currentPos);
                    ambulanceMarker.setRotationAngle(bearing);
                }

                // Update Camera (Smooth Follow + Offset)
                updateCamera(currentPos, bearing);

                // Update Route (Vanishing)
                // Slice the original coords array from nextIndex onwards
                if (routeLayer) {
                    // remaining: from current pos to end? 
                    // To be smooth, we might want to just slice from 'nextIndex'
                    // For performance, doing this every frame is heavy. Maybe every 10 frames?
                    // Or just slice from 'index'.
                    const remaining = coords.slice(index).map(c => [c[1], c[0]]);
                    // Add currentPos to start of remaining to connect smoothly?
                    remaining.unshift([lat, lng]);
                    routeLayer.setLatLngs(remaining);
                }

                // Update UI (approximate remaining)
                const remainingProgress = 1 - progress;
                updateNavUI((routeDuration / 60) * remainingProgress, (routeDistance / 1000) * remainingProgress, "Proceed to destination");

                // --- REAL-TIME LOCATION PUSH ---
                // Throttle to every 3000ms (3s) to avoid spamming backend
                if (currentTime - lastLocationPush > 3000) {
                    lastLocationPush = currentTime;
                    updateRealtimeLocation(lat, lng);
                }

                animationFrameId = requestAnimationFrame(animate);
            }

            animationFrameId = requestAnimationFrame(animate);
        }

        // Helper to push location silently
        async function updateRealtimeLocation(lat, lng) {
            if (!currentAmbulance) return;
            // Update local state first
            currentAmbulance.latitude = lat;
            currentAmbulance.longitude = lng;

            try {
                await fetch(`${API_BASE}/ambulances/${currentAmbulance.ambulance_id}/location`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ latitude: lat, longitude: lng })
                });
            } catch (e) { console.error("Loc push failed", e); }
        }

        function stopAnimation() {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            if (animationInterval) clearInterval(animationInterval); // Legacy
            animationFrameId = null;
            // Clean up route layer if needed, or leave it until confirmed? 
            // User said: "When animation completes: map.removeLayer(routeLayer)"
        }

        function updateCamera(pos, bearing) {
            // "Offset Camera (Professional Feel)" - Shift camera upward so ambulance appears slightly lower
            // We need to project, shift y by -120, unproject.
            const zoom = 17;
            const point = map.project(pos, zoom);
            point.y -= 120; // Shift center UP, so marker moves DOWN 
            const targetCenter = map.unproject(point, zoom);

            // Pan vs SetView
            // setView with animate: false is instant, animate: true might be laggy at 60fps.
            // PanTo is smoother but might lag behind.
            // Let's try setView with animation disabled (instant update per frame) for tight lock.
            // BUT strict lock can be jittery.
            // User suggested: map.setView(newCenter, 17, { animate: true });
            // If we run at 60fps, we don't want 'animate: true' (css transition) fighting the JS loop.
            // Best practice for frame-based animation is 'animate: false'.
            map.setView(targetCenter, zoom, { animate: false });
        }

        function calculateBearing(startLat, startLng, destLat, destLng) {
            const startLatRad = startLat * (Math.PI / 180);
            const startLngRad = startLng * (Math.PI / 180);
            const destLatRad = destLat * (Math.PI / 180);
            const destLngRad = destLng * (Math.PI / 180);

            const y = Math.sin(destLngRad - startLngRad) * Math.cos(destLatRad);
            const x = Math.cos(startLatRad) * Math.sin(destLatRad) -
                Math.sin(startLatRad) * Math.cos(destLatRad) * Math.cos(destLngRad - startLngRad);

            let brng = Math.atan2(y, x);
            brng = brng * (180 / Math.PI);
            return (brng + 360) % 360;
        }

        function updateNavUI(mins, km, instruction) {
            document.getElementById('nav-eta').textContent = Math.ceil(mins);
            document.getElementById('nav-dist').textContent = km.toFixed(1);
            document.getElementById('nav-instruction').textContent = instruction;
        }

        function showSection(sectionId) {
            [loginSection, registerSection, dashboardSection].forEach(el => el.classList.add('hidden'));
            document.getElementById(sectionId).classList.remove('hidden');
        }

        // --- AUTH ---
        async function handleLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            if (!username || !password) return;
            loginMessage.textContent = 'Logging in...';
            try {
                const res = await fetchWithTimeout(`${API_BASE}/ambulances/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                if (res.ok) {
                    const data = await res.json();
                    setLoggedIn(data);
                } else if (res.status === 401) {
                    loginMessage.textContent = 'Invalid credentials.';
                    registerPrompt.classList.remove('hidden');
                } else {
                    throw new Error('Login failed');
                }
            } catch (err) {
                console.error(err);
                loginMessage.textContent = 'Error connecting.';
            }
        }

        function showRegister() { showSection('registerSection'); }

        async function handleRegister(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const payload = Object.fromEntries(formData.entries());
            ['latitude', 'longitude'].forEach(k => payload[k] = Number(payload[k]));
            try {
                const res = await fetchWithTimeout(`${API_BASE}/ambulances/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (res.ok) {
                    const data = await res.json();
                    setLoggedIn({ ...payload, ambulance_id: data.ambulance_id, status: 'IDLE' });
                } else {
                    const err = await res.json();
                    document.getElementById('registerMessage').textContent = err.error || 'Failed';
                }
            } catch (err) { console.error(err); }
        }

        function handleLogout() {
            currentAmbulance = null;
            showSection('loginSection');
        }

        function setLoggedIn(data) {
            currentAmbulance = data;
            document.getElementById('displayAmbulanceId').textContent = data.ambulance_id.substring(0, 8) + '...';
            document.getElementById('displayRegNum').textContent = data.registration_number || data.username || 'Unknown Ambulance';
            if (data.latitude) {
                document.getElementById('currentLat').value = data.latitude;
                document.getElementById('currentLng').value = data.longitude;
            } else {
                fetchDetails(data.ambulance_id);
            }
            renderLifecycleUI();
            showSection('dashboardSection');
        }

        async function fetchDetails(id) {
            try {
                const res = await fetchWithTimeout(`${API_BASE}/ambulances/${id}`);
                if (res.ok) {
                    const fullData = await res.json();
                    currentAmbulance = { ...currentAmbulance, ...fullData };
                    if (fullData.latitude) {
                        document.getElementById('currentLat').value = fullData.latitude;
                        document.getElementById('currentLng').value = fullData.longitude;
                    }
                    renderLifecycleUI();
                }
            } catch (e) { console.log('Fetch details failed', e); }
        }

        // --- LIFECYCLE MANAGEMENT ---
        function renderLifecycleUI() {
            const status = currentAmbulance.status || 'IDLE';
            document.getElementById('displayStatus').textContent = status;

            document.querySelectorAll('.lifecycle-view').forEach(el => el.classList.add('hidden'));
            const activeView = document.getElementById(`view-${status}`);
            if (activeView) {
                activeView.classList.remove('hidden');
            } else {
                const idleView = document.getElementById('view-IDLE');
                if (idleView) idleView.classList.remove('hidden');
                if (!document.getElementById('temp-reset-btn')) {
                    const btn = document.createElement('button');
                    btn.id = 'temp-reset-btn';
                    btn.textContent = `Reset Status from ${status} to IDLE`;
                    btn.onclick = () => updateStatus('IDLE');
                    btn.className = 'w-full bg-clinical-red hover:bg-clinical-red/90 text-white font-medium py-2 px-4 rounded-lg mt-4';
                    idleView.prepend(btn);
                }
            }

            if (status === 'HOSPITAL_SELECTED' || status === 'EN_ROUTE') {
                // Fetch and display active reservation details
                fetchActiveReservation();

                // Label will be updated by drawRouteToHospital when it fetches details
                document.getElementById('lbl-target-hospital').textContent = 'Loading...';
                setTimeout(() => {
                    initTargetMap('map'); // Was initMap()
                    map.invalidateSize();
                    drawRouteToHospital(currentAmbulance.assigned_hospital_id);
                }, 100);
            } else {
                // Hide reservation panel if not in active reservation state
                const panel = document.getElementById('reservation-info-panel');
                if (panel) panel.classList.add('hidden');
                if (reservationTimer) clearInterval(reservationTimer);
            }

            // Cleanup Navigation Mode if not EN_ROUTE
            if (status !== 'EN_ROUTE') {
                navigationMode = false;
                stopAnimation();
                document.getElementById('nav-panel').classList.add('hidden');
                if (map && routeLayer) {
                    // Check if we need to restore view or remove route?
                    // If we just arrived, we might want to see the map.
                    // But user said: "Remove route when arrived"
                    if (status === 'ARRIVED') {
                        if (routeLayer) map.removeLayer(routeLayer);
                        routeLayer = null;
                        map.setZoom(18); // Stay zoomed in
                    }
                }
            }

            // --- SOS Specific Handling ---
            if (status === 'IDLE') {
                startSOSPolling();
            } else {
                stopSOSPolling(); // Stop if not IDLE (e.g. assigned or offline)
                // However, we might want to keep the modal open if we just accepted? 
                // No, accept closes it. ignore closes it.
                // If status changes externally to something else, close it.
                if (!isSOSModalOpen) {
                    // Only auto-close if not interacting? 
                    // Actually, if status is not IDLE, we shouldn't be considering new SOS.
                    document.getElementById('sosModal').classList.add('hidden');
                }
            }

            if (status === 'EN_ROUTE_TO_PATIENT') {
                const reqIdSpan = document.getElementById('sos-req-id');
                if (reqIdSpan) reqIdSpan.textContent = currentAmbulance.current_request_id || 'Active';

                // Enable Navigation Mode for SOS
                // Delay to ensure the view div is fully visible before Leaflet renders
                setTimeout(() => {
                    drawRouteToPatient();
                }, 400);

                // üî¥ Start watching for patient-side cancellation
                const reqId = currentAmbulance.current_request_id;
                if (reqId) startSOSWatch(reqId);
            } else {
                // If we left EN_ROUTE_TO_PATIENT for any reason, stop the watch
                stopSOSWatch();
            }

            if (status === 'AT_PATIENT') {
                // Populate assessment form lat/lng with ambulance current location
                const lat = currentAmbulance.latitude;
                const lng = currentAmbulance.longitude;
                // Visible inputs (rich form)
                const latVis = document.getElementById('assessLatInput');
                const lngVis = document.getElementById('assessLngInput');
                if (latVis) latVis.value = lat || '';
                if (lngVis) lngVis.value = lng || '';
            }

            if (status === 'BREAKDOWN') {
                stopAnimation();
                stopSOSPolling();
                // If map exists, maybe show a "Broken" marker?
                // For now, the view-BREAKDOWN covers it.
            }


        }

        async function drawRouteToHospital(hospitalId) {
            if (animationInterval) clearInterval(animationInterval);
            if (!hospitalId || !currentAmbulance.latitude || !currentAmbulance.longitude) return;
            let endLat, endLng, hospName;
            try {
                const res = await fetch(`${API_BASE}/hospitals/${hospitalId}`);
                const h = await res.json();
                endLat = h.latitude;
                endLng = h.longitude;
                hospName = h.name;
                // Update the UI label with the real name
                const lbl = document.getElementById('lbl-target-hospital');
                if (lbl) lbl.textContent = hospName;
            } catch (e) { console.error(e); return; }

            if (routeLayer) map.removeLayer(routeLayer);
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            const startLat = currentAmbulance.latitude;
            const startLng = currentAmbulance.longitude;

            if (ambulanceMarker) map.removeLayer(ambulanceMarker);
            ambulanceMarker = L.marker([startLat, startLng], { icon: ambulanceIcon }).addTo(map).bindPopup("Ambulance");
            const endMarker = L.marker([endLat, endLng]).addTo(map).bindPopup(hospName || "Destination");
            markers.push(endMarker);

            const url = `https://router.project-osrm.org/route/v1/driving/${startLng},${startLat};${endLng},${endLat}?overview=full&geometries=geojson&steps=true`;
            try {
                const res = await fetchWithTimeout(url, { timeout: 6000 });
                const data = await res.json();
                if (data.routes && data.routes.length > 0) {
                    const route = data.routes[0];
                    const latLngs = route.geometry.coordinates.map(c => [c[1], c[0]]);
                    routeLayer = L.polyline(latLngs, { color: '#2563eb', weight: 5, opacity: 0.7 }).addTo(map);

                    if (currentAmbulance.status === 'EN_ROUTE') {
                        map.setView([startLat, startLng], 18);
                        startAnimation(route);
                    } else {
                        map.fitBounds(routeLayer.getBounds(), { padding: [50, 50] });
                    }
                }
            } catch (err) {
                console.error("Route fetch error (Hospital), using straight-line fallback:", err);

                // --- STRAIGHT LINE FALLBACK ---
                const p1 = [startLat, startLng];
                const p2 = [endLat, endLng];

                if (routeLayer) map.removeLayer(routeLayer);
                routeLayer = L.polyline([p1, p2], {
                    color: '#2563eb',
                    weight: 4,
                    dashArray: '10, 10',
                    opacity: 0.6
                }).addTo(map);

                const distMeters = map.distance(p1, p2);
                if (currentAmbulance.status === 'EN_ROUTE') {
                    map.setView(p1, 18);
                    const mockRoute = {
                        duration: (distMeters / 10) * 1.5,
                        distance: distMeters,
                        geometry: {
                            coordinates: [[startLng, startLat], [endLng, endLat]]
                        },
                        legs: [{ steps: [{ maneuver: { instruction: "Navigate to Hospital (Direct Route)" } }] }]
                    };
                    startAnimation(mockRoute);
                } else {
                    map.fitBounds([p1, p2], { padding: [50, 50] });
                }
            }
        }

        async function updateStatus(newStatus, extras = {}) {
            if (!currentAmbulance) return;
            try {
                // FIX: Always send current location to keep DB in sync
                const payload = {
                    new_status: newStatus,
                    latitude: currentAmbulance.latitude,
                    longitude: currentAmbulance.longitude,
                    ...extras
                };
                const res = await fetchWithTimeout(`${API_BASE}/ambulances/${currentAmbulance.ambulance_id}/status`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (res.ok) {
                    const data = await res.json();
                    currentAmbulance.status = data.status;
                    if (extras.assigned_hospital_id) currentAmbulance.assigned_hospital_id = extras.assigned_hospital_id;
                    renderLifecycleUI();
                } else {
                    const err = await res.json();
                    alert(`Status update failed: ${err.error}`);
                }
            } catch (e) {
                console.error("Status Update Error", e);
                alert("Network error updating status");
            }
        }

        async function cancelCase() {
            if (confirm("Are you sure you want to cancel the current case?")) {
                await updateStatus('CANCELLED');
            }
        }

        // --- DECISION ENGINE ---
        async function handleDecisionRequest(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const formEntries = Object.fromEntries(formData.entries());

            // Resolve bleeding boolean (hidden input stores 'true'/'false' string)
            const bleeding = formEntries.bleeding === 'true';
            const consciousnessLevel = formEntries.consciousness_level || 'ALERT';
            const severityLevel = Number(formEntries.severity_level) || 3;

            // 1. Create Persistent Case
            let caseId = null;
            try {
                document.getElementById('decisionMessage').textContent = 'Creating Case Record...';

                const casePayload = {
                    ambulance_id: currentAmbulance.ambulance_id,
                    consciousness_level: consciousnessLevel,
                    bleeding: bleeding,
                    injury_type: formEntries.injury_type || null,
                    injury_location: formEntries.injury_location || null,
                    mechanism_of_injury: formEntries.mechanism_of_injury || null,
                    severity_level: severityLevel,
                    requires_icu: !!formEntries.requires_icu,
                    requires_specialty: formEntries.requires_specialty || null
                };

                const caseRes = await fetchWithTimeout(`${API_BASE}/cases`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(casePayload)
                });

                if (!caseRes.ok) throw new Error("Failed to create case record");
                const caseData = await caseRes.json();
                caseId = caseData.case_id;

                // 2. Update Ambulance Status with connected Case ID
                await updateStatus('CASE_CREATED', { active_case_id: caseId });

                // Persist patient vitals on ambulance object for re-evaluation pre-fill
                currentAmbulance._lastSeverity = severityLevel;
                currentAmbulance._lastICU = !!formEntries.requires_icu;
                currentAmbulance._lastSpecialty = formEntries.requires_specialty || '';
                currentAmbulance._lastBleeding = bleeding;
                currentAmbulance._lastConsciousness = consciousnessLevel;

            } catch (err) {
                console.error("Case init failed", err);
                document.getElementById('decisionMessage').textContent = 'Error creating case: ' + err.message;
                return;
            }

            const payload = {
                request_id: crypto.randomUUID(),
                ambulance: {
                    ambulance_id: currentAmbulance.ambulance_id,
                    latitude: Number(formEntries.latitude),
                    longitude: Number(formEntries.longitude)
                },
                patient: {
                    consciousness_level: consciousnessLevel,
                    bleeding: bleeding,
                    injury_location: formEntries.injury_location || null,
                    mechanism_of_injury: formEntries.mechanism_of_injury || null,
                    severity_level: severityLevel,
                    requires_icu: !!formEntries.requires_icu,
                    requires_specialty: formEntries.requires_specialty || ''
                },
                constraints: {
                    max_distance_km: Number(formEntries.max_distance_km) || 15,
                    max_results: Number(formEntries.max_results) || 5
                }
            };

            document.getElementById('decisionMessage').textContent = 'Analyzing...';

            try {
                const res = await fetchWithTimeout(`${API_BASE}/agent/decide`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (res.ok) {
                    const data = await res.json();
                    document.getElementById('decisionMessage').textContent = '';
                    renderResults(data.recommendations);
                } else {
                    document.getElementById('decisionMessage').textContent = 'Error fetching decisions';
                    await updateStatus('IDLE');
                }
            } catch (err) {
                console.error(err);
                await updateStatus('IDLE');
            }
        }

        function renderResults(hospitals) {
            const tbody = document.querySelector('#resultsTable tbody');
            tbody.innerHTML = '';
            if (!hospitals.length) {
                tbody.innerHTML = '<tr><td colspan="7" class="p-6 text-center text-slate-500">No hospitals found. <button onclick="updateStatus(\'IDLE\')" class="text-clinical-blue underline">Back</button></td></tr>';
                return;
            }
            hospitals.forEach((h, index) => {
                const tr = document.createElement('tr');
                tr.className = index === 0 ? 'rank-1' : '';
                tr.innerHTML = `
                    <td class="text-center font-mono font-bold">#${index + 1}</td>
                    <td>
                        <strong class="text-white">${h.name || 'Hospital'}</strong>
                    </td>
                    <td>
                        <span class="font-mono text-clinical-blue">${h.distance_km.toFixed(2)} km</span><br>
                        <span class="text-xs text-slate-400">~${Math.round(h.eta_minutes)} mins</span>
                    </td>
                    <td class="font-mono font-bold text-clinical-blue">${h.score.toFixed(2)}</td>
                    <td>
                        <div class="text-xs">
                            <span class="text-slate-400">Beds:</span> ${h.snapshot.available_beds}<br>
                            <span class="text-slate-400">ICU:</span> ${h.snapshot.available_icu_beds}<br>
                            <span class="text-slate-400">Status:</span>
                            <span class="px-1.5 py-0.5 rounded-full text-[9px] font-medium
                                ${h.snapshot.status === 'NORMAL' ? 'bg-clinical-green/10 text-clinical-green' :
                        h.snapshot.status === 'CROWDED' ? 'bg-clinical-amber/10 text-clinical-amber' :
                            h.snapshot.status === 'OVERLOADED' ? 'bg-clinical-red/10 text-clinical-red' :
                                'bg-slate-700/50 text-slate-400'}">
                                ${h.snapshot.status}
                            </span>
                        </div>
                    </td>
                    <td>
                        <ul class="list-disc pl-4 text-xs text-slate-400" style="margin:0;">
                            ${h.reasons ? h.reasons.map(r => `<li>${r}</li>`).join('') : ''}
                        </ul>
                    </td>
                    <td class="text-right">
                        <button onclick="confirmSelection('${h.hospital_id}', '${h.name}')" 
                                class="bg-clinical-blue/10 hover:bg-clinical-blue text-clinical-blue hover:text-white border border-clinical-blue/30 font-medium py-1.5 px-4 rounded-lg transition-colors text-xs flex items-center justify-center gap-1.5 ml-auto">
                            <span>Select</span>
                            <i class="fa-solid fa-arrow-right"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function confirmSelection(hospitalId, hospitalName) {
            if (confirm(`Confirm selection of ${hospitalName}?`)) {
                await updateStatus('HOSPITAL_SELECTED', { assigned_hospital_id: hospitalId });
            }
        }

        // --- üÜï RESERVATION LOGIC ---
        let reservationTimer = null;

        async function fetchActiveReservation() {
            if (!currentAmbulance) return;
            try {
                // Fetch from new endpoint: /reservations/active/:ambulance_id
                const res = await fetchWithTimeout(`${API_BASE}/reservations/active/${currentAmbulance.ambulance_id}`);
                if (res.ok) {
                    const data = await res.json();
                    renderReservationPanel(data);
                } else {
                    // Hide panel if 404 or error
                    document.getElementById('reservation-info-panel').classList.add('hidden');
                }
            } catch (error) {
                console.error("Error fetching reservation:", error);
            }
        }

        function renderReservationPanel(data) {
            const panel = document.getElementById('reservation-info-panel');
            panel.classList.remove('hidden');

            document.getElementById('res-hospital-name').textContent = data.hospital_name || 'Unknown Hospital';
            document.getElementById('res-bed-type').textContent = data.bed_type;
            document.getElementById('res-id').textContent = data.reservation_id.substring(0, 8) + '...';

            // Set styles based on bed type
            const bedBadge = document.getElementById('res-bed-type');
            if (data.bed_type === 'ICU') {
                bedBadge.className = 'text-sm font-bold bg-clinical-red/20 text-clinical-red px-2 rounded border border-clinical-red/30';
            } else {
                bedBadge.className = 'text-sm font-mono bg-slate-800 px-2 rounded text-slate-300 border border-slate-700';
            }

            if (data.expires_at) {
                startReservationTimer(data.expires_at);
            } else {
                document.getElementById('res-timer').textContent = "---";
            }
        }

        function startReservationTimer(expiryTimestamp) {
            if (reservationTimer) clearInterval(reservationTimer);

            const expiryTime = new Date(expiryTimestamp).getTime();
            const timerEl = document.getElementById('res-timer');

            function update() {
                const now = new Date().getTime();
                const distance = expiryTime - now;

                if (distance < 0) {
                    clearInterval(reservationTimer);
                    timerEl.textContent = "EXPIRED";
                    timerEl.classList.add('text-clinical-red');

                    // Handle Expiry: Alert & Reset if not Arrived
                    // Only reset if we are not yet ARRIVED or PATIENT_ADMITTED
                    if (currentAmbulance.status === 'HOSPITAL_SELECTED' || currentAmbulance.status === 'EN_ROUTE') {
                        alert("‚ö†Ô∏è RESERVATION EXPIRED! Returning to IDLE.");
                        updateStatus('IDLE');
                    }
                    return;
                }

                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                timerEl.textContent = `${minutes}m ${seconds}s`;
                timerEl.classList.remove('text-clinical-red');
            }

            update(); // Initial call
            reservationTimer = setInterval(update, 1000);
        }
    </script>

    <!-- SOS LOGIC -->
    <script>
        let sosPollingInterval = null;
        let isSOSModalOpen = false;

        // --- SOS CANCELLATION WATCH (while en route to patient) ---
        let sosWatchInterval = null;

        function startSOSWatch(requestId) {
            if (sosWatchInterval) clearInterval(sosWatchInterval);
            sosWatchInterval = setInterval(async () => {
                if (!requestId || currentAmbulance.status !== 'EN_ROUTE_TO_PATIENT') {
                    stopSOSWatch(); return;
                }
                try {
                    const res = await fetchWithTimeout(`${API_BASE}/sos/${requestId}`);
                    if (!res.ok) return;
                    const data = await res.json();
                    // If patient cancelled  (or it was deleted / rejected)
                    if (data.request_status === 'CANCELLED' || data.request_status === 'COMPLETED') {
                        stopSOSWatch();
                        handleSOSCancelled(data.request_status);
                    }
                } catch (e) { console.warn('[SOS Watch] Poll error:', e); }
            }, 5000);
        }

        function stopSOSWatch() {
            if (sosWatchInterval) {
                clearInterval(sosWatchInterval);
                sosWatchInterval = null;
            }
        }

        async function handleSOSCancelled(reason) {
            // 1. Stop animation immediately
            stopAnimation();

            // 2. Clean up map
            if (map) {
                if (routeLayer) { map.removeLayer(routeLayer); routeLayer = null; }
                if (ambulanceMarker) { map.removeLayer(ambulanceMarker); ambulanceMarker = null; }
            }

            // 3. Hide nav panel
            navigationMode = false;
            document.getElementById('nav-panel').classList.add('hidden');

            // 4. Reset ambulance to IDLE on backend
            await updateStatus('IDLE');

            // 5. Show a toast to the driver
            const msg = reason === 'CANCELLED'
                ? 'üö´ SOS Cancelled ‚Äî Patient cancelled the request. Returning to standby.'
                : '‚úÖ SOS Resolved ‚Äî Request closed. Returning to standby.';
            showDriverToast(msg, reason === 'CANCELLED' ? 'amber' : 'green');
        }

        // Simple non-blocking toast for the ambulance driver
        function showDriverToast(message, color = 'amber') {
            const colors = {
                amber: { bg: '#d97706', shadow: 'rgba(217,119,6,0.5)' },
                green: { bg: '#16a34a', shadow: 'rgba(22,163,74,0.5)' },
                red: { bg: '#dc2626', shadow: 'rgba(220,38,38,0.5)' },
                blue: { bg: '#2563eb', shadow: 'rgba(37,99,235,0.5)' },
            };
            const c = colors[color] || colors.amber;
            const toast = document.createElement('div');
            toast.style.cssText = `
                position:fixed; top:72px; left:50%; transform:translateX(-50%);
                z-index:4000; background:${c.bg}; color:white;
                padding:0.75rem 1.75rem; border-radius:9999px;
                font-weight:700; font-size:0.82rem;
                display:flex; align-items:center; gap:0.6rem;
                box-shadow:0 8px 30px -5px ${c.shadow};
                white-space:nowrap; animation: slideInUp 0.25s ease;
                max-width: 90vw; white-space: normal; text-align:center;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 6000);
        }

        function startSOSPolling() {
            if (sosPollingInterval) return;
            // Poll every 5s
            sosPollingInterval = setInterval(checkForSOS, 5000);
        }

        function stopSOSPolling() {
            if (sosPollingInterval) {
                clearInterval(sosPollingInterval);
                sosPollingInterval = null;
            }
        }

        async function checkForSOS() {
            if (!currentAmbulance || currentAmbulance.status !== 'IDLE' || isSOSModalOpen) return;
            if (!currentAmbulance.latitude || !currentAmbulance.longitude) return;

            try {
                // Radius 100km for wide testing
                const res = await fetchWithTimeout(`${API_BASE}/sos/open?lat=${currentAmbulance.latitude}&lng=${currentAmbulance.longitude}&radius=100`);
                if (res.ok) {
                    const requests = await res.json();
                    if (requests.length > 0) {
                        // Pick first one
                        const req = requests[0];
                        showSOSModal(req);
                    }
                }
            } catch (e) { console.error("SOS Poll Error", e); }
        }

        function showSOSModal(req) {
            isSOSModalOpen = true; // Block further polling
            document.getElementById('sos-dist').textContent = req.distance.toFixed(2);
            document.getElementById('pending-sos-id').value = req.request_id;
            document.getElementById('pending-sos-lat').value = req.latitude;
            document.getElementById('pending-sos-lng').value = req.longitude;

            document.getElementById('sosModal').classList.remove('hidden');
        }

        function ignoreSOS() {
            document.getElementById('sosModal').classList.add('hidden');
            isSOSModalOpen = false;
            // Maybe wait a bit before polling again or ignore this ID specifically?
            // For simplicity, just close. It might pop up again in 5s if still there.
        }

        async function acceptSOS() {
            const reqId = document.getElementById('pending-sos-id').value;
            try {
                const res = await fetchWithTimeout(`${API_BASE}/sos/${reqId}/accept`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ambulance_id: currentAmbulance.ambulance_id })
                });

                if (res.ok) {
                    const data = await res.json();
                    document.getElementById('sosModal').classList.add('hidden');
                    isSOSModalOpen = false;

                    // Update local state implicitly or wait for status update
                    // The backend sets status to EN_ROUTE_TO_PATIENT. 
                    // We should re-fetch details or manually set it.
                    currentAmbulance.status = 'EN_ROUTE_TO_PATIENT';
                    currentAmbulance.current_request_id = reqId;

                    // Trigger UI update
                    renderLifecycleUI();

                } else {
                    const err = await res.json();
                    alert("Failed to accept: " + (err.error || "Unknown error"));
                    ignoreSOS();
                }
            } catch (e) {
                console.error(e);
                alert("Network error accepting SOS");
                ignoreSOS();
            }
        }

        // --- SOS VIEW HELPERS ---

        // Revised initMap to support dynamic target ID
        function initTargetMap(elemId) {
            // If map exists and container matches, just return map
            // If map exists but container different, remove map
            if (map) {
                if (map.getContainer().id === elemId) return; // Same container
                map.remove(); // Destroy old map instance to rebind
                map = null;
            }

            // Check if element exists
            if (!document.getElementById(elemId)) return;

            map = L.map(elemId).setView([17.385, 78.486], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);
        }

        async function drawRouteToPatient() {
            let targetLat = document.getElementById('pending-sos-lat')?.value;
            let targetLng = document.getElementById('pending-sos-lng')?.value;

            // Fallback: fetch from API if hidden inputs were lost (e.g. page reload)
            if ((!targetLat || !targetLng) && currentAmbulance.current_request_id) {
                try {
                    const r = await fetchWithTimeout(`${API_BASE}/sos/${currentAmbulance.current_request_id}`);
                    if (r.ok) {
                        const d = await r.json();
                        targetLat = d.latitude || d.patient_lat || d.user_lat;
                        targetLng = d.longitude || d.patient_lng || d.user_lng;
                    }
                } catch (e) { console.warn('Could not fetch SOS coords:', e); }
            }

            if (!targetLat || !targetLng) {
                console.warn('[SOS Map] No patient coordinates available ‚Äî map cannot render route.');
                return;
            }

            // Init map THEN force a size recalculation so Leaflet fills the visible div
            initTargetMap('map-sos');
            setTimeout(() => map && map.invalidateSize(), 50);

            const startLat = currentAmbulance.latitude;
            const startLng = currentAmbulance.longitude;

            if (ambulanceMarker) map.removeLayer(ambulanceMarker);
            ambulanceMarker = L.marker([startLat, startLng], { icon: ambulanceIcon })
                .addTo(map)
                .bindPopup('Your ambulance');

            L.marker([parseFloat(targetLat), parseFloat(targetLng)])
                .addTo(map)
                .bindPopup('Patient (SOS)')
                .openPopup();

            const url = `https://router.project-osrm.org/route/v1/driving/${startLng},${startLat};${targetLng},${targetLat}?overview=full&geometries=geojson&steps=true`;

            try {
                const res = await fetchWithTimeout(url, { timeout: 6000 });
                const data = await res.json();
                if (data.routes && data.routes.length > 0) {
                    const route = data.routes[0];
                    const latLngs = route.geometry.coordinates.map(c => [c[1], c[0]]);

                    if (routeLayer) map.removeLayer(routeLayer);
                    routeLayer = L.polyline(latLngs, {
                        color: '#dc2626',
                        weight: 5,
                        opacity: 0.9
                    }).addTo(map);

                    map.fitBounds(
                        [[startLat, startLng], [parseFloat(targetLat), parseFloat(targetLng)]],
                        { padding: [50, 50], maxZoom: 15 }
                    );

                    startAnimation(route);
                }
            } catch (e) {
                console.error('[SOS Route] OSRM Failed, using straight-line fallback:', e);

                // --- STRAIGHT LINE FALLBACK ---
                const p1 = [startLat, startLng];
                const p2 = [parseFloat(targetLat), parseFloat(targetLng)];

                if (routeLayer) map.removeLayer(routeLayer);
                routeLayer = L.polyline([p1, p2], {
                    color: '#dc2626',
                    weight: 4,
                    dashArray: '10, 10',
                    opacity: 0.7
                }).addTo(map);

                map.fitBounds([p1, p2], { padding: [50, 50] });

                // Create a mock route object for startAnimation
                const distMeters = map.distance(p1, p2);
                const mockRoute = {
                    duration: (distMeters / 10) * 1.5, // estimate
                    distance: distMeters,
                    geometry: {
                        coordinates: [[startLng, startLat], [parseFloat(targetLng), parseFloat(targetLat)]]
                    },
                    legs: [{ steps: [{ maneuver: { instruction: "Head toward patient (Direct Route)" } }] }]
                };
                startAnimation(mockRoute);
            }
        }

    </script>

    <!-- ========== ENHANCEMENT LAYER (Clock, Geolocation) ‚Äì ADDITIVE ========== -->
    <script>
        // ---------- ‚è∞ DIGITAL CLOCK ----------
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }
        setInterval(updateClock, 1000);
        updateClock();

        // ---------- üì° GEOLOCATION FOR REGISTER FORM ----------
        window.fillRegisterLocation = function () {
            const btn = document.querySelector('button[onclick="fillRegisterLocation()"]');
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> ACQUIRING...';
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    document.getElementById('reg_lat').value = pos.coords.latitude.toFixed(6);
                    document.getElementById('reg_lng').value = pos.coords.longitude.toFixed(6);
                    btn.innerHTML = '<i class="fa-solid fa-check"></i> LOCKED';
                    btn.classList.add('text-clinical-green');
                    setTimeout(() => {
                        btn.innerHTML = '<i class="fa-solid fa-satellite-dish"></i> Auto‚ÄëFix';
                        btn.classList.remove('text-clinical-green');
                    }, 2000);
                }, (err) => {
                    alert('GEOLOCATION ERROR: ' + err.message);
                    btn.innerHTML = '<i class="fa-solid fa-satellite-dish"></i> Auto‚ÄëFix';
                });
            } else {
                alert('GEOLOCATION NOT SUPPORTED');
                btn.innerHTML = '<i class="fa-solid fa-satellite-dish"></i> Auto‚ÄëFix';
            }
        };

        // ---------- üì° GEOLOCATION FOR DASHBOARD ----------
        window.getCurrentLocation = function () {
            if (!navigator.geolocation) { alert("Geolocation not supported."); return; }
            navigator.geolocation.getCurrentPosition((pos) => {
                document.getElementById('currentLat').value = pos.coords.latitude.toFixed(6);
                document.getElementById('currentLng').value = pos.coords.longitude.toFixed(6);
                if (currentAmbulance) {
                    currentAmbulance.latitude = pos.coords.latitude;
                    currentAmbulance.longitude = pos.coords.longitude;
                }
            }, (err) => {
                alert('Geolocation error: ' + err.message);
            });
        };

        // ‚îÄ‚îÄ AT_PATIENT form: location + voice wrappers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        window.getCurrentLocationAssess = function () {
            if (!navigator.geolocation) { alert("Geolocation not supported."); return; }
            navigator.geolocation.getCurrentPosition((pos) => {
                const latEl = document.getElementById('assessLatInput');
                const lngEl = document.getElementById('assessLngInput');
                if (latEl) latEl.value = pos.coords.latitude.toFixed(6);
                if (lngEl) lngEl.value = pos.coords.longitude.toFixed(6);
                // also sync the hidden fields used by handleDecisionRequest
                const hidLat = document.getElementById('assessLat');
                const hidLng = document.getElementById('assessLng');
                if (hidLat) hidLat.value = pos.coords.latitude.toFixed(6);
                if (hidLng) hidLng.value = pos.coords.longitude.toFixed(6);
            }, (err) => { alert('Geolocation error: ' + err.message); });
        };

        window.toggleVoiceRecordingAssess = function () {
            // Re-use core voice engine but redirect chip preview IDs to Assess panel
            _voiceTargetPrefix = 'assess';
            toggleVoiceRecording();
        };

        window.resetVoiceAndRerecordAssess = function () {
            _voiceTargetPrefix = 'assess';
            resetVoiceAndRerecord();
        };

        window.applyVoiceDataAssess = function () {
            const data = voiceParsedData;
            if (!data) return;
            const prefix = 'assess';
            if (data.consciousness) {
                selectAVPU(prefix, data.consciousness);
                flashField(document.getElementById(`${prefix}-avpu-group`));
            }
            if (data.bleeding) {
                const toggle = document.getElementById(`${prefix}-bleeding-toggle`);
                if (toggle && !toggle.classList.contains('on')) toggleBleeding(prefix);
                flashField(toggle);
                if (data.bleedingLocation) selectLocation(prefix, data.bleedingLocation);
            }
            if (data.severity) {
                const slider = document.getElementById(`${prefix}-severity`);
                if (slider) { slider.value = data.severity; updateEMTSeverity(prefix, data.severity); flashField(slider); }
            }
            if (data.moi) selectMOI(prefix, data.moi);
            if (data.condition) {
                const specMap = {
                    'Cardiac Emergency': 'Cardiology', 'Stroke / Neuro': 'Neurosurgery',
                    'Road Accident / Trauma': 'Trauma', 'Burns': 'Burns Unit',
                    'Fracture / Orthopedic': 'Orthopedics', 'Respiratory Distress': 'General Surgery',
                    'Poisoning / Overdose': 'General Surgery'
                };
                const spec = specMap[data.condition];
                if (spec) setSpecialty(prefix, spec);
            }
            if (data.consciousness === 'UNRESPONSIVE' || (data.severity && data.severity >= 4)) {
                const icu = document.getElementById(`${prefix}-icu`);
                if (icu && !icu.checked) {
                    icu.checked = true;
                    document.getElementById(`${prefix}-icu-badge`)?.classList.remove('hidden');
                }
            }
            const status = document.getElementById('voiceStatusAssess');
            if (status) { status.textContent = '‚úÖ Form filled! Review below and submit.'; status.className = 'voice-status success'; }
            document.getElementById('assessmentForm')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
        };

        // Patch voice chip rendering to support both 'dec' and 'assess' targets
        // _voiceTargetPrefix controls which panel the live chips update
        let _voiceTargetPrefix = 'dec';
        const _origUpdateChips = typeof updateVoiceChips === 'function' ? updateVoiceChips : null;
        function updateVoiceChipsPatched(data) {
            const p = _voiceTargetPrefix;
            const $ = id => document.getElementById(id);
            if ($(`vpConsciousness${p === 'dec' ? '' : 'Assess'}`)) {
                $(`vpConsciousness${p === 'dec' ? '' : 'Assess'}`).textContent = data.consciousness || '--';
                $(`vpBleeding${p === 'dec' ? '' : 'Assess'}`).textContent = data.bleeding ? 'Yes' : 'No';
                $(`vpSeverity${p === 'dec' ? '' : 'Assess'}`).textContent = data.severity ? `${data.severity}/5` : '--';
                $(`vpCondition${p === 'dec' ? '' : 'Assess'}`).textContent = data.condition || '--';
                const preview = document.getElementById(`voicePreview${p === 'dec' ? '' : 'Assess'}`);
                if (preview) preview.style.display = 'flex';
            }
        }
    </script>


    </div>

    <!-- BREAKDOWN LOGIC -->
    <script>
        async function simulateBreakdown() {
            if (!currentAmbulance) return;
            if (!confirm("‚ö† SIMULATE BREAKDOWN?\n\nThis will stop the ambulance, release current tasks, and trigger failover logic.")) return;

            // Capture current interpolated location if available
            let lat = currentAmbulance.latitude;
            let lng = currentAmbulance.longitude;

            if (ambulanceMarker) {
                const curPos = ambulanceMarker.getLatLng();
                lat = curPos.lat;
                lng = curPos.lng;
            }

            try {
                const res = await fetch(`${API_BASE}/ambulances/${currentAmbulance.ambulance_id}/breakdown`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ latitude: lat, longitude: lng })
                });

                if (res.ok) {
                    const data = await res.json();

                    // Update local state immediately to reflect new location
                    currentAmbulance.latitude = lat;
                    currentAmbulance.longitude = lng;

                    // Force a refresh to get new status
                    fetchDetails(currentAmbulance.ambulance_id);

                    if (data.breakdown_until) {
                        startBreakdownTimer(data.breakdown_until);
                    }
                } else {
                    alert("Failed to simulate breakdown.");
                }
            } catch (e) { console.error(e); }
        }

        let breakdownInterval = null;
        function startBreakdownTimer(untilStr) {
            if (breakdownInterval) clearInterval(breakdownInterval);
            const until = new Date(untilStr).getTime();

            const timerEl = document.getElementById('breakdown-timer');
            const iconEl = document.querySelector('#view-BREAKDOWN .fa-wrench');

            if (iconEl) iconEl.classList.add('fa-spin-pulse'); // Add animation

            function update() {
                const now = Date.now();
                const left = until - now;

                if (!timerEl) return;

                if (left <= 0) {
                    clearInterval(breakdownInterval);
                    timerEl.textContent = "SYSTEM RESTARTING...";
                    if (iconEl) iconEl.classList.remove('fa-spin-pulse');

                    // Poll for recovery confirmation
                    setTimeout(() => fetchDetails(currentAmbulance.ambulance_id), 2000);
                    return;
                }

                // Show seconds only for 30s timer
                const s = Math.ceil(left / 1000);
                timerEl.textContent = `REPAIRING: ${s}s`;
            }
            update();
            breakdownInterval = setInterval(update, 100);
        }
    </script>

    <!-- SOS ALERT MODAL -->
    <div id="sosModal"
        class="hidden fixed inset-0 z-[200] flex items-center justify-center bg-slate-950/80 backdrop-blur-sm p-4">
        <div
            class="bg-slate-900 border border-clinical-red/50 w-full max-w-sm rounded-xl shadow-2xl overflow-hidden animate-bounce-subtle">
            <div class="bg-clinical-red/20 p-4 border-b border-clinical-red/20 flex items-center justify-between">
                <h3 class="text-white font-bold flex items-center gap-2">
                    <span class="animate-pulse w-3 h-3 bg-clinical-red rounded-full"></span>
                    EMERGENCY ALERT
                </h3>
                <i class="fa-solid fa-tower-broadcast text-clinical-red animate-pulse"></i>
            </div>
            <div class="p-6 text-center space-y-4">
                <div
                    class="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto border border-clinical-red/30">
                    <i class="fa-solid fa-truck-medical text-3xl text-clinical-red"></i>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white">SOS Request Nearby</h4>
                    <p class="text-slate-400 text-sm mt-1">Distance: <span id="sos-dist"
                            class="text-white font-mono font-bold">--</span> km</p>
                </div>
                <div class="flex gap-3 pt-2">
                    <button onclick="ignoreSOS()"
                        class="flex-1 py-2.5 rounded-lg border border-slate-700 text-slate-400 hover:text-white hover:bg-slate-800 transition-colors">
                        Ignore
                    </button>
                    <button onclick="acceptSOS()"
                        class="flex-1 py-2.5 rounded-lg bg-clinical-red hover:bg-clinical-red/90 text-white font-bold shadow-lg shadow-clinical-red/20 transition-transform active:scale-95">
                        ACCEPT
                    </button>
                </div>
            </div>
            <!-- Hidden data storage -->
            <input type="hidden" id="pending-sos-id">
            <input type="hidden" id="pending-sos-lat">
            <input type="hidden" id="pending-sos-lng">
        </div>
    </div>
    <script>
        // Special handler to ensure we snap to patient location
        async function handleArrivalAtPatient() {
            // Snap to patient location available in hidden inputs or memory
            const lat = document.getElementById('pending-sos-lat').value;
            const lng = document.getElementById('pending-sos-lng').value;

            if (lat && lng) {
                currentAmbulance.latitude = parseFloat(lat);
                currentAmbulance.longitude = parseFloat(lng);

                // ALSO Move marker to exact spot visually
                if (ambulanceMarker) {
                    ambulanceMarker.setLatLng([lat, lng]);
                }
            }

            await updateStatus('AT_PATIENT');
        }
    </script>

    <!-- ================================================================
         üîÑ SEVERITY-AWARE MID-ROUTE RE-EVALUATION
         All HTML and JS below is additive ‚Äî nothing above is modified.
    ================================================================ -->

    <!-- ‚îÄ‚îÄ Severity Re-Evaluation Modal ‚îÄ‚îÄ -->
    <div id="reeval-modal" class="hidden reeval-overlay">
        <div class="reeval-card">
            <!-- Header -->
            <div class="flex items-center gap-3 mb-5">
                <div
                    class="w-10 h-10 rounded-full bg-clinical-blue/20 flex items-center justify-center border border-clinical-blue/30 flex-shrink-0">
                    <i class="fa-solid fa-rotate text-clinical-blue"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-base leading-tight">Severity Re-Evaluation</h2>
                    <p class="text-slate-400 text-xs mt-0.5">Using live ambulance position for new decision</p>
                </div>
            </div>

            <!-- Severity Display + Input -->
            <div class="mb-5 p-4 bg-slate-900/60 rounded-xl border border-white/5">
                <label
                    class="text-[10px] font-semibold text-slate-400 uppercase tracking-widest flex items-center gap-1 mb-3">
                    <i class="fa-solid fa-heart-pulse text-clinical-red"></i>
                    Patient Severity (1 = Minor ¬∑ 5 = Critical)
                </label>
                <div class="flex items-center gap-4">
                    <div id="reeval-severity-display" class="severity-display">3</div>
                    <input type="range" id="reeval-severity" min="1" max="5" value="3" step="1"
                        class="flex-1 h-2 rounded-full cursor-pointer accent-blue-600"
                        oninput="updateSeverityDisplay(this.value)">
                </div>
                <div class="flex justify-between text-[9px] text-slate-600 font-mono mt-1 px-1">
                    <span>1 Minor</span><span>2</span><span>3 Moderate</span><span>4</span><span>5 Critical</span>
                </div>
            </div>

            <!-- ICU Toggle -->
            <div class="flex items-center gap-3 p-3 bg-slate-900/50 rounded-lg border border-white/5 mb-6 cursor-pointer"
                onclick="document.getElementById('reeval-icu').click()">
                <input type="checkbox" id="reeval-icu"
                    class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-clinical-blue accent-blue-600 cursor-pointer flex-shrink-0">
                <div>
                    <label for="reeval-icu" class="text-sm font-medium text-white cursor-pointer">Requires ICU</label>
                    <p class="text-[10px] text-slate-500">Intensive care unit bed needed</p>
                </div>
                <div id="reeval-icu-badge"
                    class="ml-auto hidden text-[9px] font-bold bg-clinical-red/20 text-clinical-red px-2 py-0.5 rounded-full border border-clinical-red/30">
                    ICU</div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-3">
                <button onclick="closeReEvalModal()"
                    class="flex-1 py-2.5 rounded-lg border border-slate-700 text-slate-400 hover:text-white hover:bg-slate-800 transition-colors text-sm font-medium">
                    Cancel
                </button>
                <button id="reeval-submit-btn" onclick="runReEvaluation()"
                    class="flex-[2] py-2.5 rounded-lg bg-clinical-blue hover:bg-blue-700 text-white font-bold text-sm transition-colors flex items-center justify-center gap-2 shadow-lg shadow-clinical-blue/20">
                    <i class="fa-solid fa-magnifying-glass-location"></i>
                    Find Better Hospital
                </button>
            </div>

            <!-- Status message -->
            <div id="reeval-message" class="mt-3 text-center text-xs font-mono min-h-[18px] text-slate-400"></div>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ Reroute Confirmation Modal ‚îÄ‚îÄ -->
    <div id="reroute-confirm-modal" class="hidden reeval-overlay">
        <div class="reroute-card">
            <!-- Header -->
            <div class="text-center mb-5">
                <div
                    class="w-14 h-14 mx-auto rounded-full bg-clinical-green/20 flex items-center justify-center border border-clinical-green/30 mb-3">
                    <i class="fa-solid fa-hospital text-2xl text-clinical-green"></i>
                </div>
                <h2 class="text-white font-bold text-lg">Higher Capability Hospital Found</h2>
                <p class="text-slate-400 text-xs mt-1">A better match for the updated severity profile</p>
            </div>

            <!-- Hospital comparison -->
            <div class="grid grid-cols-2 gap-3 mb-5">
                <!-- Current -->
                <div class="p-3 bg-slate-900/60 rounded-lg border border-slate-700">
                    <div class="text-[9px] text-slate-500 uppercase tracking-widest font-bold mb-1">Current</div>
                    <div id="reroute-current-hospital" class="text-sm text-slate-300 font-medium truncate">---</div>
                    <div class="text-[10px] text-clinical-amber mt-1 font-mono">ACTIVE</div>
                </div>
                <!-- New -->
                <div class="p-3 bg-clinical-green/10 rounded-lg border border-clinical-green/30">
                    <div class="text-[9px] text-clinical-green uppercase tracking-widest font-bold mb-1">Recommended
                    </div>
                    <div id="reroute-new-hospital-name" class="text-sm text-white font-semibold truncate">---</div>
                    <div class="text-[10px] text-clinical-green mt-1 font-mono flex items-center gap-1">
                        <span class="w-1.5 h-1.5 bg-clinical-green rounded-full animate-pulse inline-block"></span>
                        BETTER MATCH
                    </div>
                </div>
            </div>

            <p class="text-center text-sm text-slate-300 mb-5 leading-relaxed">
                Transfer reservation and reroute ambulance?<br>
                <span class="text-[10px] text-slate-500 font-mono">Old reservation will be cancelled atomically.</span>
            </p>

            <!-- Action buttons -->
            <div class="flex gap-3">
                <button onclick="closeRerouteModal()"
                    class="flex-1 py-3 rounded-lg border border-slate-700 text-slate-400 hover:text-white hover:bg-slate-800 transition-colors font-medium text-sm">
                    Cancel
                </button>
                <button id="reroute-confirm-btn" onclick="confirmReroute()"
                    class="flex-[2] py-3 rounded-lg bg-clinical-green hover:bg-green-700 text-white font-bold text-sm transition-colors flex items-center justify-center gap-2 shadow-lg shadow-clinical-green/20">
                    <i class="fa-solid fa-route"></i> Confirm &amp; Reroute
                </button>
            </div>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ Adaptive Routing Flash Banner ‚îÄ‚îÄ -->
    <div id="reroute-banner" class="hidden">
        <i class="fa-solid fa-route fa-shake" style="color: white;"></i>
        Destination Updated ‚Äî Adaptive Routing Activated
        <span id="reroute-eta-display" class="ml-2 text-green-200 font-mono text-xs font-normal"></span>
    </div>

    <!-- ‚îÄ‚îÄ Re-Evaluation JavaScript ‚îÄ‚îÄ -->
    <script>
        // ----------------------------------------------------------------
        // üîÑ SEVERITY-AWARE MID-ROUTE RE-EVALUATION
        // Only fires when status === 'EN_ROUTE'. Never modifies allowedTransitions.
        // ----------------------------------------------------------------

        let pendingNewHospitalId = null;
        let pendingNewHospitalName = null;

        /** Update the severity circle display as the slider moves */
        function updateSeverityDisplay(val) {
            const display = document.getElementById('reeval-severity-display');
            display.textContent = val;
            const colors = { 1: '#16a34a', 2: '#65a30d', 3: '#d97706', 4: '#ea580c', 5: '#dc2626' };
            const borders = { 1: 'rgba(22,163,74,0.5)', 2: 'rgba(101,163,13,0.5)', 3: 'rgba(217,119,6,0.5)', 4: 'rgba(234,88,12,0.5)', 5: 'rgba(220,38,38,0.5)' };
            display.style.color = colors[val];
            display.style.borderColor = borders[val];
            display.style.background = colors[val] + '1a'; // 10% opacity hex
        }

        /** ICU badge toggle */
        document.getElementById('reeval-icu').addEventListener('change', function () {
            const badge = document.getElementById('reeval-icu-badge');
            badge.classList.toggle('hidden', !this.checked);
        });

        /** Opens the modal, pre-fills severity from current case */
        function openReEvalModal() {
            if (!currentAmbulance || currentAmbulance.status !== 'EN_ROUTE') return;

            // Pre-fill severity from active case or default 3
            const savedSeverity = currentAmbulance._lastSeverity || 3;
            const savedICU = currentAmbulance._lastICU || false;

            const slider = document.getElementById('reeval-severity');
            slider.value = savedSeverity;
            updateSeverityDisplay(savedSeverity);

            const icuCheck = document.getElementById('reeval-icu');
            icuCheck.checked = savedICU;
            document.getElementById('reeval-icu-badge').classList.toggle('hidden', !savedICU);

            document.getElementById('reeval-message').textContent = '';
            const btn = document.getElementById('reeval-submit-btn');
            btn.disabled = false;
            btn.innerHTML = '<i class="fa-solid fa-magnifying-glass-location"></i> Find Better Hospital';

            document.getElementById('reeval-modal').classList.remove('hidden');
        }

        function closeReEvalModal() {
            document.getElementById('reeval-modal').classList.add('hidden');
        }

        function closeRerouteModal() {
            document.getElementById('reroute-confirm-modal').classList.add('hidden');
        }

        /** Steps A ‚Äì D: get live location ‚Üí call /agent/decide ‚Üí compare */
        async function runReEvaluation() {
            const btn = document.getElementById('reeval-submit-btn');
            const msgEl = document.getElementById('reeval-message');

            // Disable button to prevent double-click
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Analyzing...';
            msgEl.textContent = 'Calling decision engine‚Ä¶';

            // ‚îÄ‚îÄ Step A: Get live position ‚îÄ‚îÄ
            let liveLat, liveLng;
            if (ambulanceMarker) {
                const pos = ambulanceMarker.getLatLng();
                liveLat = pos.lat;
                liveLng = pos.lng;
            } else {
                liveLat = currentAmbulance.latitude;
                liveLng = currentAmbulance.longitude;
            }

            // ‚îÄ‚îÄ Step B: Read form values ‚îÄ‚îÄ
            const newSeverity = parseInt(document.getElementById('reeval-severity').value, 10);
            const requiresICU = document.getElementById('reeval-icu').checked;

            // Persist for next open
            currentAmbulance._lastSeverity = newSeverity;
            currentAmbulance._lastICU = requiresICU;

            // ‚îÄ‚îÄ Step C: Call /agent/decide ‚îÄ‚îÄ
            const payload = {
                request_id: crypto.randomUUID(),
                ambulance: {
                    ambulance_id: currentAmbulance.ambulance_id,
                    latitude: liveLat,
                    longitude: liveLng
                },
                patient: {
                    severity_level: newSeverity,
                    requires_icu: requiresICU,
                    age: currentAmbulance._lastAge || 30,
                    requires_specialty: currentAmbulance._lastSpecialty || ''
                },
                constraints: {
                    max_distance_km: 20,
                    max_results: 5
                }
            };

            try {
                const res = await fetch(`${API_BASE}/agent/decide`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!res.ok) {
                    msgEl.textContent = '‚ö† Decision engine error ‚Äî try again';
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fa-solid fa-magnifying-glass-location"></i> Find Better Hospital';
                    return;
                }

                const data = await res.json();
                const recs = data.recommendations || [];

                if (!recs.length) {
                    msgEl.textContent = '‚ö† No hospitals found in range.';
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fa-solid fa-magnifying-glass-location"></i> Retry';
                    return;
                }

                closeReEvalModal();

                // ‚îÄ‚îÄ Step D: Compare top recommendation ‚îÄ‚îÄ
                const topHospital = recs[0];
                const newHospId = topHospital.hospital_id;
                const currentHospId = currentAmbulance.assigned_hospital_id;

                if (newHospId === currentHospId) {
                    // Same hospital ‚Äî inform user
                    setTimeout(() => {
                        showOptimalAlert(topHospital.name || 'Current destination');
                    }, 200);
                    return;
                }

                // Different hospital ‚Äî show reroute confirmation
                pendingNewHospitalId = newHospId;
                pendingNewHospitalName = topHospital.name || 'New Hospital';

                // Populate confirmation modal
                // Try to get current hospital name from label
                const currentLbl = document.getElementById('lbl-target-hospital');
                document.getElementById('reroute-current-hospital').textContent =
                    (currentLbl && currentLbl.textContent !== 'Loading...')
                        ? currentLbl.textContent : 'Current Destination';

                document.getElementById('reroute-new-hospital-name').textContent = pendingNewHospitalName;

                const confirmBtn = document.getElementById('reroute-confirm-btn');
                confirmBtn.disabled = false;
                confirmBtn.innerHTML = '<i class="fa-solid fa-route"></i> Confirm &amp; Reroute';

                document.getElementById('reroute-confirm-modal').classList.remove('hidden');

            } catch (err) {
                console.error('Re-evaluation error:', err);
                msgEl.textContent = '‚ö† Network error ‚Äî check connection';
                btn.disabled = false;
                btn.innerHTML = '<i class="fa-solid fa-magnifying-glass-location"></i> Find Better Hospital';
            }
        }

        /** Shows a non-blocking "already optimal" notification */
        function showOptimalAlert(hospitalName) {
            const banner = document.createElement('div');
            banner.style.cssText = `
                position:fixed; top:72px; left:50%; transform:translateX(-50%);
                z-index:3000; background:linear-gradient(90deg,#2563eb,#1d4ed8);
                color:white; padding:0.75rem 2rem; border-radius:9999px;
                font-weight:700; font-size:0.85rem; display:flex;
                align-items:center; gap:0.75rem;
                box-shadow:0 8px 30px -5px rgba(37,99,235,0.6);
                white-space:nowrap; animation: slideInUp 0.25s ease;
            `;
            banner.innerHTML = `<i class="fa-solid fa-circle-check"></i> Current hospital still optimal &mdash; ${hospitalName}`;
            document.body.appendChild(banner);
            setTimeout(() => banner.remove(), 4000);
        }

        /**
         * Step E ‚Äî Confirm reroute.
         *
         * Backend allowedTransitions:
         *   EN_ROUTE ‚Üí CANCELLED ‚Üí IDLE ‚Üí CASE_CREATED ‚Üí HOSPITAL_SELECTED ‚Üí EN_ROUTE
         *
         * Intermediate steps use silentStatus() (no UI re-render) to avoid flicker.
         * Only the final EN_ROUTE uses updateStatus() to trigger drawRouteToHospital.
         *
         * CANCELLED clears active_case_id in the DB, so we capture it first and
         * restore it via the CASE_CREATED step.
         */
        async function confirmReroute() {
            const btn = document.getElementById('reroute-confirm-btn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Transferring‚Ä¶';

            closeRerouteModal();

            // Capture live position NOW (marker may still be animating)
            if (ambulanceMarker) {
                const livePos = ambulanceMarker.getLatLng();
                currentAmbulance.latitude = livePos.lat;
                currentAmbulance.longitude = livePos.lng;
            }

            const newHospId = pendingNewHospitalId;
            const newHospName = pendingNewHospitalName;

            // Save case ID before CANCELLED wipes it from DB
            const savedCaseId = currentAmbulance.active_case_id;

            /**
             * silentStatus ‚Äî POST /ambulances/:id/status without triggering renderLifecycleUI.
             * Used for intermediate transitions to avoid UI flash/map reset.
             */
            async function silentStatus(newStatus, extras = {}) {
                const payload = {
                    new_status: newStatus,
                    latitude: currentAmbulance.latitude,
                    longitude: currentAmbulance.longitude,
                    ...extras
                };
                const res = await fetch(`${API_BASE}/ambulances/${currentAmbulance.ambulance_id}/status`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.error || `Status ${newStatus} failed`);
                }
                const data = await res.json();
                // Keep local state in sync without calling renderLifecycleUI
                currentAmbulance.status = data.status;
                if (extras.assigned_hospital_id) currentAmbulance.assigned_hospital_id = extras.assigned_hospital_id;
                if (extras.active_case_id) currentAmbulance.active_case_id = extras.active_case_id;
                return data;
            }

            try {
                // 1Ô∏è‚É£ Cancel old reservation (EN_ROUTE ‚Üí CANCELLED is allowed)
                await silentStatus('CANCELLED');

                // 2Ô∏è‚É£ Return to IDLE (CANCELLED ‚Üí IDLE is the only allowed next step)
                await silentStatus('IDLE');

                // 3Ô∏è‚É£ Restore case (IDLE ‚Üí CASE_CREATED), re-attach the saved case_id
                if (savedCaseId) {
                    await silentStatus('CASE_CREATED', { active_case_id: savedCaseId });
                } else {
                    // No case ID (edge case) ‚Äî skip CASE_CREATED; HOSPITAL_SELECTED will fail,
                    // so surface an error early rather than continue silently.
                    throw new Error('No active case ID found ‚Äî cannot re-select hospital without a case.');
                }

                // 4Ô∏è‚É£ Select new hospital (CASE_CREATED ‚Üí HOSPITAL_SELECTED)
                await silentStatus('HOSPITAL_SELECTED', { assigned_hospital_id: newHospId });

                // 5Ô∏è‚É£ Go EN_ROUTE ‚Äî this triggers renderLifecycleUI + drawRouteToHospital
                //    from the live position captured at the top of this function.
                await updateStatus('EN_ROUTE');

                // Flash banner + route color effect
                showRerouteBanner(newHospName);

            } catch (err) {
                console.error('Reroute sequence failed:', err);
                alert(`Reroute failed: ${err.message}\n\nThe ambulance may be in an intermediate state. Please check status and reset if needed.`);
            }

            pendingNewHospitalId = null;
            pendingNewHospitalName = null;
        }

        /**
         * Shows the "Destination Updated" flash banner.
         * Starts green, transitions to clinical blue after 1.5s, then hides.
         * Also briefly flashes the route polyline green.
         */
        function showRerouteBanner(hospitalName) {
            const banner = document.getElementById('reroute-banner');
            const etaEl = document.getElementById('reroute-eta-display');

            // Fetch current ETA from nav panel for display
            const etaText = document.getElementById('nav-eta').textContent;
            etaEl.textContent = etaText && etaText !== '--' ? `¬∑ New ETA: ~${etaText} min` : '';

            // Show banner (green)
            banner.classList.remove('hidden', 'banner-blue');
            banner.style.display = 'flex'; // Override if hidden class used display:none

            // Flash route layer green briefly
            if (routeLayer) {
                routeLayer.setStyle({ color: '#16a34a', weight: 6 });
                setTimeout(() => {
                    if (routeLayer) routeLayer.setStyle({ color: '#2563eb', weight: 5 });
                }, 1500);
            }

            // Transition banner to blue after 1.5s
            setTimeout(() => banner.classList.add('banner-blue'), 1500);

            // Hide banner after 5s
            setTimeout(() => {
                banner.classList.add('hidden');
                banner.classList.remove('banner-blue');
                banner.style.display = '';
            }, 5000);
        }

        // Close modals on overlay click
        document.getElementById('reeval-modal').addEventListener('click', function (e) {
            if (e.target === this) closeReEvalModal();
        });
        document.getElementById('reroute-confirm-modal').addEventListener('click', function (e) {
            if (e.target === this) closeRerouteModal();
        });

        // Close modals on Escape key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                closeReEvalModal();
                closeRerouteModal();
            }
        });
        /**
         * runTriageUpload ‚Äî sends the selected image to the local triage_service.py
         * (running on port 5001) and auto-fills the patient form fields with the
         * Gemini-extracted values.
         *
         * @param {HTMLInputElement} inputEl   The file input that fired onchange
         * @param {string}           formId    'assessmentForm' or 'decisionForm'
         */
        async function runTriageUpload(inputEl, formId) {
            const file = inputEl.files[0];
            if (!file) return;

            // Derive the status/badge element suffix from the input id
            //   triageImg-assess  ‚Üí  assess
            //   triageImg-decision ‚Üí decision
            const suffix = inputEl.id.replace('triageImg-', '');
            const statusEl = document.getElementById(`triage-status-${suffix}`);
            const badgeEl = document.getElementById(`triage-badge-${suffix}`);
            const form = document.getElementById(formId);

            // ‚îÄ‚îÄ UI: Loading state ‚îÄ‚îÄ
            statusEl.textContent = '‚è≥ Analysing image‚Ä¶';
            badgeEl.className = 'triage-badge hidden';

            const formData = new FormData();
            formData.append('image', file);

            try {
                const res = await fetch('http://localhost:5001/triage', {
                    method: 'POST',
                    body: formData
                });

                if (!res.ok) {
                    const err = await res.json().catch(() => ({}));
                    statusEl.textContent = `‚ö† Triage error: ${err.error || res.statusText}`;
                    return;
                }

                const data = await res.json();

                // ‚îÄ‚îÄ Auto-fill form fields ‚îÄ‚îÄ
                // ‚îÄ‚îÄ Auto-fill EMT form fields from AI scan data ‚îÄ‚îÄ
                // Derive the form prefix from formId
                const prefix = formId === 'decisionForm' ? 'dec' : 'assess';

                // AVPU Consciousness
                if (data.consciousness_level) {
                    selectAVPU(prefix, data.consciousness_level.toUpperCase());
                }

                // Bleeding toggle
                if (data.bleeding === true) {
                    const toggle = document.getElementById(`${prefix}-bleeding-toggle`);
                    if (toggle && !toggle.classList.contains('on')) toggleBleeding(prefix);
                } else if (data.bleeding === false) {
                    const toggle = document.getElementById(`${prefix}-bleeding-toggle`);
                    if (toggle && toggle.classList.contains('on')) toggleBleeding(prefix);
                }

                // Injury location (if AI returned it)
                if (data.injury_location) {
                    selectLocation(prefix, data.injury_location.toLowerCase());
                }

                // Mechanism of injury
                if (data.mechanism_of_injury) {
                    selectMOI(prefix, data.mechanism_of_injury.toLowerCase());
                }

                // Injury type ‚Üí hidden field
                if (data.injury_type) {
                    const injEl = form.querySelector('[name="injury_type"]');
                    if (injEl) injEl.value = data.injury_type;
                }

                // Severity slider
                if (data.severity_level != null) {
                    const sev = parseInt(data.severity_level);
                    updateEMTSeverity(prefix, sev);
                    const slider = document.getElementById(`${prefix}-severity`);
                    if (slider) slider.value = sev;
                    // Auto-check ICU for severity >= 4
                    if (sev >= 4) {
                        const icuEl = document.getElementById(`${prefix}-icu`);
                        if (icuEl) { icuEl.checked = true; document.getElementById(`${prefix}-icu-badge`)?.classList.remove('hidden'); }
                    }
                }

                // ICU
                if (data.requires_icu === true) {
                    const icuEl = document.getElementById(`${prefix}-icu`);
                    if (icuEl) { icuEl.checked = true; document.getElementById(`${prefix}-icu-badge`)?.classList.remove('hidden'); }
                }

                // Specialty
                if (data.requires_specialty) {
                    const spEl = document.getElementById(`${prefix}-specialty`);
                    if (spEl) setSpecialty(prefix, data.requires_specialty);
                }

                // ‚îÄ‚îÄ Triage badge ‚îÄ‚îÄ
                const cat = (data.triage_category || '').toLowerCase();
                if (cat) {
                    badgeEl.textContent = `‚óè ${(data.triage_category || '').toUpperCase()}`;
                    badgeEl.className = `triage-badge triage-${cat}`;
                }

                const filled = [
                    data.consciousness_level && `AVPU:${data.consciousness_level}`,
                    data.bleeding != null && (data.bleeding ? 'ü©∏ Bleeding' : '‚úì No Bleed'),
                    data.severity_level != null && `Sev ${data.severity_level}`,
                    data.requires_icu && 'ICU',
                    data.requires_specialty && data.requires_specialty
                ].filter(Boolean).join(' ¬∑ ');

                statusEl.textContent = filled ? `‚úì AI filled: ${filled}` : '‚úì Done (no fields extracted)';

            } catch (e) {
                console.error('Triage upload error:', e);
                statusEl.textContent = '‚ö† Could not reach triage service (is it running on :5001?)';
            }

            // Reset so the same file can be re-selected if needed
            inputEl.value = '';
        }

        // =====================================================
        // EMT Form UI Helpers
        // =====================================================

        /** Select an AVPU button and update the hidden input */
        function selectAVPU(prefix, level) {
            const group = document.getElementById(`${prefix}-avpu-group`);
            if (!group) return;
            const levelLower = level.toLowerCase();
            group.querySelectorAll('.avpu-btn').forEach(btn => {
                btn.className = 'avpu-btn'; // reset
                if (btn.dataset.avpu === level) {
                    btn.classList.add(`active-${levelLower}`);
                }
            });
            const hidden = document.getElementById(`${prefix}-consciousness`);
            if (hidden) hidden.value = level;

            // Auto-check ICU if UNRESPONSIVE
            if (level === 'UNRESPONSIVE') {
                const icuEl = document.getElementById(`${prefix}-icu`);
                if (icuEl && !icuEl.checked) {
                    icuEl.checked = true;
                    document.getElementById(`${prefix}-icu-badge`)?.classList.remove('hidden');
                }
            }
        }

        /** Toggle bleeding state and show/hide conditional fields */
        function toggleBleeding(prefix) {
            const toggle = document.getElementById(`${prefix}-bleeding-toggle`);
            const valEl = document.getElementById(`${prefix}-bleeding-val`);
            const icon = document.getElementById(`${prefix}-bleed-icon`);
            const locSec = document.getElementById(`${prefix}-location-section`);
            const moiSec = document.getElementById(`${prefix}-moi-section`);

            const isOn = toggle.classList.toggle('on');
            if (valEl) valEl.value = isOn ? 'true' : 'false';
            if (icon) icon.className = isOn ? 'fa-solid fa-droplet ml-auto text-clinical-red' : 'fa-solid fa-droplet ml-auto text-slate-600';
            if (locSec) locSec.classList.toggle('hidden', !isOn);
            if (moiSec) moiSec.classList.toggle('hidden', isOn);
        }

        /** Select a location grid button */
        function selectLocation(prefix, loc) {
            const locSec = document.getElementById(`${prefix}-location-section`);
            if (!locSec) return;
            locSec.querySelectorAll('.loc-btn').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.loc === loc);
            });
            const hidden = document.getElementById(`${prefix}-injury-location`);
            if (hidden) hidden.value = loc;
        }

        /** Select a mechanism-of-injury grid button */
        function selectMOI(prefix, moi) {
            const moiSec = document.getElementById(`${prefix}-moi-section`);
            if (!moiSec) return;
            moiSec.querySelectorAll('.moi-btn').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.moi === moi);
            });
            const hidden = document.getElementById(`${prefix}-moi`);
            if (hidden) hidden.value = moi;
        }

        /** Update severity display circle colour */
        function updateEMTSeverity(prefix, val) {
            const display = document.getElementById(`${prefix}-sev-display`);
            if (!display) return;
            const colors = { 1: '#16a34a', 2: '#65a30d', 3: '#d97706', 4: '#ea580c', 5: '#dc2626' };
            const borders = { 1: 'rgba(22,163,74,0.5)', 2: 'rgba(101,163,13,0.5)', 3: 'rgba(217,119,6,0.5)', 4: 'rgba(234,88,12,0.5)', 5: 'rgba(220,38,38,0.5)' };
            display.textContent = val;
            display.style.color = colors[val] || '#2563eb';
            display.style.borderColor = borders[val] || 'rgba(37,99,235,0.5)';
            display.style.background = (colors[val] || '#2563eb') + '1a';
            // Auto-check ICU for severity >= 4
            if (Number(val) >= 4) {
                const icuEl = document.getElementById(`${prefix}-icu`);
                if (icuEl && !icuEl.checked) {
                    icuEl.checked = true;
                    document.getElementById(`${prefix}-icu-badge`)?.classList.remove('hidden');
                }
            }
        }

        /** Set specialty chip ‚Äî updates the text input and focuses it */
        function setSpecialty(prefix, value) {
            const el = document.getElementById(`${prefix}-specialty`);
            if (el) el.value = value;
        }

        // (Voice JS engine moved to multi-language section below)

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MULTI-LANGUAGE i18n ENGINE (FULL TRANSLATION)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Full text map: maps every English string in the UI to translations.
        // Keys = exact English text (trimmed). Values = translated text.
        const FULL_TEXT_MAP = {
            te: {
                // Header
                'Ambulance Dispatch Interface': '‡∞Ö‡∞Ç‡∞¨‡±Å‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç ‡∞°‡∞ø‡∞∏‡±ç‡∞™‡∞æ‡∞ö‡±ç ‡∞á‡∞Ç‡∞ü‡∞∞‡±ç‚Äå‡∞´‡±á‡∞∏‡±ç',
                'SYSTEM ONLINE': '‡∞∏‡∞ø‡∞∏‡±ç‡∞ü‡∞Æ‡±ç ‡∞Ü‡∞®‡±ç‚Äå‡∞≤‡±à‡∞®‡±ç',
                'EMS READY': 'EMS ‡∞∏‡∞ø‡∞¶‡±ç‡∞ß‡∞Ç‡∞ó‡∞æ ‡∞â‡∞Ç‡∞¶‡∞ø',
                'LOCAL TIME': '‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞∏‡∞Æ‡∞Ø‡∞Ç',
                // Nav panel
                'LIVE NAVIGATION': '‡∞≤‡±à‡∞µ‡±ç ‡∞®‡∞æ‡∞µ‡∞ø‡∞ó‡±á‡∞∑‡∞®‡±ç',
                'MIN': '‡∞®‡∞ø‡∞Æ‡∞ø',
                'KM': '‡∞ï‡∞ø.‡∞Æ‡±Ä.',
                'Calculating route...': '‡∞∞‡±Ç‡∞ü‡±ç ‡∞≤‡±Ü‡∞ï‡±ç‡∞ï‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞Ç...',
                // Login
                'Ambulance Login': '‡∞Ö‡∞Ç‡∞¨‡±Å‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç',
                'Enter credentials to access dispatch': '‡∞°‡∞ø‡∞∏‡±ç‡∞™‡∞æ‡∞ö‡±ç ‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡±Ü‡∞∏‡±ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø',
                'Username': '‡∞Ø‡±Ç‡∞ú‡∞∞‡±ç ‡∞™‡±á‡∞∞‡±Å',
                'Password': '‡∞™‡∞æ‡∞∏‡±ç‚Äå‡∞µ‡∞∞‡±ç‡∞°‡±ç',
                'Login': '‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç',
                'Register New Ambulance': '‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞Ö‡∞Ç‡∞¨‡±Å‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç ‡∞®‡∞Æ‡±ã‡∞¶‡±Å',
                'Enter Username': '‡∞Ø‡±Ç‡∞ú‡∞∞‡±ç ‡∞™‡±á‡∞∞‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø',
                'Enter Password': '‡∞™‡∞æ‡∞∏‡±ç‚Äå‡∞µ‡∞∞‡±ç‡∞°‡±ç ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø',
                // Register
                'Register Ambulance': '‡∞Ö‡∞Ç‡∞¨‡±Å‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç ‡∞®‡∞Æ‡±ã‡∞¶‡±Å',
                'Registration Number': '‡∞∞‡∞ø‡∞ú‡∞ø‡∞∏‡±ç‡∞ü‡±ç‡∞∞‡±á‡∞∑‡∞®‡±ç ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç',
                'Organization': '‡∞∏‡∞Ç‡∞∏‡±ç‡∞•',
                'GPS Coordinates': 'GPS ‡∞ï‡±ã‡∞Ü‡∞∞‡±ç‡∞°‡∞ø‡∞®‡±á‡∞ü‡±ç‡∞≤‡±Å',
                'Auto‚ÄëFix': '‡∞Ü‡∞ü‡±ã-‡∞´‡∞ø‡∞ï‡±ç‡∞∏‡±ç',
                'Register & Login': '‡∞®‡∞Æ‡±ã‡∞¶‡±Å & ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç',
                // Dashboard / asset card
                'Registration / Name': '‡∞∞‡∞ø‡∞ú‡∞ø‡∞∏‡±ç‡∞ü‡±ç‡∞∞‡±á‡∞∑‡∞®‡±ç / ‡∞™‡±á‡∞∞‡±Å',
                'ID:': 'ID:',
                'IDLE': '‡∞®‡∞ø‡∞∑‡±ç‡∞ï‡±ç‡∞∞‡∞ø‡∞Ø',
                'Logout': '‡∞≤‡∞æ‡∞ó‡±ç ‡∞Ö‡∞µ‡±Å‡∞ü‡±ç',
                'Simulate Breakdown': '‡∞¨‡±ç‡∞∞‡±á‡∞ï‡±ç‚Äå‡∞°‡±å‡∞®‡±ç ‡∞Ö‡∞®‡±Å‡∞ï‡∞∞‡∞£',
                'Active Reservation': '‡∞∏‡∞ï‡±ç‡∞∞‡∞ø‡∞Ø ‡∞∞‡∞ø‡∞ú‡∞∞‡±ç‡∞µ‡±á‡∞∑‡∞®‡±ç',
                'Expires In': '‡∞ó‡∞°‡±Å‡∞µ‡±Å',
                // SOS view
                'EMERGENCY RESPONSE: EN ROUTE TO PATIENT': '‡∞Ö‡∞§‡±ç‡∞Ø‡∞µ‡∞∏‡∞∞ ‡∞∏‡±ç‡∞™‡∞Ç‡∞¶‡∞®: ‡∞∞‡±ã‡∞ó‡∞ø ‡∞µ‡∞¶‡±ç‡∞¶‡∞ï‡±Å ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞Ç‡∞≤‡±ã',
                'Responding to SOS': 'SOS ‡∞ï‡∞ø ‡∞∏‡±ç‡∞™‡∞Ç‡∞¶‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞Ç',
                'Request ID:': '‡∞Ö‡∞≠‡±ç‡∞Ø‡∞∞‡±ç‡∞•‡∞® ID:',
                'ARRIVED AT SCENE': '‡∞∏‡±Ä‡∞®‡±ç ‡∞µ‡∞¶‡±ç‡∞¶ ‡∞ö‡±á‡∞∞‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å',
                // Assessment
                'Patient Assessment': '‡∞∞‡±ã‡∞ó‡∞ø ‡∞Ö‡∞∏‡±Ü‡∞∏‡±ç‚Äå‡∞Æ‡±Ü‡∞Ç‡∞ü‡±ç',
                'Vitals & Condition': '‡∞Æ‡±Å‡∞ñ‡±ç‡∞Ø ‡∞∏‡∞Ç‡∞ï‡±á‡∞§‡∞æ‡∞≤‡±Å & ‡∞∏‡±ç‡∞•‡∞ø‡∞§‡∞ø',
                'Age': '‡∞µ‡∞Ø‡∞∏‡±ç‡∞∏‡±Å',
                'Gender': '‡∞≤‡∞ø‡∞Ç‡∞ó‡∞Ç',
                'Male': '‡∞™‡±Å‡∞∞‡±Å‡∞∑‡±Å‡∞°‡±Å',
                'Female': '‡∞∏‡±ç‡∞§‡±ç‡∞∞‡±Ä',
                'Other': '‡∞á‡∞§‡∞∞',
                'Severity (1-5)': '‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞§ (1-5)',
                'Requires ICU': 'ICU ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Ç',
                'Specialty Required': '‡∞∏‡±ç‡∞™‡±Ü‡∞∑‡∞æ‡∞≤‡∞ø‡∞ü‡±Ä ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Ç',
                'Scan Patient Form (AI)': 'AI ‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞æ ‡∞∞‡±ã‡∞ó‡∞ø ‡∞´‡∞æ‡∞∞‡∞Ç ‡∞∏‡±ç‡∞ï‡∞æ‡∞®‡±ç',
                'Submit Assessment & Find Hospitals': '‡∞Ö‡∞∏‡±Ü‡∞∏‡±ç‚Äå‡∞Æ‡±Ü‡∞Ç‡∞ü‡±ç ‡∞∏‡∞Æ‡∞∞‡±ç‡∞™‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡±Å‡∞≤‡±Å ‡∞ï‡∞®‡±Å‡∞ó‡±ä‡∞®‡∞Ç‡∞°‡∞ø',
                // IDLE / decision form
                'Start New Case': '‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞ï‡±á‡∞∏‡±Å ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡±Å',
                'üéôÔ∏è Voice Incident Reporter': 'üéôÔ∏è ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞ò‡∞ü‡∞® ‡∞∞‡∞ø‡∞™‡±ã‡∞∞‡±ç‡∞ü‡∞∞‡±ç',
                'Tap the mic and describe the incident. The system will auto-detect': '‡∞Æ‡±à‡∞ï‡±ç ‡∞®‡±ä‡∞ï‡±ç‡∞ï‡∞ø ‡∞ò‡∞ü‡∞® ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞Ç‡∞°‡∞ø. ‡∞∏‡∞ø‡∞∏‡±ç‡∞ü‡∞Æ‡±ç ‡∞∏‡±ç‡∞µ‡∞Ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞ï‡∞Ç‡∞ó‡∞æ ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø:',
                'consciousness': '‡∞∏‡±ç‡∞™‡±É‡∞π',
                'bleeding': '‡∞∞‡∞ï‡±ç‡∞§‡∞∏‡±ç‡∞∞‡∞æ‡∞µ‡∞Ç',
                'severity': '‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞§',
                'and fill the form automatically.': '‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞´‡∞æ‡∞∞‡∞Ç ‡∞∏‡±ç‡∞µ‡∞Ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞ï‡∞Ç‡∞ó‡∞æ ‡∞™‡±Ç‡∞∞‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.',
                'Tap mic & describe the incident': '‡∞Æ‡±à‡∞ï‡±ç ‡∞®‡±ä‡∞ï‡±ç‡∞ï‡∞ø ‡∞ò‡∞ü‡∞® ‡∞µ‡∞ø‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø',
                'Consciousness': '‡∞∏‡±ç‡∞™‡±É‡∞π',
                'Bleeding': '‡∞∞‡∞ï‡±ç‡∞§‡∞∏‡±ç‡∞∞‡∞æ‡∞µ‡∞Ç',
                'Severity': '‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞§',
                'Condition': '‡∞™‡∞∞‡∞ø‡∞∏‡±ç‡∞•‡∞ø‡∞§‡∞ø',
                'Apply & Auto-Fill Form': '‡∞®‡∞Æ‡±ã‡∞¶‡±Å & ‡∞´‡∞æ‡∞∞‡∞Ç ‡∞™‡±Ç‡∞∞‡∞ø‡∞Ç‡∞ö‡±Å',
                'or fill manually': '‡∞≤‡±á‡∞¶‡∞æ ‡∞Æ‡∞æ‡∞®‡∞µ‡±Ä‡∞Ø‡∞Ç‡∞ó‡∞æ ‡∞™‡±Ç‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø',
                'Scene Assessment': '‡∞∏‡±Ä‡∞®‡±ç ‡∞Ö‡∞∏‡±Ü‡∞∏‡±ç‚Äå‡∞Æ‡±Ü‡∞Ç‡∞ü‡±ç',
                'Consciousness Level (AVPU) *': '‡∞∏‡±ç‡∞™‡±É‡∞π ‡∞∏‡±ç‡∞•‡∞æ‡∞Ø‡∞ø (AVPU) *',
                'ALERT': '‡∞Ö‡∞™‡±ç‡∞∞‡∞Æ‡∞§‡±ç‡∞§‡∞Ç',
                'VERBAL': '‡∞µ‡±Ü‡∞∞‡±ç‡∞¨‡∞≤‡±ç',
                'PAIN': '‡∞®‡±ä‡∞™‡±ç‡∞™‡∞ø',
                'No Response': '‡∞∏‡±ç‡∞™‡∞Ç‡∞¶‡∞® ‡∞≤‡±á‡∞¶‡±Å',
                'Active Bleeding Visible': '‡∞∏‡∞ï‡±ç‡∞∞‡∞ø‡∞Ø ‡∞∞‡∞ï‡±ç‡∞§‡∞∏‡±ç‡∞∞‡∞æ‡∞µ‡∞Ç ‡∞ï‡∞®‡∞ø‡∞™‡∞ø‡∞∏‡±ç‡∞§‡±ã‡∞Ç‡∞¶‡∞ø',
                'Open wounds, blood-soaked clothing, pooling': '‡∞§‡±Ü‡∞∞‡∞ø‡∞ö‡∞ø‡∞® ‡∞ó‡∞æ‡∞Ø‡∞æ‡∞≤‡±Å, ‡∞∞‡∞ï‡±ç‡∞§‡∞∏‡∞ø‡∞ï‡±ç‡∞§‡∞Æ‡±à‡∞® ‡∞¶‡±Å‡∞∏‡±ç‡∞§‡±Å‡∞≤‡±Å',
                'Bleeding / Injury Location *': '‡∞∞‡∞ï‡±ç‡∞§‡∞∏‡±ç‡∞∞‡∞æ‡∞µ‡∞Ç / ‡∞ó‡∞æ‡∞Ø‡∞Ç ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç *',
                'Head\nFace': '‡∞§‡∞≤\n‡∞Æ‡±Å‡∞ñ‡∞Ç',
                'Neck': '‡∞Æ‡±Ü‡∞°',
                'Chest': '‡∞õ‡∞æ‡∞§‡±Ä',
                'Abdomen': '‡∞â‡∞¶‡∞∞‡∞Ç',
                'Back': '‡∞µ‡±Ä‡∞™‡±Å',
                'Arm': '‡∞ö‡±á‡∞Ø‡∞ø',
                'Leg': '‡∞ï‡∞æ‡∞≤‡±Å',
                'Multiple': '‡∞¨‡∞π‡±Å‡∞≥',
                'Mechanism of Injury': '‡∞ó‡∞æ‡∞Ø ‡∞ï‡∞æ‡∞∞‡∞£‡∞Ç',
                'üöó\nRoad Accident': 'üöó\n‡∞∞‡±ã‡∞°‡±ç‡∞°‡±Å ‡∞™‡±ç‡∞∞‡∞Æ‡∞æ‡∞¶‡∞Ç',
                'ü™ú\nFall': 'ü™ú\n‡∞™‡∞°‡∞ø‡∞™‡±ã‡∞µ‡∞°‡∞Ç',
                'üíä\nMedical Event': 'üíä\n‡∞µ‡±à‡∞¶‡±ç‡∞Ø ‡∞∏‡∞Ç‡∞ò‡∞ü‡∞®',
                'üî•\nBurns/Chemical': 'üî•\n‡∞ï‡∞æ‡∞≤‡∞ø‡∞® ‡∞ó‡∞æ‡∞Ø‡∞æ‡∞≤‡±Å',
                '‚ö†Ô∏è\nAssault': '‚ö†Ô∏è\n‡∞¶‡∞æ‡∞°‡∞ø',
                '‚ùì\nUnknown': '‚ùì\n‡∞§‡±Ü‡∞≤‡∞ø‡∞Ø‡∞¶‡±Å',
                'Clinical Assessment': '‡∞ï‡±ç‡∞≤‡∞ø‡∞®‡∞ø‡∞ï‡∞≤‡±ç ‡∞Ö‡∞∏‡±Ü‡∞∏‡±ç‚Äå‡∞Æ‡±Ü‡∞Ç‡∞ü‡±ç',
                'Severity Level *': '‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞§ ‡∞∏‡±ç‡∞•‡∞æ‡∞Ø‡∞ø *',
                '1 Minor': '1 ‡∞∏‡±ç‡∞µ‡∞≤‡±ç‡∞™',
                '2\n                            Mild': '2 ‡∞§‡±á‡∞≤‡∞ø‡∞ï‡∞™‡∞æ‡∞ü‡∞ø',
                '3 Moderate': '3 ‡∞Æ‡∞ß‡±ç‡∞Ø‡∞∏‡±ç‡∞•‡∞Ç',
                '4 Serious': '4 ‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞Ç',
                '5\n                            Critical': '5 ‡∞µ‡∞ø‡∞Æ‡∞∞‡±ç‡∞∂‡∞æ‡∞§‡±ç‡∞Æ‡∞ï‡∞Ç',
                'Auto-checked for UNRESPONSIVE / Severity ‚â• 4': 'UNRESPONSIVE / ‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞§ ‚â• 4 ‡∞ï‡∞ø ‡∞∏‡±ç‡∞µ‡∞Ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞ï‡∞Ç‡∞ó‡∞æ ‡∞ö‡±Ü‡∞ï‡±ç',
                'Requires Specialty': '‡∞∏‡±ç‡∞™‡±Ü‡∞∑‡∞æ‡∞≤‡∞ø‡∞ü‡±Ä ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Ç',
                'Current Latitude': '‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞Ö‡∞ï‡±ç‡∞∑‡∞æ‡∞Ç‡∞∂‡∞Ç',
                'Current Longitude': '‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞∞‡±á‡∞ñ‡∞æ‡∞Ç‡∞∂‡∞Ç',
                'Max Distance (km)': '‡∞ó‡∞∞‡∞ø‡∞∑‡±ç‡∞ü ‡∞¶‡±Ç‡∞∞‡∞Ç (‡∞ï‡∞ø.‡∞Æ‡±Ä.)',
                'Max Results': '‡∞ó‡∞∞‡∞ø‡∞∑‡±ç‡∞ü ‡∞´‡∞≤‡∞ø‡∞§‡∞æ‡∞≤‡±Å',
                'üì∑ AI Scan Injury': 'üì∑ AI ‡∞∏‡±ç‡∞ï‡∞æ‡∞®‡±ç ‡∞ó‡∞æ‡∞Ø‡∞Ç',
                'üîç Find Best Hospitals': 'üîç ‡∞â‡∞§‡±ç‡∞§‡∞Æ ‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡±Å‡∞≤‡±Å ‡∞ï‡∞®‡±Å‡∞ó‡±ä‡∞®‡∞Ç‡∞°‡∞ø',
                // Results
                'Select Destination Hospital': '‡∞ó‡∞Æ‡±ç‡∞Ø‡∞Ç ‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø',
                'Rank': '‡∞∞‡±ç‡∞Ø‡∞æ‡∞Ç‡∞ï‡±ç',
                'Hospital': '‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡∞ø',
                'Distance / ETA': '‡∞¶‡±Ç‡∞∞‡∞Ç / ETA',
                'Score': '‡∞∏‡±ç‡∞ï‡±ã‡∞∞‡±ç',
                'Status Snapshot': '‡∞∏‡±ç‡∞•‡∞ø‡∞§‡∞ø ‡∞∏‡±ç‡∞®‡∞æ‡∞™‡±ç‚Äå‡∞∑‡∞æ‡∞ü‡±ç',
                'Reasoning': '‡∞ï‡∞æ‡∞∞‡∞£‡∞æ‡∞≤‡±Å',
                'Action': '‡∞ö‡∞∞‡±ç‡∞Ø',
                'Cancel Case': '‡∞ï‡±á‡∞∏‡±Å ‡∞∞‡∞¶‡±ç‡∞¶‡±Å',
                'Select': '‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã',
                // Hospital Selected
                'Hospital Selected': '‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡∞ø ‡∞é‡∞Ç‡∞™‡∞ø‡∞ï',
                'Destination Confirmed': '‡∞ó‡∞Æ‡±ç‡∞Ø‡∞Ç ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø',
                'Target:': '‡∞≤‡∞ï‡±ç‡∞∑‡±ç‡∞Ø‡∞Ç:',
                'Prepare for transport.': '‡∞∞‡∞µ‡∞æ‡∞£‡∞æ‡∞ï‡±Å ‡∞∏‡∞ø‡∞¶‡±ç‡∞ß‡∞Ç ‡∞ï‡∞Ç‡∞°‡∞ø.',
                'Start Route': '‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞Ç ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡±Å',
                'Cancel': '‡∞∞‡∞¶‡±ç‡∞¶‡±Å',
                // EN_ROUTE
                'En Route to Hospital': '‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡∞ø‡∞ï‡∞ø ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞Ç‡∞≤‡±ã',
                'Mark Arrived': '‡∞ö‡±á‡∞∞‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞ü‡±ç‡∞≤‡±Å ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞ö‡±Å',
                'Re-Evaluate Destination': '‡∞ó‡∞Æ‡±ç‡∞Ø‡∞Ç ‡∞™‡±Å‡∞®‡∞∞‡±ç‡∞Æ‡±Ç‡∞≤‡±ç‡∞Ø‡∞æ‡∞Ç‡∞ï‡∞®‡∞Ç',
                // Arrived
                'Arrived at Hospital': '‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡∞ø ‡∞ö‡±á‡∞∞‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å',
                'Transferring patient...': '‡∞∞‡±ã‡∞ó‡∞ø‡∞®‡∞ø ‡∞¨‡∞¶‡∞ø‡∞≤‡±Ä ‡∞ö‡±á‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞Ç...',
                'Patient Admitted': '‡∞∞‡±ã‡∞ó‡∞ø ‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞ü‡±ç',
                // Patient Admitted
                'Mission Complete': '‡∞Æ‡∞ø‡∞∑‡∞®‡±ç ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞Ø‡∞ø‡∞Ç‡∞¶‡∞ø',
                'Patient successfully admitted.': '‡∞∞‡±ã‡∞ó‡∞ø ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞ü‡±ç ‡∞Ö‡∞Ø‡±ç‡∞Ø‡∞æ‡∞∞‡±Å.',
                'Complete & Return to Idle': '‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø & ‡∞®‡∞ø‡∞∑‡±ç‡∞ï‡±ç‡∞∞‡∞ø‡∞Ø‡∞ï‡±Å ‡∞§‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø',
                // SOS Modal
                'EMERGENCY ALERT': '‡∞Ö‡∞§‡±ç‡∞Ø‡∞µ‡∞∏‡∞∞ ‡∞π‡±Ü‡∞ö‡±ç‡∞ö‡∞∞‡∞ø‡∞ï',
                'SOS Request Nearby': '‡∞∏‡∞Æ‡±Ä‡∞™‡∞Ç‡∞≤‡±ã SOS ‡∞Ö‡∞≠‡±ç‡∞Ø‡∞∞‡±ç‡∞•‡∞®',
                'Distance:': '‡∞¶‡±Ç‡∞∞‡∞Ç:',
                'km': '‡∞ï‡∞ø.‡∞Æ‡±Ä.',
                'Ignore': '‡∞µ‡∞ø‡∞∏‡±ç‡∞Æ‡∞∞‡∞ø‡∞Ç‡∞ö‡±Å',
                'ACCEPT': '‡∞Ö‡∞Ç‡∞ó‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡±Å',
                // Re-eval modal
                'Severity Re-Evaluation': '‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞§ ‡∞™‡±Å‡∞®‡∞∞‡±ç‡∞Æ‡±Ç‡∞≤‡±ç‡∞Ø‡∞æ‡∞Ç‡∞ï‡∞®‡∞Ç',
                'Using live ambulance position for new decision': '‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞®‡∞ø‡∞∞‡±ç‡∞£‡∞Ø‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞≤‡±à‡∞µ‡±ç ‡∞Ö‡∞Ç‡∞¨‡±Å‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç ‡∞â‡∞™‡∞Ø‡±ã‡∞ó‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞Ç',
                'Patient Severity (1 = Minor ¬∑ 5 = Critical)': '‡∞∞‡±ã‡∞ó‡∞ø ‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞§ (1 = ‡∞∏‡±ç‡∞µ‡∞≤‡±ç‡∞™ ¬∑ 5 = ‡∞µ‡∞ø‡∞Æ‡∞∞‡±ç‡∞∂‡∞æ‡∞§‡±ç‡∞Æ‡∞ï‡∞Ç)',
                '1 Minor': '1 ‡∞∏‡±ç‡∞µ‡∞≤‡±ç‡∞™',
                '2': '2',
                '3 Moderate': '3 ‡∞Æ‡∞ß‡±ç‡∞Ø‡∞∏‡±ç‡∞•‡∞Ç',
                '4': '4',
                '5 Critical': '5 ‡∞µ‡∞ø‡∞Æ‡∞∞‡±ç‡∞∂‡∞æ‡∞§‡±ç‡∞Æ‡∞ï‡∞Ç',
                'Intensive care unit bed needed': 'ICU ‡∞¨‡±Ü‡∞°‡±ç ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Ç',
                'Find Better Hospital': '‡∞Æ‡±Ü‡∞∞‡±Å‡∞ó‡±à‡∞® ‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡∞ø ‡∞ï‡∞®‡±Å‡∞ó‡±ä‡∞®‡∞Ç‡∞°‡∞ø',
                // Reroute modal
                'Higher Capability Hospital Found': '‡∞Ö‡∞ß‡∞ø‡∞ï ‡∞∏‡∞æ‡∞Æ‡∞∞‡±ç‡∞•‡±ç‡∞Ø‡∞Ç ‡∞â‡∞®‡±ç‡∞® ‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡∞ø ‡∞ï‡∞®‡±Å‡∞ó‡±ä‡∞®‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø',
                'A better match for the updated severity profile': '‡∞®‡∞µ‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø‡∞® ‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞§ ‡∞™‡±ç‡∞∞‡±ä‡∞´‡±à‡∞≤‡±ç‚Äå‡∞ï‡∞ø ‡∞Æ‡±Ü‡∞∞‡±Å‡∞ó‡±à‡∞® ‡∞∏‡∞∞‡∞ø‡∞™‡±ã‡∞≤‡∞ø‡∞ï',
                'Current': '‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§‡∞Ç',
                'ACTIVE': '‡∞∏‡∞ï‡±ç‡∞∞‡∞ø‡∞Ø',
                'Recommended': '‡∞∏‡∞ø‡∞´‡∞æ‡∞∞‡∞∏‡±Å',
                'BETTER MATCH': '‡∞Æ‡±Ü‡∞∞‡±Å‡∞ó‡±à‡∞® ‡∞∏‡∞∞‡∞ø‡∞™‡±ã‡∞≤‡∞ø‡∞ï',
                'Transfer reservation and reroute ambulance?': '‡∞∞‡∞ø‡∞ú‡∞∞‡±ç‡∞µ‡±á‡∞∑‡∞®‡±ç ‡∞¨‡∞¶‡∞ø‡∞≤‡±Ä ‡∞ö‡±á‡∞∏‡∞ø ‡∞Ö‡∞Ç‡∞¨‡±Å‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç ‡∞Æ‡∞≥‡±ç‡∞≥‡∞ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞æ?',
                'Old reservation will be cancelled atomically.': '‡∞™‡∞æ‡∞§ ‡∞∞‡∞ø‡∞ú‡∞∞‡±ç‡∞µ‡±á‡∞∑‡∞®‡±ç ‡∞∞‡∞¶‡±ç‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.',
                'Confirm & Reroute': '‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ö‡±Å & ‡∞Æ‡∞≥‡±ç‡∞≥‡∞ø‡∞Ç‡∞ö‡±Å',
                // Specialty chips
                'Trauma': '‡∞ü‡±ç‡∞∞‡∞æ‡∞Æ‡∞æ',
                'Orthopedics': '‡∞Ü‡∞∞‡±ç‡∞•‡±ã‡∞™‡±Ü‡∞°‡∞ø‡∞ï‡±ç‡∞∏‡±ç',
                'Neurosurgery': '‡∞®‡±ç‡∞Ø‡±Ç‡∞∞‡±ã‡∞∏‡∞∞‡±ç‡∞ú‡∞∞‡±Ä',
                'Cardiology': '‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡∞ø‡∞Ø‡∞æ‡∞≤‡∞ú‡±Ä',
                'Burns Unit': '‡∞¨‡∞∞‡±ç‡∞®‡±ç‡∞∏‡±ç ‡∞Ø‡±Ç‡∞®‡∞ø‡∞ü‡±ç',
                'General Surgery': '‡∞ú‡∞®‡∞∞‡∞≤‡±ç ‡∞∏‡∞∞‡±ç‡∞ú‡∞∞‡±Ä',
                // Beds/status
                'Beds:': '‡∞¨‡±Ü‡∞°‡±ç‡∞≤‡±Å:',
                'ICU:': 'ICU:',
                'Status:': '‡∞∏‡±ç‡∞•‡∞ø‡∞§‡∞ø:',
                'Arrived at destination': '‡∞ó‡∞Æ‡±ç‡∞Ø‡∞Ç ‡∞ö‡±á‡∞∞‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å',
                'Proceed to destination': '‡∞ó‡∞Æ‡±ç‡∞Ø‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞ï‡±ä‡∞®‡∞∏‡∞æ‡∞ó‡∞Ç‡∞°‡∞ø',
            },

            hi: {
                'Ambulance Dispatch Interface': '‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏ ‡§°‡§ø‡§∏‡•ç‡§™‡•à‡§ö ‡§á‡§Ç‡§ü‡§∞‡§´‡§º‡•á‡§∏',
                'SYSTEM ONLINE': '‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ë‡§®‡§≤‡§æ‡§á‡§®',
                'EMS READY': 'EMS ‡§§‡•à‡§Ø‡§æ‡§∞',
                'LOCAL TIME': '‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§∏‡§Æ‡§Ø',
                'LIVE NAVIGATION': '‡§≤‡§æ‡§á‡§µ ‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§∂‡§®',
                'MIN': '‡§Æ‡§ø‡§®',
                'KM': '‡§ï‡§ø.‡§Æ‡•Ä.',
                'Calculating route...': '‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§ï‡•Ä ‡§ó‡§£‡§®‡§æ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...',
                'Ambulance Login': '‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏ ‡§≤‡•â‡§ó‡§ø‡§®',
                'Enter credentials to access dispatch': '‡§°‡§ø‡§∏‡•ç‡§™‡•à‡§ö ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                'Username': '‡§Ø‡•Ç‡§ú‡§º‡§∞‡§®‡•á‡§Æ',
                'Password': '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°',
                'Login': '‡§≤‡•â‡§ó‡§ø‡§®',
                'Register New Ambulance': '‡§®‡§à ‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç',
                'Enter Username': '‡§Ø‡•Ç‡§ú‡§º‡§∞‡§®‡•á‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                'Enter Password': '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                'Register Ambulance': '‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞',
                'Registration Number': '‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§®‡§Ç‡§¨‡§∞',
                'Organization': '‡§∏‡§Ç‡§ó‡§†‡§®',
                'GPS Coordinates': 'GPS ‡§ï‡•ã‡§ë‡§∞‡•ç‡§°‡§ø‡§®‡•á‡§ü‡•ç‡§∏',
                'Auto‚ÄëFix': '‡§ë‡§ü‡•ã-‡§´‡§ø‡§ï‡•ç‡§∏',
                'Register & Login': '‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§î‡§∞ ‡§≤‡•â‡§ó‡§ø‡§®',
                'Registration / Name': '‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® / ‡§®‡§æ‡§Æ',
                'ID:': 'ID:',
                'IDLE': '‡§®‡§ø‡§∑‡•ç‡§ï‡•ç‡§∞‡§ø‡§Ø',
                'Logout': '‡§≤‡•â‡§ó‡§Ü‡§â‡§ü',
                'Simulate Breakdown': '‡§¨‡•ç‡§∞‡•á‡§ï‡§°‡§æ‡§â‡§® ‡§∏‡§ø‡§Æ‡•Å‡§≤‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç',
                'Active Reservation': '‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§£',
                'Expires In': '‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡§ø',
                'EMERGENCY RESPONSE: EN ROUTE TO PATIENT': '‡§Ü‡§™‡§æ‡§§ ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ: ‡§Æ‡§∞‡•Ä‡§ú‡§º ‡§ï‡•Ä ‡§ì‡§∞ ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§∏‡•ç‡§•',
                'Responding to SOS': 'SOS ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á ‡§∞‡§π‡•á ‡§π‡•à‡§Ç',
                'Request ID:': '‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ID:',
                'ARRIVED AT SCENE': '‡§ò‡§ü‡§®‡§æ‡§∏‡•ç‡§•‡§≤ ‡§™‡§∞ ‡§™‡§π‡•Å‡§Å‡§ö‡•á',
                'Patient Assessment': '‡§Æ‡§∞‡•Ä‡§ú‡§º ‡§Ü‡§ï‡§≤‡§®',
                'Vitals & Condition': '‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§î‡§∞ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                'Age': '‡§Ü‡§Ø‡•Å',
                'Gender': '‡§≤‡§ø‡§Ç‡§ó',
                'Male': '‡§™‡•Å‡§∞‡•Å‡§∑',
                'Female': '‡§Æ‡§π‡§ø‡§≤‡§æ',
                'Other': '‡§Ö‡§®‡•ç‡§Ø',
                'Severity (1-5)': '‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ (1-5)',
                'Requires ICU': 'ICU ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï',
                'Specialty Required': '‡§∏‡•ç‡§™‡•á‡§∂‡§≤‡§ø‡§ü‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï',
                'Scan Patient Form (AI)': 'AI ‡§∏‡•á ‡§Æ‡§∞‡•Ä‡§ú‡§º ‡§´‡•â‡§∞‡•ç‡§Æ ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç',
                'Submit Assessment & Find Hospitals': '‡§Ü‡§ï‡§≤‡§® ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§ñ‡•ã‡§ú‡•á‡§Ç',
                'Start New Case': '‡§®‡§Ø‡§æ ‡§ï‡•á‡§∏ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
                'üéôÔ∏è Voice Incident Reporter': 'üéôÔ∏è ‡§µ‡•â‡§á‡§∏ ‡§ò‡§ü‡§®‡§æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡§∞',
                'Tap mic & describe the incident': '‡§Æ‡§æ‡§á‡§ï ‡§¶‡§¨‡§æ‡§è‡§Å ‡§î‡§∞ ‡§ò‡§ü‡§®‡§æ ‡§¨‡§§‡§æ‡§è‡§Å',
                'Consciousness': '‡§ö‡•á‡§§‡§®‡§æ',
                'Bleeding': '‡§∞‡§ï‡•ç‡§§‡§∏‡•ç‡§∞‡§æ‡§µ',
                'Severity': '‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ',
                'Condition': '‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                'Apply & Auto-Fill Form': '‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§´‡§º‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡•á‡§Ç',
                'or fill manually': '‡§Ø‡§æ ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤‡•Ä ‡§≠‡§∞‡•á‡§Ç',
                'Scene Assessment': '‡§∏‡•Ä‡§® ‡§Ö‡§∏‡•á‡§∏‡§Æ‡•á‡§Ç‡§ü',
                'Consciousness Level (AVPU) *': '‡§ö‡•á‡§§‡§®‡§æ ‡§∏‡•ç‡§§‡§∞ (AVPU) *',
                'ALERT': '‡§∏‡§§‡§∞‡•ç‡§ï',
                'VERBAL': '‡§µ‡§∞‡•ç‡§¨‡§≤',
                'PAIN': '‡§¶‡§∞‡•ç‡§¶',
                'No Response': '‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç',
                'Active Bleeding Visible': '‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§∞‡§ï‡•ç‡§§‡§∏‡•ç‡§∞‡§æ‡§µ ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á ‡§∞‡§π‡§æ ‡§π‡•à',
                'Open wounds, blood-soaked clothing, pooling': '‡§ñ‡•Å‡§≤‡•á ‡§ò‡§æ‡§µ, ‡§ñ‡•Ç‡§® ‡§∏‡•á ‡§∏‡§®‡•Ä ‡§ï‡§™‡§°‡§º‡•á, ‡§ú‡§Æ‡§æ‡§µ',
                'Bleeding / Injury Location *': '‡§∞‡§ï‡•ç‡§§‡§∏‡•ç‡§∞‡§æ‡§µ / ‡§ö‡•ã‡§ü ‡§ï‡§æ ‡§∏‡•ç‡§•‡§æ‡§® *',
                'Head\nFace': '‡§∏‡§ø‡§∞\n‡§ö‡•á‡§π‡§∞‡§æ',
                'Neck': '‡§ó‡§∞‡•ç‡§¶‡§®',
                'Chest': '‡§õ‡§æ‡§§‡•Ä',
                'Abdomen': '‡§™‡•á‡§ü',
                'Back': '‡§™‡•Ä‡§†',
                'Arm': '‡§¨‡§æ‡§Å‡§π',
                'Leg': '‡§™‡§æ‡§Å‡§µ',
                'Multiple': '‡§ï‡§à ‡§∏‡•ç‡§•‡§æ‡§®',
                'Mechanism of Injury': '‡§ö‡•ã‡§ü ‡§ï‡§æ ‡§ï‡§æ‡§∞‡§£',
                'üöó\nRoad Accident': 'üöó\n‡§∏‡§°‡§º‡§ï ‡§¶‡•Å‡§∞‡•ç‡§ò‡§ü‡§®‡§æ',
                'ü™ú\nFall': 'ü™ú\n‡§ó‡§ø‡§∞‡§®‡§æ',
                'üíä\nMedical Event': 'üíä\n‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§ò‡§ü‡§®‡§æ',
                'üî•\nBurns/Chemical': 'üî•\n‡§ú‡§≤‡§®‡§æ/‡§∞‡§æ‡§∏‡§æ‡§Ø‡§®‡§ø‡§ï',
                '‚ö†Ô∏è\nAssault': '‚ö†Ô∏è\n‡§π‡§Æ‡§≤‡§æ',
                '‚ùì\nUnknown': '‚ùì\n‡§Ö‡§ú‡•ç‡§û‡§æ‡§§',
                'Clinical Assessment': '‡§ï‡•ç‡§≤‡§ø‡§®‡§ø‡§ï‡§≤ ‡§Ö‡§∏‡•á‡§∏‡§Æ‡•á‡§Ç‡§ü',
                'Severity Level *': '‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ ‡§∏‡•ç‡§§‡§∞ *',
                '1 Minor': '1 ‡§Æ‡§æ‡§Æ‡•Ç‡§≤‡•Ä',
                '3 Moderate': '3 ‡§Æ‡§ß‡•ç‡§Ø‡§Æ',
                '4 Serious': '4 ‡§ó‡§Ç‡§≠‡•Ä‡§∞',
                '5 Critical': '5 ‡§Ö‡§§‡§ø ‡§ó‡§Ç‡§≠‡•Ä‡§∞',
                'Auto-checked for UNRESPONSIVE / Severity ‚â• 4': 'UNRESPONSIVE / ‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ ‚â• 4 ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§',
                'Requires Specialty': '‡§∏‡•ç‡§™‡•á‡§∂‡§≤‡§ø‡§ü‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï',
                'Current Latitude': '‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Ö‡§ï‡•ç‡§∑‡§æ‡§Ç‡§∂',
                'Current Longitude': '‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§¶‡•á‡§∂‡§æ‡§Ç‡§§‡§∞',
                'Max Distance (km)': '‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§¶‡•Ç‡§∞‡•Ä (‡§ï‡§ø.‡§Æ‡•Ä.)',
                'Max Results': '‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ',
                'üì∑ AI Scan Injury': 'üì∑ AI ‡§∏‡•ç‡§ï‡•à‡§® ‡§ö‡•ã‡§ü',
                'üîç Find Best Hospitals': 'üîç ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡•á ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§ñ‡•ã‡§ú‡•á‡§Ç',
                'Select Destination Hospital': '‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç',
                'Rank': '‡§∞‡•à‡§Ç‡§ï',
                'Hospital': '‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤',
                'Distance / ETA': '‡§¶‡•Ç‡§∞‡•Ä / ETA',
                'Score': '‡§∏‡•ç‡§ï‡•ã‡§∞',
                'Status Snapshot': '‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§∏‡•ç‡§®‡•à‡§™‡§∂‡•â‡§ü',
                'Reasoning': '‡§ï‡§æ‡§∞‡§£',
                'Action': '‡§ï‡§æ‡§∞‡•ç‡§Ø',
                'Cancel Case': '‡§ï‡•á‡§∏ ‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
                'Select': '‡§ö‡•Å‡§®‡•á‡§Ç',
                'Hospital Selected': '‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§ö‡§Ø‡§®‡§ø‡§§',
                'Destination Confirmed': '‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø ‡§™‡•Å‡§∑‡•ç‡§ü',
                'Target:': '‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø:',
                'Prepare for transport.': '‡§™‡§∞‡§ø‡§µ‡§π‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§∞‡§π‡•á‡§Ç‡•§',
                'Start Route': '‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
                'Cancel': '‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
                'En Route to Hospital': '‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§ï‡•Ä ‡§ì‡§∞ ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§∏‡•ç‡§•',
                'Mark Arrived': '‡§™‡§π‡•Å‡§Å‡§ö‡§æ ‡§π‡•Å‡§Ü ‡§ö‡§ø‡§π‡•ç‡§®‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
                'Re-Evaluate Destination': '‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø ‡§™‡•Å‡§®‡§∞‡•ç‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§®',
                'Arrived at Hospital': '‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§™‡§π‡•Å‡§Å‡§ö ‡§ó‡§è',
                'Transferring patient...': '‡§Æ‡§∞‡•Ä‡§ú‡§º ‡§ï‡•ã ‡§∏‡•ç‡§•‡§æ‡§®‡§æ‡§Ç‡§§‡§∞‡§ø‡§§ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...',
                'Patient Admitted': '‡§Æ‡§∞‡•Ä‡§ú‡§º ‡§≠‡§∞‡•ç‡§§‡•Ä',
                'Mission Complete': '‡§Æ‡§ø‡§∂‡§® ‡§™‡•Ç‡§∞‡•ç‡§£',
                'Patient successfully admitted.': '‡§Æ‡§∞‡•Ä‡§ú‡§º ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§≠‡§∞‡•ç‡§§‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ‡•§',
                'Complete & Return to Idle': '‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§®‡§ø‡§∑‡•ç‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§≤‡•å‡§ü‡•á‡§Ç',
                'EMERGENCY ALERT': '‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§Ö‡§≤‡§∞‡•ç‡§ü',
                'SOS Request Nearby': '‡§®‡§ú‡§º‡§¶‡•Ä‡§ï SOS ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                'Distance:': '‡§¶‡•Ç‡§∞‡•Ä:',
                'km': '‡§ï‡§ø.‡§Æ‡•Ä.',
                'Ignore': '‡§Ö‡§®‡§¶‡•á‡§ñ‡§æ ‡§ï‡§∞‡•á‡§Ç',
                'ACCEPT': '‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç',
                'Severity Re-Evaluation': '‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ ‡§™‡•Å‡§®‡§∞‡•ç‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§®',
                'Using live ambulance position for new decision': '‡§®‡§è ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡§æ‡§á‡§µ ‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                'Patient Severity (1 = Minor ¬∑ 5 = Critical)': '‡§Æ‡§∞‡•Ä‡§ú‡§º ‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ (1 = ‡§Æ‡§æ‡§Æ‡•Ç‡§≤‡•Ä ¬∑ 5 = ‡§Ö‡§§‡§ø ‡§ó‡§Ç‡§≠‡•Ä‡§∞)',
                '2': '2',
                '4': '4',
                'Intensive care unit bed needed': 'ICU ‡§¨‡•á‡§° ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•à',
                'Find Better Hospital': '‡§¨‡•á‡§π‡§§‡§∞ ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§ñ‡•ã‡§ú‡•á‡§Ç',
                'Higher Capability Hospital Found': '‡§â‡§ö‡•ç‡§ö ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§µ‡§æ‡§≤‡§æ ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§Æ‡§ø‡§≤‡§æ',
                'A better match for the updated severity profile': '‡§Ö‡§™‡§°‡•á‡§ü‡•á‡§° ‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡•á‡§π‡§§‡§∞ ‡§Æ‡§ø‡§≤‡§æ‡§®',
                'Current': '‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§®',
                'ACTIVE': '‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø',
                'Recommended': '‡§Ö‡§®‡•Å‡§∂‡§Ç‡§∏‡§ø‡§§',
                'BETTER MATCH': '‡§¨‡•á‡§π‡§§‡§∞ ‡§Æ‡§ø‡§≤‡§æ‡§®',
                'Transfer reservation and reroute ambulance?': '‡§Ü‡§∞‡§ï‡•ç‡§∑‡§£ ‡§∏‡•ç‡§•‡§æ‡§®‡§æ‡§Ç‡§§‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏ ‡§ï‡•ã ‡§∞‡•Ä‡§∞‡•Ç‡§ü ‡§ï‡§∞‡•á‡§Ç?',
                'Old reservation will be cancelled atomically.': '‡§™‡•Å‡§∞‡§æ‡§®‡§æ ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§£ ‡§∞‡§¶‡•ç‡§¶ ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡§æ‡•§',
                'Confirm & Reroute': '‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§∞‡•Ä‡§∞‡•Ç‡§ü ‡§ï‡§∞‡•á‡§Ç',
                'Trauma': '‡§ü‡•ç‡§∞‡§æ‡§Æ‡§æ',
                'Orthopedics': '‡§ë‡§∞‡•ç‡§•‡•ã‡§™‡•á‡§°‡§ø‡§ï‡•ç‡§∏',
                'Neurosurgery': '‡§®‡•ç‡§Ø‡•Ç‡§∞‡•ã‡§∏‡§∞‡•ç‡§ú‡§∞‡•Ä',
                'Cardiology': '‡§ï‡§æ‡§∞‡•ç‡§°‡§ø‡§Ø‡•ã‡§≤‡•â‡§ú‡•Ä',
                'Burns Unit': '‡§¨‡§∞‡•ç‡§®‡•ç‡§∏ ‡§Ø‡•Ç‡§®‡§ø‡§ü',
                'General Surgery': '‡§ú‡§®‡§∞‡§≤ ‡§∏‡§∞‡•ç‡§ú‡§∞‡•Ä',
                'Arrived at destination': '‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø ‡§™‡§∞ ‡§™‡§π‡•Å‡§Å‡§ö‡•á',
                'Proceed to destination': '‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø ‡§ï‡•Ä ‡§ì‡§∞ ‡§¨‡§¢‡§º‡•á‡§Ç',
            },

            ur: {
                'Ambulance Dispatch Interface': 'ÿß€åŸÖÿ®ŸàŸÑ€åŸÜÿ≥ ⁄àÿ≥Ÿæ€å⁄Ü ÿßŸÜŸπÿ±ŸÅ€åÿ≥',
                'SYSTEM ONLINE': 'ÿ≥ÿ≥ŸπŸÖ ÿ¢ŸÜ ŸÑÿßÿ¶ŸÜ',
                'EMS READY': 'EMS ÿ™€åÿßÿ±',
                'LOCAL TIME': 'ŸÖŸÇÿßŸÖ€å ŸàŸÇÿ™',
                'LIVE NAVIGATION': 'ŸÑÿßÿ¶€åŸà ŸÜ€åŸà€å⁄Ø€åÿ¥ŸÜ',
                'MIN': 'ŸÖŸÜŸπ',
                'KM': '⁄©ŸÑŸàŸÖ€åŸπÿ±',
                'Calculating route...': 'ÿ±ÿßÿ≥ÿ™€Å ÿ≠ÿ≥ÿßÿ® €ÅŸà ÿ±€Åÿß €Å€í...',
                'Ambulance Login': 'ÿß€åŸÖÿ®ŸàŸÑ€åŸÜÿ≥ ŸÑÿß⁄Ø ÿßŸÜ',
                'Enter credentials to access dispatch': '⁄àÿ≥Ÿæ€å⁄Ü ÿ™⁄© ÿ±ÿ≥ÿßÿ¶€å ⁄©€í ŸÑ€å€í ÿ™ŸÅÿµ€åŸÑÿßÿ™ ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫',
                'Username': 'ÿµÿßÿ±ŸÅ ŸÜÿßŸÖ',
                'Password': 'Ÿæÿßÿ≥ Ÿàÿ±⁄à',
                'Login': 'ŸÑÿß⁄Ø ÿßŸÜ',
                'Register New Ambulance': 'ŸÜÿ¶€å ÿß€åŸÖÿ®ŸàŸÑ€åŸÜÿ≥ ÿ±ÿ¨ÿ≥Ÿπÿ± ⁄©ÿ±€å⁄∫',
                'Enter Username': 'ÿµÿßÿ±ŸÅ ŸÜÿßŸÖ ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫',
                'Enter Password': 'Ÿæÿßÿ≥ Ÿàÿ±⁄à ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫',
                'Register Ambulance': 'ÿß€åŸÖÿ®ŸàŸÑ€åŸÜÿ≥ ÿ±ÿ¨ÿ≥Ÿπÿ±',
                'Registration Number': 'ÿ±ÿ¨ÿ≥Ÿπÿ±€åÿ¥ŸÜ ŸÜŸÖÿ®ÿ±',
                'Organization': 'ÿ™ŸÜÿ∏€åŸÖ',
                'GPS Coordinates': 'GPS ⁄©Ÿàÿ¢ÿ±⁄à€åŸÜ€åŸπÿ≥',
                'Auto‚ÄëFix': 'ÿ¢ŸπŸà-ŸÅ⁄©ÿ≥',
                'Register & Login': 'ÿ±ÿ¨ÿ≥Ÿπÿ± ÿßŸàÿ± ŸÑÿß⁄Ø ÿßŸÜ',
                'Registration / Name': 'ÿ±ÿ¨ÿ≥Ÿπÿ±€åÿ¥ŸÜ / ŸÜÿßŸÖ',
                'ID:': 'ID:',
                'IDLE': 'ÿ∫€åÿ± ŸÅÿπÿßŸÑ',
                'Logout': 'ŸÑÿß⁄Ø ÿ¢ÿ§Ÿπ',
                'Simulate Breakdown': 'ÿ®ÿ±€å⁄© ⁄àÿßÿ§ŸÜ ŸÜŸÇŸÑ ⁄©ÿ±€å⁄∫',
                'Active Reservation': 'ŸÅÿπÿßŸÑ ÿ±€åÿ≤ÿ±Ÿà€åÿ¥ŸÜ',
                'Expires In': 'ŸÖ€åÿπÿßÿØ',
                'EMERGENCY RESPONSE: EN ROUTE TO PATIENT': '€ÅŸÜ⁄ØÿßŸÖ€å ÿ±ÿØÿπŸÖŸÑ: ŸÖÿ±€åÿ∂ ⁄©€å ÿ∑ÿ±ŸÅ ÿ±ÿßÿ≥ÿ™€í ŸÖ€å⁄∫',
                'Responding to SOS': 'SOS ⁄©ÿß ÿ¨Ÿàÿßÿ® ÿØ€í ÿ±€Å€í €Å€å⁄∫',
                'Request ID:': 'ÿØÿ±ÿÆŸàÿßÿ≥ÿ™ ID:',
                'ARRIVED AT SCENE': 'ŸÖŸÇÿßŸÖ Ÿæÿ± Ÿæ€ÅŸÜ⁄Ü ⁄Øÿ¶€í',
                'Patient Assessment': 'ŸÖÿ±€åÿ∂ ⁄©ÿß ÿ¨ÿßÿ¶ÿ≤€Å',
                'Vitals & Condition': 'ÿß€ÅŸÖ ÿπŸÑÿßŸÖÿßÿ™ ÿßŸàÿ± ÿ≠ÿßŸÑÿ™',
                'Age': 'ÿπŸÖÿ±',
                'Gender': 'ÿ¨ŸÜÿ≥',
                'Male': 'ŸÖÿ±ÿØ',
                'Female': 'ÿπŸàÿ±ÿ™',
                'Other': 'ÿØ€å⁄Øÿ±',
                'Severity (1-5)': 'ÿ¥ÿØÿ™ (1-5)',
                'Requires ICU': 'ICU ÿ∂ÿ±Ÿàÿ±€å',
                'Specialty Required': 'ÿßÿ≥Ÿæ€åÿ¥ŸÑŸπ€å ÿ∂ÿ±Ÿàÿ±€å',
                'Scan Patient Form (AI)': 'AI ÿ≥€í ŸÖÿ±€åÿ∂ ŸÅÿßÿ±ŸÖ ÿßÿ≥⁄©€åŸÜ ⁄©ÿ±€å⁄∫',
                'Submit Assessment & Find Hospitals': 'ÿ¨ÿßÿ¶ÿ≤€Å ÿ¨ŸÖÿπ ⁄©ÿ±€å⁄∫ ÿßŸàÿ± €Åÿ≥Ÿæÿ™ÿßŸÑ ÿ™ŸÑÿßÿ¥ ⁄©ÿ±€å⁄∫',
                'Start New Case': 'ŸÜ€åÿß ⁄©€åÿ≥ ÿ¥ÿ±Ÿàÿπ ⁄©ÿ±€å⁄∫',
                'üéôÔ∏è Voice Incident Reporter': 'üéôÔ∏è Ÿàÿßÿ¶ÿ≥ ŸàÿßŸÇÿπ€Å ÿ±ŸæŸàÿ±Ÿπÿ±',
                'Tap mic & describe the incident': 'ŸÖÿßÿ¶€å⁄© ÿØÿ®ÿßÿ¶€å⁄∫ ÿßŸàÿ± ŸàÿßŸÇÿπ€Å ÿ®€åÿßŸÜ ⁄©ÿ±€å⁄∫',
                'Consciousness': 'ÿ¥ÿπŸàÿ±',
                'Bleeding': 'ÿÆŸàŸÜ ÿ®€ÅŸÜÿß',
                'Severity': 'ÿ¥ÿØÿ™',
                'Condition': 'ÿ≠ÿßŸÑÿ™',
                'Apply & Auto-Fill Form': 'ŸÑÿß⁄ØŸà ⁄©ÿ±€å⁄∫ ÿßŸàÿ± ŸÅÿßÿ±ŸÖ ÿ®⁄æÿ±€å⁄∫',
                'or fill manually': '€åÿß ÿÆŸàÿØ ÿ®⁄æÿ±€å⁄∫',
                'Scene Assessment': 'ÿ≥€åŸÜ ÿßÿ≥€åÿ≥ŸÖŸÜŸπ',
                'Consciousness Level (AVPU) *': 'ÿ¥ÿπŸàÿ± ⁄©€å ÿ≥ÿ∑ÿ≠ (AVPU) *',
                'ALERT': '€ÅŸàÿ¥€åÿßÿ±',
                'VERBAL': 'ÿ≤ÿ®ÿßŸÜ€å',
                'PAIN': 'ÿØÿ±ÿØ',
                'No Response': '⁄©Ÿàÿ¶€å ÿ¨Ÿàÿßÿ® ŸÜ€Å€å⁄∫',
                'Active Bleeding Visible': 'ŸÅÿπÿßŸÑ ÿÆŸàŸÜ ÿ®€ÅŸÜÿß ÿØ⁄©⁄æÿßÿ¶€å ÿØ€í ÿ±€Åÿß €Å€í',
                'Open wounds, blood-soaked clothing, pooling': '⁄©⁄æŸÑ€í ÿ≤ÿÆŸÖÿå ÿÆŸàŸÜ ÿ¢ŸÑŸàÿØ ⁄©Ÿæ⁄ë€í',
                'Bleeding / Injury Location *': 'ÿÆŸàŸÜ ÿ®€ÅŸÜÿß / ⁄ÜŸàŸπ ⁄©ÿß ŸÖŸÇÿßŸÖ *',
                'Head\nFace': 'ÿ≥ÿ±\n⁄Ü€Åÿ±€Å',
                'Neck': '⁄Øÿ±ÿØŸÜ',
                'Chest': 'ÿ≥€åŸÜ€Å',
                'Abdomen': 'Ÿæ€åŸπ',
                'Back': 'Ÿæ€åŸπ⁄æ',
                'Arm': 'ÿ®ÿßÿ≤Ÿà',
                'Leg': 'ŸπÿßŸÜ⁄Ø',
                'Multiple': '⁄©ÿ¶€å ŸÖŸÇÿßŸÖÿßÿ™',
                'Mechanism of Injury': '⁄ÜŸàŸπ ⁄©€å Ÿàÿ¨€Å',
                'üöó\nRoad Accident': 'üöó\nÿ≥⁄ë⁄© ÿ≠ÿßÿØÿ´€Å',
                'ü™ú\nFall': 'ü™ú\n⁄Øÿ±ŸÜÿß',
                'üíä\nMedical Event': 'üíä\nÿ∑ÿ®€å ŸàÿßŸÇÿπ€Å',
                'üî•\nBurns/Chemical': 'üî•\nÿ¨ŸÑŸÜÿß/⁄©€åŸÖ€åÿßÿ¶€å',
                '‚ö†Ô∏è\nAssault': '‚ö†Ô∏è\nÿ≠ŸÖŸÑ€Å',
                '‚ùì\nUnknown': '‚ùì\nŸÜÿßŸÖÿπŸÑŸàŸÖ',
                'Clinical Assessment': '⁄©ŸÑ€åŸÜ€å⁄©ŸÑ ÿßÿ≥€åÿ≥ŸÖŸÜŸπ',
                'Severity Level *': 'ÿ¥ÿØÿ™ ⁄©€å ÿ≥ÿ∑ÿ≠ *',
                '1 Minor': '1 ŸÖÿπŸÖŸàŸÑ€å',
                '3 Moderate': '3 ÿØÿ±ŸÖ€åÿßŸÜ€å',
                '4 Serious': '4 ÿ≥ŸÜ⁄Ø€åŸÜ',
                '5 Critical': '5 ÿßŸÜÿ™€Åÿßÿ¶€å ÿ≥ŸÜ⁄Ø€åŸÜ',
                'Auto-checked for UNRESPONSIVE / Severity ‚â• 4': 'UNRESPONSIVE / ÿ¥ÿØÿ™ ‚â• 4 ⁄©€í ŸÑ€å€í ÿÆŸàÿØ⁄©ÿßÿ±',
                'Requires Specialty': 'ÿßÿ≥Ÿæ€åÿ¥ŸÑŸπ€å ÿ∂ÿ±Ÿàÿ±€å',
                'Current Latitude': 'ŸÖŸàÿ¨ŸàÿØ€Å ÿπÿ±ÿ∂ ÿ®ŸÑÿØ',
                'Current Longitude': 'ŸÖŸàÿ¨ŸàÿØ€Å ÿ∑ŸàŸÑ ÿ®ŸÑÿØ',
                'Max Distance (km)': 'ÿ≤€åÿßÿØ€Å ÿ≥€í ÿ≤€åÿßÿØ€Å ŸÅÿßÿµŸÑ€Å (⁄©ŸÑŸàŸÖ€åŸπÿ±)',
                'Max Results': 'ÿ≤€åÿßÿØ€Å ÿ≥€í ÿ≤€åÿßÿØ€Å ŸÜÿ™ÿßÿ¶ÿ¨',
                'üì∑ AI Scan Injury': 'üì∑ AI ÿßÿ≥⁄©€åŸÜ ⁄ÜŸàŸπ',
                'üîç Find Best Hospitals': 'üîç ÿ®€Åÿ™ÿ±€åŸÜ €Åÿ≥Ÿæÿ™ÿßŸÑ ÿ™ŸÑÿßÿ¥ ⁄©ÿ±€å⁄∫',
                'Select Destination Hospital': 'ŸÖŸÜÿ≤ŸÑ €Åÿ≥Ÿæÿ™ÿßŸÑ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫',
                'Rank': 'ÿØÿ±ÿ¨€Å',
                'Hospital': '€Åÿ≥Ÿæÿ™ÿßŸÑ',
                'Distance / ETA': 'ŸÅÿßÿµŸÑ€Å / ETA',
                'Score': 'ÿ≥⁄©Ÿàÿ±',
                'Status Snapshot': 'ÿ≠€åÿ´€åÿ™ ⁄©ÿß ÿÆÿß⁄©€Å',
                'Reasoning': 'Ÿàÿ¨Ÿà€Åÿßÿ™',
                'Action': '⁄©ÿßÿ±ÿ±Ÿàÿßÿ¶€å',
                'Cancel Case': '⁄©€åÿ≥ ŸÖŸÜÿ≥ŸàÿÆ ⁄©ÿ±€å⁄∫',
                'Select': 'ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫',
                'Hospital Selected': '€Åÿ≥Ÿæÿ™ÿßŸÑ ŸÖŸÜÿ™ÿÆÿ®',
                'Destination Confirmed': 'ŸÖŸÜÿ≤ŸÑ ⁄©€å ÿ™ÿµÿØ€åŸÇ',
                'Target:': '€ÅÿØŸÅ:',
                'Prepare for transport.': 'ŸÜŸÇŸÑ Ÿà ÿ≠ŸÖŸÑ ⁄©€í ŸÑ€å€í ÿ™€åÿßÿ± ÿ±€Å€å⁄∫€î',
                'Start Route': 'ÿ±ÿßÿ≥ÿ™€Å ÿ¥ÿ±Ÿàÿπ ⁄©ÿ±€å⁄∫',
                'Cancel': 'ŸÖŸÜÿ≥ŸàÿÆ ⁄©ÿ±€å⁄∫',
                'En Route to Hospital': '€Åÿ≥Ÿæÿ™ÿßŸÑ ⁄©€å ÿ∑ÿ±ŸÅ ÿ±ÿßÿ≥ÿ™€í ŸÖ€å⁄∫',
                'Mark Arrived': 'Ÿæ€ÅŸÜ⁄ÜŸÜ€í ⁄©€å ÿ™ÿµÿØ€åŸÇ',
                'Re-Evaluate Destination': 'ŸÖŸÜÿ≤ŸÑ ⁄©ÿß ÿØŸàÿ®ÿßÿ±€Å ÿ¨ÿßÿ¶ÿ≤€Å',
                'Arrived at Hospital': '€Åÿ≥Ÿæÿ™ÿßŸÑ Ÿæ€ÅŸÜ⁄Ü ⁄Øÿ¶€í',
                'Transferring patient...': 'ŸÖÿ±€åÿ∂ ⁄©Ÿà ŸÖŸÜÿ™ŸÇŸÑ ⁄©ÿ± ÿ±€Å€í €Å€å⁄∫...',
                'Patient Admitted': 'ŸÖÿ±€åÿ∂ ÿØÿßÿÆŸÑ',
                'Mission Complete': 'ŸÖÿ¥ŸÜ ŸÖ⁄©ŸÖŸÑ',
                'Patient successfully admitted.': 'ŸÖÿ±€åÿ∂ ⁄©ÿßŸÖ€åÿßÿ®€å ÿ≥€í ÿØÿßÿÆŸÑ €ÅŸà ⁄Ø€åÿß€î',
                'Complete & Return to Idle': 'ŸÖ⁄©ŸÖŸÑ ⁄©ÿ±€å⁄∫ ÿßŸàÿ± ÿ∫€åÿ± ŸÅÿπÿßŸÑ ŸàÿßŸæÿ≥',
                'EMERGENCY ALERT': '€ÅŸÜ⁄ØÿßŸÖ€å ÿßŸÜÿ™ÿ®ÿß€Å',
                'SOS Request Nearby': 'ŸÇÿ±€åÿ® SOS ÿØÿ±ÿÆŸàÿßÿ≥ÿ™',
                'Distance:': 'ŸÅÿßÿµŸÑ€Å:',
                'km': '⁄©ŸÑŸàŸÖ€åŸπÿ±',
                'Ignore': 'ŸÜÿ∏ÿ±ÿßŸÜÿØÿßÿ≤ ⁄©ÿ±€å⁄∫',
                'ACCEPT': 'ŸÇÿ®ŸàŸÑ ⁄©ÿ±€å⁄∫',
                'Severity Re-Evaluation': 'ÿ¥ÿØÿ™ ⁄©ÿß ÿØŸàÿ®ÿßÿ±€Å ÿ¨ÿßÿ¶ÿ≤€Å',
                'Using live ambulance position for new decision': 'ŸÜÿ¶€í ŸÅ€åÿµŸÑ€í ⁄©€í ŸÑ€å€í ŸÑÿßÿ¶€åŸà ÿß€åŸÖÿ®ŸàŸÑ€åŸÜÿ≥ ŸæŸàÿ≤€åÿ¥ŸÜ',
                'Patient Severity (1 = Minor ¬∑ 5 = Critical)': 'ŸÖÿ±€åÿ∂ ⁄©€å ÿ¥ÿØÿ™ (1 = ŸÖÿπŸÖŸàŸÑ€å ¬∑ 5 = ÿßŸÜÿ™€Åÿßÿ¶€å ÿ≥ŸÜ⁄Ø€åŸÜ)',
                '2': '2',
                '4': '4',
                'Intensive care unit bed needed': 'ICU ÿ®ÿ≥ÿ™ÿ± ⁄©€å ÿ∂ÿ±Ÿàÿ±ÿ™ €Å€í',
                'Find Better Hospital': 'ÿ®€Åÿ™ÿ± €Åÿ≥Ÿæÿ™ÿßŸÑ ÿ™ŸÑÿßÿ¥ ⁄©ÿ±€å⁄∫',
                'Higher Capability Hospital Found': 'ÿ≤€åÿßÿØ€Å ÿµŸÑÿßÿ≠€åÿ™ ŸàÿßŸÑÿß €Åÿ≥Ÿæÿ™ÿßŸÑ ŸÖŸÑÿß',
                'A better match for the updated severity profile': 'ÿßŸæ⁄à€åŸπ ÿ¥ÿØ€Å ÿ¥ÿØÿ™ Ÿæÿ±ŸàŸÅÿßÿ¶ŸÑ ⁄©€í ŸÑ€å€í ÿ®€Åÿ™ÿ± ŸÖÿ∑ÿßÿ®ŸÇÿ™',
                'Current': 'ŸÖŸàÿ¨ŸàÿØ€Å',
                'ACTIVE': 'ŸÅÿπÿßŸÑ',
                'Recommended': 'ÿ™ÿ¨Ÿà€åÿ≤ ⁄©ÿ±ÿØ€Å',
                'BETTER MATCH': 'ÿ®€Åÿ™ÿ± ŸÖÿ∑ÿßÿ®ŸÇÿ™',
                'Transfer reservation and reroute ambulance?': 'ÿ±€åÿ≤ÿ±Ÿà€åÿ¥ŸÜ ŸÖŸÜÿ™ŸÇŸÑ ⁄©ÿ±€å⁄∫ ÿßŸàÿ± ÿß€åŸÖÿ®ŸàŸÑ€åŸÜÿ≥ ⁄©Ÿà ÿØŸàÿ®ÿßÿ±€Å ÿ±ŸàŸπ ⁄©ÿ±€å⁄∫ÿü',
                'Old reservation will be cancelled atomically.': 'Ÿæÿ±ÿßŸÜ€å ÿ±€åÿ≤ÿ±Ÿà€åÿ¥ŸÜ ŸÖŸÜÿ≥ŸàÿÆ €ÅŸà ÿ¨ÿßÿ¶€í ⁄Ø€å€î',
                'Confirm & Reroute': 'ÿ™ÿµÿØ€åŸÇ ⁄©ÿ±€å⁄∫ ÿßŸàÿ± ÿØŸàÿ®ÿßÿ±€Å ÿ±ŸàŸπ ⁄©ÿ±€å⁄∫',
                'Trauma': 'ÿµÿØŸÖ€Å',
                'Orthopedics': 'ÿ¢ÿ±ÿ™⁄æŸàŸæ€å⁄à⁄©ÿ≥',
                'Neurosurgery': 'ŸÜ€åŸàÿ±Ÿà ÿ≥ÿ±ÿ¨ÿ±€å',
                'Cardiology': 'ÿßŸÖÿ±ÿßÿ∂ ŸÇŸÑÿ®',
                'Burns Unit': 'ÿ¨ŸÑŸÜ€í ⁄©ÿß €åŸàŸÜŸπ',
                'General Surgery': 'ÿ¨ŸÜÿ±ŸÑ ÿ≥ÿ±ÿ¨ÿ±€å',
                'Arrived at destination': 'ŸÖŸÜÿ≤ŸÑ Ÿæÿ± Ÿæ€ÅŸÜ⁄Ü ⁄Øÿ¶€í',
                'Proceed to destination': 'ŸÖŸÜÿ≤ŸÑ ⁄©€å ÿ∑ÿ±ŸÅ ÿ®⁄ë⁄æ€å⁄∫',
            }
        };

        // Placeholder text translations
        const PLACEHOLDER_MAP = {
            te: {
                'Enter Username': '‡∞Ø‡±Ç‡∞ú‡∞∞‡±ç ‡∞™‡±á‡∞∞‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø',
                'Enter Password': '‡∞™‡∞æ‡∞∏‡±ç‚Äå‡∞µ‡∞∞‡±ç‡∞°‡±ç ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø',
                'e.g., GVK EMRI': '‡∞â‡∞¶‡∞æ., GVK EMRI',
                'Latitude': '‡∞Ö‡∞ï‡±ç‡∞∑‡∞æ‡∞Ç‡∞∂‡∞Ç',
                'Longitude': '‡∞∞‡±á‡∞ñ‡∞æ‡∞Ç‡∞∂‡∞Ç',
                'e.g. Trauma, Cardiac': '‡∞â‡∞¶‡∞æ. ‡∞ü‡±ç‡∞∞‡∞æ‡∞Æ‡∞æ, ‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡∞ø‡∞Ø‡∞æ‡∞ï‡±ç',
                'e.g., Orthopedics, Neurosurgery': '‡∞â‡∞¶‡∞æ., ‡∞Ü‡∞∞‡±ç‡∞•‡±ã‡∞™‡±Ü‡∞°‡∞ø‡∞ï‡±ç‡∞∏‡±ç, ‡∞®‡±ç‡∞Ø‡±Ç‡∞∞‡±ã‡∞∏‡∞∞‡±ç‡∞ú‡∞∞‡±Ä',
            },
            hi: {
                'Enter Username': '‡§Ø‡•Ç‡§ú‡§º‡§∞‡§®‡•á‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                'Enter Password': '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                'e.g., GVK EMRI': '‡§â‡§¶‡§æ., GVK EMRI',
                'Latitude': '‡§Ö‡§ï‡•ç‡§∑‡§æ‡§Ç‡§∂',
                'Longitude': '‡§¶‡•á‡§∂‡§æ‡§Ç‡§§‡§∞',
                'e.g. Trauma, Cardiac': '‡§â‡§¶‡§æ. ‡§ü‡•ç‡§∞‡§æ‡§Æ‡§æ, ‡§ï‡§æ‡§∞‡•ç‡§°‡§ø‡§Ø‡§ï',
                'e.g., Orthopedics, Neurosurgery': '‡§â‡§¶‡§æ., ‡§ë‡§∞‡•ç‡§•‡•ã‡§™‡•á‡§°‡§ø‡§ï‡•ç‡§∏, ‡§®‡•ç‡§Ø‡•Ç‡§∞‡•ã‡§∏‡§∞‡•ç‡§ú‡§∞‡•Ä',
            },
            ur: {
                'Enter Username': 'ÿµÿßÿ±ŸÅ ŸÜÿßŸÖ ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫',
                'Enter Password': 'Ÿæÿßÿ≥ Ÿàÿ±⁄à ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫',
                'e.g., GVK EMRI': 'ŸÖÿ´ŸÑÿßŸãÿå GVK EMRI',
                'Latitude': 'ÿπÿ±ÿ∂ ÿ®ŸÑÿØ',
                'Longitude': 'ÿ∑ŸàŸÑ ÿ®ŸÑÿØ',
                'e.g. Trauma, Cardiac': 'ŸÖÿ´ŸÑÿßŸã ÿµÿØŸÖ€Åÿå ŸÇŸÑÿ®€å',
                'e.g., Orthopedics, Neurosurgery': 'ŸÖÿ´ŸÑÿßŸãÿå ÿ¢ÿ±ÿ™⁄æŸàŸæ€å⁄à⁄©ÿ≥ÿå ŸÜ€åŸàÿ±Ÿà ÿ≥ÿ±ÿ¨ÿ±€å',
            }
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // VOICE INCIDENT REPORTER
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        let voiceRecognition = null;
        let voiceIsRecording = false;
        let voiceSilenceTimer = null;
        let voiceParsedData = null;
        const SpeechRecognitionAPI = window.SpeechRecognition || window.webkitSpeechRecognition;

        // Check for browser support on load
        (function () {
            if (!SpeechRecognitionAPI) {
                const unsupported = document.getElementById('voiceUnsupported');
                if (unsupported) unsupported.style.display = 'block';
                const micBtn = document.getElementById('voiceMicBtn');
                if (micBtn) micBtn.style.display = 'none';
                const status = document.getElementById('voiceStatus');
                if (status) status.style.display = 'none';
                const langPills = document.getElementById('voiceLangPills');
                if (langPills) langPills.style.display = 'none';
            }
        })();

        // Map UI language to Web Speech API language codes
        const SPEECH_LANG_MAP = {
            en: 'en-IN',
            te: 'te-IN',
            hi: 'hi-IN'
        };

        // Dedicated voice language (independent from UI language)
        let voiceLang = 'en';

        function setVoiceLang(lang) {
            voiceLang = lang;
            document.querySelectorAll('.voice-lang-pill').forEach(pill => {
                pill.classList.toggle('active', pill.getAttribute('data-vlang') === lang);
            });
            const status = document.getElementById('voiceStatus');
            const langNames = { en: 'English', te: '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å', hi: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä' };
            status.textContent = `üåê ${langNames[lang] || lang} selected. Tap mic to speak.`;
            status.className = 'voice-status';
        }

        // Create a FRESH SpeechRecognition instance with the given language
        // Chrome REQUIRES a new instance to reliably switch languages
        function createRecognition(langCode) {
            if (!SpeechRecognitionAPI) return null;

            const rec = new SpeechRecognitionAPI();
            rec.continuous = true;
            rec.interimResults = true;
            rec.lang = langCode;
            rec.maxAlternatives = 1;

            rec.onresult = function (event) {
                let transcript = '';
                let isFinal = false;
                for (let i = 0; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                    if (event.results[i].isFinal) isFinal = true;
                }
                const el = document.getElementById('voiceTranscript');
                el.textContent = transcript;
                el.classList.add('visible');

                // Reset silence timer on every result
                clearTimeout(voiceSilenceTimer);
                voiceSilenceTimer = setTimeout(() => stopVoiceRecording(), 3000);

                if (isFinal) {
                    voiceParsedData = parseVoiceInput(transcript);
                    showVoicePreview(voiceParsedData);
                }
            };

            rec.onerror = function (event) {
                console.error('Speech error:', event.error);
                const status = document.getElementById('voiceStatus');
                if (event.error === 'no-speech') {
                    status.textContent = 'No speech detected. Try again.';
                    status.className = 'voice-status error';
                } else if (event.error === 'not-allowed') {
                    status.textContent = 'Microphone blocked. Allow access in browser settings.';
                    status.className = 'voice-status error';
                } else if (event.error === 'language-not-supported') {
                    status.textContent = 'This language is not supported by your browser. Try English.';
                    status.className = 'voice-status error';
                } else {
                    status.textContent = 'Error: ' + event.error;
                    status.className = 'voice-status error';
                }
                resetVoiceMicUI();
            };

            rec.onend = function () {
                if (voiceIsRecording) {
                    stopVoiceRecording();
                }
            };

            return rec;
        }

        function toggleVoiceRecording() {
            if (voiceIsRecording) {
                stopVoiceRecording();
            } else {
                startVoiceRecording();
            }
        }

        function startVoiceRecording() {
            if (!SpeechRecognitionAPI) return;

            // Create a FRESH instance for every recording
            const speechLang = SPEECH_LANG_MAP[voiceLang] || 'en-IN';
            voiceRecognition = createRecognition(speechLang);
            if (!voiceRecognition) return;

            voiceIsRecording = true;
            voiceParsedData = null;

            console.log('[Voice] Starting recognition with language:', speechLang);

            const btn = document.getElementById('voiceMicBtn');
            btn.classList.add('recording');
            btn.querySelector('i').className = 'fa-solid fa-stop';

            const status = document.getElementById('voiceStatus');
            const langNames = { en: 'English', te: '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å', hi: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä' };
            const listenMsgs = {
                en: `üî¥ Listening in ${langNames[voiceLang]}... Describe the incident`,
                te: `üî¥ ${langNames[voiceLang]} ‡∞≤‡±ã ‡∞µ‡∞ø‡∞®‡∞¨‡∞°‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø... ‡∞ò‡∞ü‡∞® ‡∞µ‡∞ø‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø`,
                hi: `üî¥ ${langNames[voiceLang]} ‡§Æ‡•á‡§Ç ‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•à... ‡§ò‡§ü‡§®‡§æ ‡§¨‡§§‡§æ‡§è‡§Å`
            };
            status.textContent = listenMsgs[currentLang] || listenMsgs.en;
            status.className = 'voice-status recording';

            document.getElementById('voiceTranscript').textContent = '';
            document.getElementById('voiceTranscript').classList.remove('visible');
            document.getElementById('voicePreview').classList.remove('visible');

            try {
                voiceRecognition.start();
            } catch (e) {
                console.warn('Recognition already started');
            }

            // Auto-stop after 15 seconds max
            voiceSilenceTimer = setTimeout(() => stopVoiceRecording(), 15000);
        }

        function stopVoiceRecording() {
            voiceIsRecording = false;
            clearTimeout(voiceSilenceTimer);

            try {
                voiceRecognition.stop();
            } catch (e) { /* ignore */ }

            const btn = document.getElementById('voiceMicBtn');
            btn.classList.remove('recording');
            btn.classList.add('processing');
            btn.querySelector('i').className = 'fa-solid fa-spinner';

            const status = document.getElementById('voiceStatus');
            status.textContent = '‚öôÔ∏è Analyzing speech...';
            status.className = 'voice-status';

            setTimeout(() => {
                resetVoiceMicUI();
                const transcript = document.getElementById('voiceTranscript').textContent;
                if (!transcript) {
                    status.textContent = 'No speech detected. Tap mic to try again.';
                    status.className = 'voice-status error';
                } else if (!voiceParsedData) {
                    const raw = transcript;
                    voiceParsedData = parseVoiceInput(raw);
                    showVoicePreview(voiceParsedData);
                    status.textContent = '‚úÖ Review below, then Apply.';
                    status.className = 'voice-status success';
                } else {
                    showVoicePreview(voiceParsedData);
                    status.textContent = '‚úÖ Review below, then Apply.';
                    status.className = 'voice-status success';
                }
            }, 600);
        }

        function resetVoiceMicUI() {
            const btn = document.getElementById('voiceMicBtn');
            btn.classList.remove('recording', 'processing');
            btn.querySelector('i').className = 'fa-solid fa-microphone';
        }

        function resetVoiceAndRerecord() {
            voiceParsedData = null;
            document.getElementById('voiceTranscript').textContent = '';
            document.getElementById('voiceTranscript').classList.remove('visible');
            document.getElementById('voicePreview').classList.remove('visible');
            document.getElementById('vpConsciousness').textContent = '--';
            document.getElementById('vpBleeding').textContent = '--';
            document.getElementById('vpSeverity').textContent = '--';
            document.getElementById('vpCondition').textContent = '--';
            document.getElementById('voiceRerecordBtn').classList.remove('show');

            const status = document.getElementById('voiceStatus');
            status.textContent = 'Tap mic & describe the incident';
            status.className = 'voice-status';

            setTimeout(() => startVoiceRecording(), 300);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NLP Parser (EMT-adapted: AVPU, bleeding, severity, condition) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function parseVoiceInput(text) {
            const t = text.toLowerCase().trim();
            const result = {
                consciousness: null,    // ALERT, VERBAL, PAIN, UNRESPONSIVE
                bleeding: null,         // true/false
                bleedingLocation: null,  // head, chest, leg, etc.
                severity: null,         // 1-5
                severityLabel: '',
                condition: null,        // e.g. 'Road Accident', 'Cardiac Emergency'
                moi: null               // mechanism of injury code
            };

            // --- CONSCIOUSNESS (AVPU) ---
            // English
            if (/\b(unconscious|unresponsive|not responding|no response|comatose|no pulse|not breathing)\b/.test(t)) {
                result.consciousness = 'UNRESPONSIVE';
            } else if (/\b(responds? to pain|pain only|eye opening to pain|moaning|groaning|grimacing)\b/.test(t)) {
                result.consciousness = 'PAIN';
            } else if (/\b(responds? to voice|verbal|confused|disoriented|mumbling|slurred|semi[- ]?conscious)\b/.test(t)) {
                result.consciousness = 'VERBAL';
            } else if (/\b(alert|conscious|awake|responsive|talking|walking|oriented|lucid)\b/.test(t)) {
                result.consciousness = 'ALERT';
            }
            // Telugu consciousness
            else if (/‡∞∏‡±ç‡∞™‡±É‡∞π ‡∞≤‡±á‡∞¶‡±Å|‡∞∏‡±ç‡∞™‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡∞°‡∞Ç ‡∞≤‡±á‡∞¶‡±Å|‡∞™‡±ç‡∞∞‡∞§‡∞ø‡∞∏‡±ç‡∞™‡∞Ç‡∞¶‡∞® ‡∞≤‡±á‡∞¶‡±Å|‡∞ï‡±ã‡∞Æ‡∞æ/.test(t)) {
                result.consciousness = 'UNRESPONSIVE';
            } else if (/‡∞®‡±ä‡∞™‡±ç‡∞™‡∞ø‡∞ï‡∞ø ‡∞∏‡±ç‡∞™‡∞Ç‡∞¶‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞°‡±Å|‡∞Æ‡±Ç‡∞≤‡±Å‡∞ó‡±Å‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞°‡±Å/.test(t)) {
                result.consciousness = 'PAIN';
            } else if (/‡∞Æ‡∞æ‡∞ü‡∞≤‡∞ï‡±Å ‡∞∏‡±ç‡∞™‡∞Ç‡∞¶‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞°‡±Å|‡∞Ö‡∞Ø‡±ã‡∞Æ‡∞Ø‡∞Ç‡∞ó‡∞æ|‡∞∏‡∞ó‡∞Ç ‡∞∏‡±ç‡∞™‡±É‡∞π/.test(t)) {
                result.consciousness = 'VERBAL';
            } else if (/‡∞∏‡±ç‡∞™‡±É‡∞π ‡∞â‡∞Ç‡∞¶‡∞ø|‡∞Æ‡±Ü‡∞≤‡∞ï‡±Å‡∞µ‡∞ó‡∞æ|‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡±Å‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞°‡±Å|‡∞®‡∞°‡±Å‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞°‡±Å/.test(t)) {
                result.consciousness = 'ALERT';
            }
            // Hindi consciousness
            else if (/‡§¨‡•á‡§π‡•ã‡§∂|‡§π‡•ã‡§∂ ‡§®‡§π‡•Ä‡§Ç|‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç|‡§ï‡•ã‡§Æ‡§æ|‡§∏‡§æ‡§Ç‡§∏ ‡§®‡§π‡•Ä‡§Ç/.test(t)) {
                result.consciousness = 'UNRESPONSIVE';
            } else if (/‡§¶‡§∞‡•ç‡§¶ ‡§™‡§∞ ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ|‡§ï‡§∞‡§æ‡§π ‡§∞‡§π‡§æ|‡§∏‡§ø‡§∏‡§ï ‡§∞‡§π‡§æ/.test(t)) {
                result.consciousness = 'PAIN';
            } else if (/‡§Ü‡§µ‡§æ‡§ú‡§º ‡§™‡§∞ ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ|‡§≠‡•ç‡§∞‡§Æ‡§ø‡§§|‡§Ö‡§∞‡•ç‡§ß[- ]?‡§ö‡•á‡§§‡§®/.test(t)) {
                result.consciousness = 'VERBAL';
            } else if (/‡§π‡•ã‡§∂ ‡§Æ‡•á‡§Ç|‡§ú‡§æ‡§ó ‡§∞‡§π‡§æ|‡§¨‡§æ‡§§ ‡§ï‡§∞ ‡§∞‡§π‡§æ|‡§ö‡§≤ ‡§∞‡§π‡§æ|‡§∏‡§ö‡•á‡§§/.test(t)) {
                result.consciousness = 'ALERT';
            }

            // --- BLEEDING ---
            // English
            if (/\b(bleed|blood|bleeding|hemorrh|haemorrhag|blood loss|blood-soaked|pooling|wound|laceration|cut|stab|open wound)\b/.test(t)) {
                result.bleeding = true;
            }
            // Telugu bleeding
            else if (/‡∞∞‡∞ï‡±ç‡∞§‡∞Ç|‡∞∞‡∞ï‡±ç‡∞§‡∞∏‡±ç‡∞∞‡∞æ‡∞µ‡∞Ç|‡∞ó‡∞æ‡∞Ø‡∞Ç|‡∞ï‡∞ü‡±ç|‡∞™‡±ã‡∞ü‡±ç|‡∞∞‡∞ï‡±ç‡∞§‡∞Ç ‡∞ï‡∞æ‡∞∞‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø/.test(t)) {
                result.bleeding = true;
            }
            // Hindi bleeding
            else if (/‡§ñ‡•Ç‡§®|‡§∞‡§ï‡•ç‡§§‡§∏‡•ç‡§∞‡§æ‡§µ|‡§ò‡§æ‡§µ|‡§ï‡§ü|‡§õ‡•Å‡§∞‡§æ|‡§ñ‡•Ç‡§® ‡§¨‡§π ‡§∞‡§π‡§æ/.test(t)) {
                result.bleeding = true;
            }

            // Bleeding location
            if (result.bleeding) {
                if (/\b(head|face|skull|forehead)\b/.test(t) || /‡∞§‡∞≤|‡∞Æ‡±Å‡∞ñ‡∞Ç/.test(t) || /‡§∏‡§ø‡§∞|‡§ö‡•á‡§π‡§∞‡§æ/.test(t)) result.bleedingLocation = 'head';
                else if (/\b(neck|throat)\b/.test(t) || /‡∞Æ‡±Ü‡∞°|‡∞ó‡±ä‡∞Ç‡∞§‡±Å/.test(t) || /‡§ó‡§∞‡•ç‡§¶‡§®|‡§ó‡§≤‡§æ/.test(t)) result.bleedingLocation = 'neck';
                else if (/\b(chest|rib|torso)\b/.test(t) || /‡∞õ‡∞æ‡∞§‡±Ä|‡∞™‡∞ï‡±ç‡∞ï‡∞ü‡±Ü‡∞Æ‡±Å‡∞ï/.test(t) || /‡§õ‡§æ‡§§‡•Ä|‡§™‡§∏‡§≤‡•Ä/.test(t)) result.bleedingLocation = 'chest';
                else if (/\b(abdomen|stomach|belly|gut)\b/.test(t) || /‡∞™‡±ä‡∞ü‡±ç‡∞ü|‡∞ï‡∞°‡±Å‡∞™‡±Å/.test(t) || /‡§™‡•á‡§ü/.test(t)) result.bleedingLocation = 'abdomen';
                else if (/\b(back|spine)\b/.test(t) || /‡∞µ‡±Ä‡∞™‡±Å|‡∞µ‡±Ü‡∞®‡±ç‡∞®‡±Å/.test(t) || /‡§™‡•Ä‡§†|‡§∞‡•Ä‡§¢‡§º/.test(t)) result.bleedingLocation = 'back';
                else if (/\b(arm|hand|wrist|elbow|shoulder)\b/.test(t) || /‡∞ö‡±á‡∞Ø‡∞ø|‡∞≠‡±Å‡∞ú‡∞Ç/.test(t) || /‡§π‡§æ‡§•|‡§¨‡§æ‡§Ç‡§π|‡§ï‡•ã‡§π‡§®‡•Ä|‡§ï‡§Ç‡§ß‡§æ/.test(t)) result.bleedingLocation = 'arm';
                else if (/\b(leg|foot|knee|thigh|ankle|shin)\b/.test(t) || /‡∞ï‡∞æ‡∞≤‡±Å|‡∞Æ‡±ã‡∞ï‡∞æ‡∞≤‡±Å|‡∞§‡±ä‡∞°/.test(t) || /‡§™‡•à‡§∞|‡§ü‡§æ‡§Ç‡§ó|‡§ú‡§æ‡§Ç‡§ò|‡§ò‡•Å‡§ü‡§®‡§æ/.test(t)) result.bleedingLocation = 'leg';
                else if (/\b(multiple|everywhere|several)\b/.test(t) || /‡∞Ö‡∞®‡±á‡∞ï|‡∞é‡∞ï‡±ç‡∞ï‡∞°‡∞æ/.test(t) || /‡§ï‡§à ‡§ú‡§ó‡§π/.test(t)) result.bleedingLocation = 'multiple';
            }

            // --- SEVERITY ---
            // English
            if (/\b(critical|life[- ]?threatening|cardiac arrest|heart attack|dying|not breathing|no pulse|code blue)\b/.test(t)) {
                result.severity = 5; result.severityLabel = 'Critical';
            } else if (/\b(very serious|severe|major|heavy bleeding|multiple injuries|stroke|brain|skull|stab|gunshot|crush)\b/.test(t)) {
                result.severity = 4; result.severityLabel = 'Severe';
            } else if (/\b(serious|bad|broken|fracture|burn|deep cut|accident|crash|collision|fall from height)\b/.test(t)) {
                result.severity = 3; result.severityLabel = 'Serious';
            } else if (/\b(moderate|pain|fever|dizzy|vomit|sprain|breathing problem|chest pain|swelling)\b/.test(t)) {
                result.severity = 2; result.severityLabel = 'Moderate';
            } else if (/\b(minor|small|slight|scratch|bruise|headache|cold|cough|mild)\b/.test(t)) {
                result.severity = 1; result.severityLabel = 'Minor';
            }
            // Telugu severity
            else if (/‡∞™‡±ç‡∞∞‡∞æ‡∞£‡∞æ‡∞Ç‡∞§‡∞ï‡∞Ç|‡∞ö‡∞®‡∞ø‡∞™‡±ã‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞°‡±Å|‡∞∏‡±ç‡∞™‡±É‡∞π ‡∞≤‡±á‡∞¶‡±Å|‡∞ä‡∞™‡∞ø‡∞∞‡∞ø ‡∞Ü‡∞ó‡∞ø‡∞Ç‡∞¶‡∞ø|‡∞ó‡±Å‡∞Ç‡∞°‡±Ü ‡∞Ü‡∞ó‡∞ø‡∞Ç‡∞¶‡∞ø/.test(t)) {
                result.severity = 5; result.severityLabel = 'Critical';
            } else if (/‡∞ö‡∞æ‡∞≤‡∞æ ‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞Ç|‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞Æ‡±à‡∞®|‡∞é‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞∞‡∞ï‡±ç‡∞§‡∞Ç|‡∞™‡∞ï‡±ç‡∞∑‡∞µ‡∞æ‡∞§‡∞Ç|‡∞Æ‡±Ü‡∞¶‡∞°‡±Å/.test(t)) {
                result.severity = 4; result.severityLabel = 'Severe';
            } else if (/‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞Ç|‡∞™‡±ç‡∞∞‡∞Æ‡∞æ‡∞¶‡∞Ç|‡∞∞‡∞ï‡±ç‡∞§‡∞Ç|‡∞é‡∞Æ‡±Å‡∞ï ‡∞µ‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø‡∞Ç‡∞¶‡∞ø|‡∞ï‡∞æ‡∞≤‡∞ø‡∞®|‡∞ó‡∞æ‡∞Ø‡∞Ç|‡∞™‡∞°‡∞ø‡∞™‡±ã‡∞Ø‡∞æ‡∞°‡±Å/.test(t)) {
                result.severity = 3; result.severityLabel = 'Serious';
            } else if (/‡∞®‡±ä‡∞™‡±ç‡∞™‡∞ø|‡∞ú‡±ç‡∞µ‡∞∞‡∞Ç|‡∞µ‡∞æ‡∞Ç‡∞§‡∞ø|‡∞ä‡∞™‡∞ø‡∞∞‡∞ø|‡∞µ‡∞æ‡∞™‡±Å/.test(t)) {
                result.severity = 2; result.severityLabel = 'Moderate';
            } else if (/‡∞ö‡∞ø‡∞®‡±ç‡∞®|‡∞∏‡±ç‡∞µ‡∞≤‡±ç‡∞™‡∞Ç|‡∞ó‡±Ä‡∞§|‡∞§‡∞≤‡∞®‡±ä‡∞™‡±ç‡∞™‡∞ø|‡∞ú‡∞≤‡±Å‡∞¨‡±Å|‡∞¶‡∞ó‡±ç‡∞ó‡±Å/.test(t)) {
                result.severity = 1; result.severityLabel = 'Minor';
            }
            // Hindi severity
            else if (/‡§ó‡§Ç‡§≠‡•Ä‡§∞ ‡§π‡§æ‡§≤‡§§|‡§ú‡§æ‡§®‡§≤‡•á‡§µ‡§æ|‡§Æ‡§∞ ‡§∞‡§π‡§æ|‡§∏‡§æ‡§Ç‡§∏ ‡§∞‡•Å‡§ï|‡§¶‡§ø‡§≤ ‡§ï‡§æ ‡§¶‡•å‡§∞‡§æ|‡§¶‡§ø‡§≤ ‡§∞‡•Å‡§ï/.test(t)) {
                result.severity = 5; result.severityLabel = 'Critical';
            } else if (/‡§¨‡§π‡•Å‡§§ ‡§ó‡§Ç‡§≠‡•Ä‡§∞|‡§≠‡§æ‡§∞‡•Ä ‡§ñ‡•Ç‡§®|‡§≤‡§ï‡§µ‡§æ|‡§¶‡§ø‡§Æ‡§æ‡§ó|‡§ó‡•ã‡§≤‡•Ä/.test(t)) {
                result.severity = 4; result.severityLabel = 'Severe';
            } else if (/‡§ó‡§Ç‡§≠‡•Ä‡§∞|‡§ñ‡•Ç‡§®|‡§ü‡•Ç‡§ü|‡§π‡§°‡•ç‡§°‡•Ä|‡§ú‡§≤|‡§¶‡•Å‡§∞‡•ç‡§ò‡§ü‡§®‡§æ|‡§è‡§ï‡•ç‡§∏‡•Ä‡§°‡•á‡§Ç‡§ü|‡§ó‡§ø‡§∞|‡§ò‡§æ‡§µ|‡§ö‡•ã‡§ü/.test(t)) {
                result.severity = 3; result.severityLabel = 'Serious';
            } else if (/‡§¶‡§∞‡•ç‡§¶|‡§¨‡•Å‡§ñ‡§æ‡§∞|‡§ö‡§ï‡•ç‡§ï‡§∞|‡§â‡§≤‡•ç‡§ü‡•Ä|‡§Æ‡•ã‡§ö|‡§∏‡§æ‡§Ç‡§∏|‡§∏‡•Ç‡§ú‡§®/.test(t)) {
                result.severity = 2; result.severityLabel = 'Moderate';
            } else if (/‡§Æ‡§æ‡§Æ‡•Ç‡§≤‡•Ä|‡§õ‡•ã‡§ü‡§æ|‡§ñ‡§∞‡•ã‡§Ç‡§ö|‡§∏‡§ø‡§∞‡§¶‡§∞‡•ç‡§¶|‡§∏‡§∞‡•ç‡§¶‡•Ä|‡§ñ‡§æ‡§Ç‡§∏‡•Ä|‡§π‡§≤‡•ç‡§ï‡§æ/.test(t)) {
                result.severity = 1; result.severityLabel = 'Minor';
            }

            // --- CONDITION / MECHANISM OF INJURY ---
            if (/\b(heart|cardiac|chest)\b/.test(t) && /\b(attack|pain|arrest|stop)\b/.test(t)
                || /‡∞ó‡±Å‡∞Ç‡∞°‡±Ü\s*(‡∞®‡±ä‡∞™‡±ç‡∞™‡∞ø|‡∞™‡±ã‡∞ü‡±Å|‡∞Ü‡∞ó‡∞ø‡∞Ç‡∞¶‡∞ø)/.test(t) || /‡∞ó‡±Å‡∞Ç‡∞°‡±Ü‡∞™‡±ã‡∞ü‡±Å/.test(t)
                || /‡§¶‡§ø‡§≤\s*(‡§ï‡§æ ‡§¶‡•å‡§∞‡§æ|‡§¶‡§∞‡•ç‡§¶|‡§∞‡•Å‡§ï)/.test(t) || /‡§π‡§æ‡§∞‡•ç‡§ü ‡§Ö‡§ü‡•à‡§ï/.test(t)) {
                result.condition = 'Cardiac Emergency';
                result.moi = 'cardiac_event';
                if (!result.severity || result.severity < 4) { result.severity = 5; result.severityLabel = 'Critical'; }
            } else if (/\b(stroke|paralysis|paralyzed|one side|brain)\b/.test(t)
                || /‡∞™‡∞ï‡±ç‡∞∑‡∞µ‡∞æ‡∞§‡∞Ç|‡∞Æ‡±Ü‡∞¶‡∞°‡±Å|‡∞í‡∞ï ‡∞µ‡±à‡∞™‡±Å/.test(t)
                || /‡§≤‡§ï‡§µ‡§æ|‡§™‡•à‡§∞‡§æ‡§≤‡§ø‡§∏‡§ø‡§∏|‡§¶‡§ø‡§Æ‡§æ‡§ó|‡§è‡§ï ‡§§‡§∞‡§´/.test(t)) {
                result.condition = 'Stroke / Neuro';
                result.moi = 'cardiac_event';
                if (!result.severity || result.severity < 4) { result.severity = 4; result.severityLabel = 'Severe'; }
            } else if (/\b(accident|crash|collision|hit|truck|car|bike|vehicle|road)\b/.test(t)
                || /‡∞™‡±ç‡∞∞‡∞Æ‡∞æ‡∞¶‡∞Ç|‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡∞ø‡∞°‡±Ü‡∞Ç‡∞ü‡±ç|‡∞ï‡∞æ‡∞∞‡±Å|‡∞¨‡±à‡∞ï‡±ç|‡∞ü‡±ç‡∞∞‡∞ï‡±ç|‡∞∞‡±ã‡∞°‡±ç‡∞°‡±Å|‡∞¢‡±Ä‡∞ï‡±ä‡∞ü‡±ç‡∞ü‡∞ø‡∞Ç‡∞¶‡∞ø/.test(t)
                || /‡§¶‡•Å‡§∞‡•ç‡§ò‡§ü‡§®‡§æ|‡§è‡§ï‡•ç‡§∏‡•Ä‡§°‡•á‡§Ç‡§ü|‡§ó‡§æ‡§°‡§º‡•Ä|‡§ï‡§æ‡§∞|‡§¨‡§æ‡§á‡§ï|‡§ü‡•ç‡§∞‡§ï|‡§∏‡§°‡§º‡§ï|‡§ü‡§ï‡•ç‡§ï‡§∞/.test(t)) {
                result.condition = 'Road Accident / Trauma';
                result.moi = 'road_accident';
            } else if (/\b(burn|fire|scald|flame|chemical)\b/.test(t)
                || /‡∞ï‡∞æ‡∞≤‡∞ø‡∞®|‡∞Æ‡∞Ç‡∞ü|‡∞Ö‡∞ó‡±ç‡∞®‡∞ø|‡∞ï‡∞æ‡∞≤‡∞ø‡∞Ç‡∞¶‡∞ø/.test(t)
                || /‡§ú‡§≤‡§®‡§æ|‡§ú‡§≤‡§æ|‡§Ü‡§ó|‡§ú‡§≤ ‡§ó‡§Ø‡§æ|‡§∞‡§∏‡§æ‡§Ø‡§®/.test(t)) {
                result.condition = 'Burns';
                result.moi = 'burns';
            } else if (/\b(fall|fell|drop|height|ladder|roof|stairs)\b/.test(t)
                || /‡∞™‡∞°‡∞ø‡∞™‡±ã‡∞Ø‡∞æ‡∞°‡±Å|‡∞™‡∞°‡∞ø‡∞™‡±ã‡∞Ø‡∞ø‡∞Ç‡∞¶‡∞ø|‡∞é‡∞§‡±ç‡∞§‡±Å|‡∞Æ‡±Ü‡∞ü‡±ç‡∞≤‡±Å/.test(t)
                || /‡§ó‡§ø‡§∞ ‡§ó‡§Ø‡§æ|‡§ó‡§ø‡§∞ ‡§ó‡§à|‡§ä‡§Ç‡§ö‡§æ‡§à|‡§∏‡•Ä‡§¢‡§º‡•Ä|‡§õ‡§§/.test(t)) {
                result.condition = 'Fall Injury';
                result.moi = 'fall';
            } else if (/\b(assault|attack|fight|beat|punch|kick|stab|weapon)\b/.test(t)
                || /‡∞¶‡∞æ‡∞°‡∞ø|‡∞ï‡±ä‡∞ü‡±ç‡∞ü‡∞æ‡∞∞‡±Å|‡∞™‡±ã‡∞ü‡±ç‡∞≤‡±Å/.test(t)
                || /‡§π‡§Æ‡§≤‡§æ|‡§Æ‡§æ‡§∞‡§™‡•Ä‡§ü|‡§õ‡•Å‡§∞‡§æ|‡§π‡§•‡§ø‡§Ø‡§æ‡§∞/.test(t)) {
                result.condition = 'Assault';
                result.moi = 'assault';
            } else if (/\b(fracture|broken|bone)\b/.test(t)
                || /‡∞é‡∞Æ‡±Å‡∞ï\s*‡∞µ‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø‡∞Ç‡∞¶‡∞ø|‡∞´‡±ç‡∞∞‡∞æ‡∞ï‡±ç‡∞ö‡∞∞‡±ç/.test(t)
                || /‡§π‡§°‡•ç‡§°‡•Ä\s*‡§ü‡•Ç‡§ü|‡§´‡•ç‡§∞‡•à‡§ï‡•ç‡§ö‡§∞/.test(t)) {
                result.condition = 'Fracture / Orthopedic';
                result.moi = 'fall';
            } else if (/\b(breath|breathing|asthma|choke|choking|suffocate)\b/.test(t)
                || /‡∞ä‡∞™‡∞ø‡∞∞‡∞ø|‡∞Ü‡∞∏‡±ç‡∞§‡∞Æ‡∞æ|‡∞∂‡±ç‡∞µ‡∞æ‡∞∏/.test(t) || /‡§∏‡§æ‡§Ç‡§∏|‡§¶‡§Æ‡§æ|‡§ò‡•Å‡§ü‡§®/.test(t)) {
                result.condition = 'Respiratory Distress';
                result.moi = 'cardiac_event';
            } else if (/\b(seizure|fits|convulsion|epilepsy)\b/.test(t)
                || /‡∞Æ‡±Ç‡∞∞‡±ç‡∞õ|‡∞´‡∞ø‡∞ü‡±ç‡∞∏‡±ç|‡∞µ‡∞£‡±Å‡∞ï‡±Å/.test(t) || /‡§¶‡•å‡§∞‡§æ|‡§Æ‡§ø‡§∞‡•ç‡§ó‡•Ä|‡§´‡§ø‡§ü/.test(t)) {
                result.condition = 'Seizure';
                result.moi = 'cardiac_event';
            } else if (/\b(poison|poisoning|toxic|overdose|drug)\b/.test(t)
                || /‡∞µ‡∞ø‡∞∑‡∞Ç|‡∞Æ‡∞§‡±ç‡∞§‡±Å ‡∞Æ‡∞Ç‡∞¶‡±Å/.test(t) || /‡§ú‡§º‡§π‡§∞|‡§µ‡§ø‡§∑|‡§ì‡§µ‡§∞‡§°‡•ã‡§ú‡§º/.test(t)) {
                result.condition = 'Poisoning / Overdose';
                result.moi = 'unknown';
            } else if (/\b(fever|infection|vomit|diarrhea)\b/.test(t)
                || /‡∞ú‡±ç‡∞µ‡∞∞‡∞Ç|‡∞á‡∞®‡±ç‡∞´‡±Ü‡∞ï‡±ç‡∞∑‡∞®‡±ç|‡∞µ‡∞æ‡∞Ç‡∞§‡∞ø|‡∞µ‡∞ø‡∞∞‡±á‡∞ö‡∞®‡∞æ‡∞≤‡±Å/.test(t)
                || /‡§¨‡•Å‡§ñ‡§æ‡§∞|‡§á‡§®‡•ç‡§´‡•á‡§ï‡•ç‡§∂‡§®|‡§â‡§≤‡•ç‡§ü‡•Ä|‡§¶‡§∏‡•ç‡§§/.test(t)) {
                result.condition = 'Medical / Infection';
                result.moi = 'cardiac_event';
            } else {
                result.condition = 'General Emergency';
                result.moi = 'unknown';
            }

            // Auto-escalate consciousness ‚Üí severity
            if (result.consciousness === 'UNRESPONSIVE' && (!result.severity || result.severity < 4)) {
                result.severity = 4; result.severityLabel = 'Severe';
            } else if (result.consciousness === 'PAIN' && (!result.severity || result.severity < 3)) {
                result.severity = 3; result.severityLabel = 'Serious';
            }

            // If no bleeding explicitly detected but wound/cut/stab mentioned, infer it
            if (result.bleeding === null) {
                if (/\b(wound|laceration|cut|stab|open)\b/.test(t) || /‡∞ó‡∞æ‡∞Ø‡∞Ç|‡∞ï‡∞ü‡±ç|‡∞™‡±ã‡∞ü‡±ç/.test(t) || /‡§ò‡§æ‡§µ|‡§ï‡§ü|‡§õ‡•Å‡§∞‡§æ/.test(t)) {
                    result.bleeding = true;
                } else {
                    result.bleeding = false;
                }
            }

            return result;
        }

        function showVoicePreview(data) {
            if (!data) return;
            const preview = document.getElementById('voicePreview');

            // Consciousness
            const consEl = document.getElementById('vpConsciousness');
            consEl.textContent = data.consciousness || '--';
            if (data.consciousness === 'UNRESPONSIVE') consEl.className = 'voice-chip-value sev-high';
            else if (data.consciousness === 'PAIN') consEl.className = 'voice-chip-value sev-med';
            else consEl.className = 'voice-chip-value sev-low';

            // Bleeding
            const bleedEl = document.getElementById('vpBleeding');
            if (data.bleeding) {
                bleedEl.textContent = data.bleedingLocation ? `YES (${data.bleedingLocation})` : 'YES';
                bleedEl.className = 'voice-chip-value sev-high';
            } else {
                bleedEl.textContent = 'No';
                bleedEl.className = 'voice-chip-value sev-low';
            }

            // Severity
            const sevEl = document.getElementById('vpSeverity');
            if (data.severity) {
                sevEl.textContent = `${data.severity} ‚Äî ${data.severityLabel}`;
                sevEl.className = 'voice-chip-value ' + (data.severity >= 4 ? 'sev-high' : data.severity >= 2 ? 'sev-med' : 'sev-low');
            } else {
                sevEl.textContent = '--';
                sevEl.className = 'voice-chip-value';
            }

            // Condition
            document.getElementById('vpCondition').textContent = data.condition || 'General Emergency';

            // Show re-record button
            document.getElementById('voiceRerecordBtn')?.classList.add('show');

            preview.classList.add('visible');
        }

        function applyVoiceData() {
            const data = voiceParsedData;
            if (!data) return;

            const form = document.getElementById('decisionForm');
            if (!form) return;

            // 1. Apply AVPU Consciousness
            if (data.consciousness) {
                selectAVPU('dec', data.consciousness);
                flashField(document.getElementById('dec-avpu-group'));
            }

            // 2. Apply Bleeding
            if (data.bleeding) {
                const toggle = document.getElementById('dec-bleeding-toggle');
                if (toggle && !toggle.classList.contains('on')) {
                    toggleBleeding('dec');
                }
                flashField(toggle);
                // Set injury location if detected
                if (data.bleedingLocation) {
                    selectLocation('dec', data.bleedingLocation);
                }
            }

            // 3. Apply Severity
            if (data.severity) {
                const slider = document.getElementById('dec-severity');
                if (slider) {
                    slider.value = data.severity;
                    updateEMTSeverity('dec', data.severity);
                    flashField(slider);
                }
            }

            // 4. Apply Mechanism of Injury
            if (data.moi) {
                selectMOI('dec', data.moi);
            }

            // 5. Apply specialty inference from condition
            if (data.condition) {
                const specMap = {
                    'Cardiac Emergency': 'Cardiology',
                    'Stroke / Neuro': 'Neurosurgery',
                    'Road Accident / Trauma': 'Trauma',
                    'Burns': 'Burns Unit',
                    'Fracture / Orthopedic': 'Orthopedics',
                    'Respiratory Distress': 'General Surgery',
                    'Poisoning / Overdose': 'General Surgery'
                };
                const spec = specMap[data.condition];
                if (spec) {
                    setSpecialty('dec', spec);
                }
            }

            // 6. Auto-check ICU for UNRESPONSIVE or severity >= 4
            if (data.consciousness === 'UNRESPONSIVE' || (data.severity && data.severity >= 4)) {
                const icu = document.getElementById('dec-icu');
                if (icu && !icu.checked) {
                    icu.checked = true;
                    icu.dispatchEvent(new Event('change'));
                    const badge = document.getElementById('dec-icu-badge');
                    if (badge) badge.classList.remove('hidden');
                }
            }

            // Update status
            const status = document.getElementById('voiceStatus');
            status.textContent = '‚úÖ Form filled! Review below and submit.';
            status.className = 'voice-status success';

            // Scroll to form
            form.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function flashField(field) {
            if (!field) return;
            field.style.transition = 'background-color 0.3s, border-color 0.3s';
            field.style.backgroundColor = 'rgba(22, 163, 74, 0.15)';
            setTimeout(() => {
                field.style.backgroundColor = '';
                field.style.borderColor = '';
            }, 2000);
        }

        const I18N = {
            en: {
                header_title: 'Ambulance Dispatch ¬∑ Emergency Failover',
                failover_enabled: 'FAILOVER ENABLED',
                local_time: 'LOCAL TIME',
                ambulance_login: 'Ambulance Login',
                enter_credentials: 'Enter credentials to access dispatch',
                username: 'Username',
                password: 'Password',
                login: 'Login',
                register_new_amb: 'Register New Ambulance',
                register_ambulance: 'Register Ambulance',
                reg_number: 'Registration Number',
                organization: 'Organization',
                gps_coordinates: 'GPS Coordinates',
                register_and_login: 'Register & Login',
                reset: 'Reset',
                logout: 'Logout',
                start_new_case: 'Start New Case',
                voice_reporter: 'üéôÔ∏è Voice Incident Reporter',
                voice_desc: 'Tap the mic and describe the incident. The system will auto-detect consciousness, bleeding, severity, and fill the form automatically.',
                voice_tap_mic: 'Tap mic & describe the incident',
                consciousness: 'Consciousness',
                bleeding_label: 'Bleeding',
                severity: 'Severity',
                condition: 'Condition',
                apply_autofill: 'Apply & Auto-Fill Form',
                or_fill_manually: 'or fill manually',
                scene_assessment: 'Scene Assessment',
                avpu_label: 'AVPU Scale',
                bleeding_toggle: 'Active Bleeding?',
                injury_location: 'Injury Location',
                mechanism_of_injury: 'Mechanism of Injury',
                clinical_assessment: 'Clinical Assessment',
                severity_level: 'Severity (1-5)',
                requires_icu: 'Requires ICU',
                specialty_required: 'Specialty Required',
                location: 'Location & Constraints',
                current_lat: 'Current Latitude',
                current_lng: 'Current Longitude',
                max_distance: 'Max Distance (km)',
                ai_scan_injury: 'AI Scan Injury',
                find_best_hospitals: 'Find Best Hospitals',
                select_dest_hospital: 'Select Destination Hospital',
                rank: 'Rank',
                hospital: 'Hospital',
                distance_eta: 'Distance / ETA',
                score: 'Score',
                action: 'Action',
                cancel_case: 'Cancel Case',
                hospital_selected: 'Hospital Selected',
                dest_confirmed: 'Destination Confirmed',
                target: 'Target',
                start_route: 'Start Route',
                en_route_to_hospital: 'En Route to Hospital',
                patient_manifest: 'Patient Manifest',
                mark_arrived: 'Mark Arrived',
                arrived_at_hospital: 'Arrived at Hospital',
                patient_admitted: 'Patient Admitted',
                mission_complete: 'Mission Complete',
                patient_success: 'Patient successfully admitted.',
                complete_return: 'Complete & Return to Idle',
                emergency_breakdown_protocol: 'Emergency Breakdown Protocol',
                report_breakdown: 'REPORT BREAKDOWN',
            },

            te: {
                header_title: '‡∞Ö‡∞Ç‡∞¨‡±Å‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç ‡∞°‡∞ø‡∞∏‡±ç‡∞™‡∞æ‡∞ö‡±ç ¬∑ ‡∞é‡∞Æ‡∞∞‡±ç‡∞ú‡±Ü‡∞®‡±ç‡∞∏‡±Ä ‡∞´‡±Ü‡∞Ø‡∞ø‡∞≤‡±ç‚Äå‡∞ì‡∞µ‡∞∞‡±ç',
                failover_enabled: '‡∞´‡±Ü‡∞Ø‡∞ø‡∞≤‡±ç‚Äå‡∞ì‡∞µ‡∞∞‡±ç ‡∞Ü‡∞®‡±ç',
                local_time: '‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞∏‡∞Æ‡∞Ø‡∞Ç',
                ambulance_login: '‡∞Ö‡∞Ç‡∞¨‡±Å‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç',
                enter_credentials: '‡∞°‡∞ø‡∞∏‡±ç‡∞™‡∞æ‡∞ö‡±ç ‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡±Ü‡∞∏‡±ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø',
                username: '‡∞Ø‡±Ç‡∞ú‡∞∞‡±ç ‡∞™‡±á‡∞∞‡±Å',
                password: '‡∞™‡∞æ‡∞∏‡±ç‚Äå‡∞µ‡∞∞‡±ç‡∞°‡±ç',
                login: '‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç',
                register_new_amb: '‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞Ö‡∞Ç‡∞¨‡±Å‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç ‡∞®‡∞Æ‡±ã‡∞¶‡±Å',
                register_ambulance: '‡∞Ö‡∞Ç‡∞¨‡±Å‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç ‡∞®‡∞Æ‡±ã‡∞¶‡±Å',
                reg_number: '‡∞∞‡∞ø‡∞ú‡∞ø‡∞∏‡±ç‡∞ü‡±ç‡∞∞‡±á‡∞∑‡∞®‡±ç ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç',
                organization: '‡∞∏‡∞Ç‡∞∏‡±ç‡∞•',
                gps_coordinates: 'GPS ‡∞ï‡±ã‡∞Ü‡∞∞‡±ç‡∞°‡∞ø‡∞®‡±á‡∞ü‡±ç‡∞≤‡±Å',
                register_and_login: '‡∞®‡∞Æ‡±ã‡∞¶‡±Å & ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç',
                reset: '‡∞∞‡±Ä‡∞∏‡±Ü‡∞ü‡±ç',
                logout: '‡∞≤‡∞æ‡∞ó‡±ç ‡∞Ö‡∞µ‡±Å‡∞ü‡±ç',
                start_new_case: '‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞ï‡±á‡∞∏‡±Å ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡±Å',
                voice_reporter: 'üéôÔ∏è ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞ò‡∞ü‡∞® ‡∞∞‡∞ø‡∞™‡±ã‡∞∞‡±ç‡∞ü‡∞∞‡±ç',
                voice_desc: '‡∞Æ‡±à‡∞ï‡±ç ‡∞®‡±ä‡∞ï‡±ç‡∞ï‡∞ø ‡∞ò‡∞ü‡∞® ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞Ç‡∞°‡∞ø. ‡∞∏‡∞ø‡∞∏‡±ç‡∞ü‡∞Æ‡±ç ‡∞∏‡±ç‡∞™‡±É‡∞π, ‡∞∞‡∞ï‡±ç‡∞§‡∞∏‡±ç‡∞∞‡∞æ‡∞µ‡∞Ç, ‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞§ ‡∞∏‡±ç‡∞µ‡∞Ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞ï‡∞Ç‡∞ó‡∞æ ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.',
                voice_tap_mic: '‡∞Æ‡±à‡∞ï‡±ç ‡∞®‡±ä‡∞ï‡±ç‡∞ï‡∞ø ‡∞ò‡∞ü‡∞® ‡∞µ‡∞ø‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø',
                consciousness: '‡∞∏‡±ç‡∞™‡±É‡∞π',
                bleeding_label: '‡∞∞‡∞ï‡±ç‡∞§‡∞∏‡±ç‡∞∞‡∞æ‡∞µ‡∞Ç',
                severity: '‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞§',
                condition: '‡∞™‡∞∞‡∞ø‡∞∏‡±ç‡∞•‡∞ø‡∞§‡∞ø',
                apply_autofill: '‡∞®‡∞Æ‡±ã‡∞¶‡±Å & ‡∞´‡∞æ‡∞∞‡∞Ç ‡∞™‡±Ç‡∞∞‡∞ø‡∞Ç‡∞ö‡±Å',
                or_fill_manually: '‡∞≤‡±á‡∞¶‡∞æ ‡∞Æ‡∞æ‡∞®‡∞µ‡±Ä‡∞Ø‡∞Ç‡∞ó‡∞æ ‡∞™‡±Ç‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø',
                scene_assessment: '‡∞∏‡±Ä‡∞®‡±ç ‡∞Ö‡∞∏‡±Ü‡∞∏‡±ç‚Äå‡∞Æ‡±Ü‡∞Ç‡∞ü‡±ç',
                avpu_label: 'AVPU ‡∞∏‡±ç‡∞ï‡±á‡∞≤‡±ç',
                bleeding_toggle: '‡∞Ø‡∞æ‡∞ï‡±ç‡∞ü‡∞ø‡∞µ‡±ç ‡∞¨‡±ç‡∞≤‡±Ä‡∞°‡∞ø‡∞Ç‡∞ó‡±ç?',
                injury_location: '‡∞ó‡∞æ‡∞Ø‡∞Ç ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç',
                mechanism_of_injury: '‡∞ó‡∞æ‡∞Ø ‡∞ï‡∞æ‡∞∞‡∞£‡∞Ç',
                clinical_assessment: '‡∞ï‡±ç‡∞≤‡∞ø‡∞®‡∞ø‡∞ï‡∞≤‡±ç ‡∞Ö‡∞∏‡±Ü‡∞∏‡±ç‚Äå‡∞Æ‡±Ü‡∞Ç‡∞ü‡±ç',
                severity_level: '‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞§ (1-5)',
                requires_icu: 'ICU ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Ç',
                specialty_required: '‡∞∏‡±ç‡∞™‡±Ü‡∞∑‡∞æ‡∞≤‡∞ø‡∞ü‡±Ä ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Ç',
                location: '‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç & ‡∞™‡∞∞‡∞ø‡∞Æ‡∞ø‡∞§‡±Å‡∞≤‡±Å',
                current_lat: '‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞Ö‡∞ï‡±ç‡∞∑‡∞æ‡∞Ç‡∞∂‡∞Ç',
                current_lng: '‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞∞‡±á‡∞ñ‡∞æ‡∞Ç‡∞∂‡∞Ç',
                max_distance: '‡∞ó‡∞∞‡∞ø‡∞∑‡±ç‡∞ü ‡∞¶‡±Ç‡∞∞‡∞Ç (‡∞ï‡∞ø.‡∞Æ‡±Ä.)',
                ai_scan_injury: 'AI ‡∞∏‡±ç‡∞ï‡∞æ‡∞®‡±ç ‡∞ó‡∞æ‡∞Ø‡∞Ç',
                find_best_hospitals: '‡∞â‡∞§‡±ç‡∞§‡∞Æ ‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡±Å‡∞≤‡±Å ‡∞ï‡∞®‡±Å‡∞ó‡±ä‡∞®‡∞Ç‡∞°‡∞ø',
                select_dest_hospital: '‡∞ó‡∞Æ‡±ç‡∞Ø‡∞Ç ‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø',
                rank: '‡∞∞‡±ç‡∞Ø‡∞æ‡∞Ç‡∞ï‡±ç',
                hospital: '‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡∞ø',
                distance_eta: '‡∞¶‡±Ç‡∞∞‡∞Ç / ETA',
                score: '‡∞∏‡±ç‡∞ï‡±ã‡∞∞‡±ç',
                action: '‡∞ö‡∞∞‡±ç‡∞Ø',
                cancel_case: '‡∞ï‡±á‡∞∏‡±Å ‡∞∞‡∞¶‡±ç‡∞¶‡±Å',
                hospital_selected: '‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡∞ø ‡∞é‡∞Ç‡∞™‡∞ø‡∞ï',
                dest_confirmed: '‡∞ó‡∞Æ‡±ç‡∞Ø‡∞Ç ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø',
                target: '‡∞≤‡∞ï‡±ç‡∞∑‡±ç‡∞Ø‡∞Ç',
                start_route: '‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞Ç ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡±Å',
                en_route_to_hospital: '‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡∞ø‡∞ï‡∞ø ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞Ç‡∞≤‡±ã',
                patient_manifest: '‡∞∞‡±ã‡∞ó‡∞ø ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤ ‡∞™‡∞ü‡±ç‡∞ü‡∞ø‡∞ï',
                mark_arrived: '‡∞ö‡±á‡∞∞‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞ü‡±ç‡∞≤‡±Å ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞ö‡±Å',
                arrived_at_hospital: '‡∞Ü‡∞∏‡±Å‡∞™‡∞§‡±ç‡∞∞‡∞ø ‡∞ö‡±á‡∞∞‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å',
                patient_admitted: '‡∞∞‡±ã‡∞ó‡∞ø ‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞ü‡±ç',
                mission_complete: '‡∞Æ‡∞ø‡∞∑‡∞®‡±ç ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞Ø‡∞ø‡∞Ç‡∞¶‡∞ø',
                patient_success: '‡∞∞‡±ã‡∞ó‡∞ø ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞ü‡±ç ‡∞Ö‡∞Ø‡±ç‡∞Ø‡∞æ‡∞∞‡±Å.',
                complete_return: '‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø & ‡∞ê‡∞°‡∞ø‡∞≤‡±ç ‡∞ï‡∞ø ‡∞§‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø',
                emergency_breakdown_protocol: '‡∞é‡∞Æ‡∞∞‡±ç‡∞ú‡±Ü‡∞®‡±ç‡∞∏‡±Ä ‡∞¨‡±ç‡∞∞‡±á‡∞ï‡±ç‚Äå‡∞°‡±å‡∞®‡±ç ‡∞™‡±ç‡∞∞‡±ã‡∞ü‡±ã‡∞ï‡∞æ‡∞≤‡±ç',
                report_breakdown: '‡∞¨‡±ç‡∞∞‡±á‡∞ï‡±ç‚Äå‡∞°‡±å‡∞®‡±ç ‡∞∞‡∞ø‡∞™‡±ã‡∞∞‡±ç‡∞ü‡±ç',
            },

            hi: {
                header_title: '‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏ ‡§°‡§ø‡§∏‡•ç‡§™‡•à‡§ö ¬∑ ‡§á‡§Æ‡§∞‡§ú‡•á‡§Ç‡§∏‡•Ä ‡§´‡•á‡§≤‡§ì‡§µ‡§∞',
                failover_enabled: '‡§´‡•á‡§≤‡§ì‡§µ‡§∞ ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø',
                local_time: '‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§∏‡§Æ‡§Ø',
                ambulance_login: '‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏ ‡§≤‡•â‡§ó‡§ø‡§®',
                enter_credentials: '‡§°‡§ø‡§∏‡•ç‡§™‡•à‡§ö ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                username: '‡§Ø‡•Ç‡§ú‡§º‡§∞‡§®‡•á‡§Æ',
                password: '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°',
                login: '‡§≤‡•â‡§ó‡§ø‡§®',
                register_new_amb: '‡§®‡§à ‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç',
                register_ambulance: '‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞',
                reg_number: '‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§®‡§Ç‡§¨‡§∞',
                organization: '‡§∏‡§Ç‡§ó‡§†‡§®',
                gps_coordinates: 'GPS ‡§ï‡•ã‡§ë‡§∞‡•ç‡§°‡§ø‡§®‡•á‡§ü‡•ç‡§∏',
                register_and_login: '‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§î‡§∞ ‡§≤‡•â‡§ó‡§ø‡§®',
                reset: '‡§∞‡•Ä‡§∏‡•á‡§ü',
                logout: '‡§≤‡•â‡§ó‡§Ü‡§â‡§ü',
                start_new_case: '‡§®‡§Ø‡§æ ‡§ï‡•á‡§∏ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
                voice_reporter: 'üéôÔ∏è ‡§µ‡•â‡§á‡§∏ ‡§ò‡§ü‡§®‡§æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡§∞',
                voice_desc: '‡§Æ‡§æ‡§á‡§ï ‡§¶‡§¨‡§æ‡§è‡§Å ‡§î‡§∞ ‡§ò‡§ü‡§®‡§æ ‡§¨‡§§‡§æ‡§è‡§Å‡•§ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ö‡•á‡§§‡§®‡§æ, ‡§∞‡§ï‡•ç‡§§‡§∏‡•ç‡§∞‡§æ‡§µ, ‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§™‡§π‡§ö‡§æ‡§® ‡§≤‡•á‡§ó‡§æ‡•§',
                voice_tap_mic: '‡§Æ‡§æ‡§á‡§ï ‡§¶‡§¨‡§æ‡§è‡§Å ‡§î‡§∞ ‡§ò‡§ü‡§®‡§æ ‡§¨‡§§‡§æ‡§è‡§Å',
                consciousness: '‡§ö‡•á‡§§‡§®‡§æ',
                bleeding_label: '‡§∞‡§ï‡•ç‡§§‡§∏‡•ç‡§∞‡§æ‡§µ',
                severity: '‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ',
                condition: '‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                apply_autofill: '‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§´‡§º‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡•á‡§Ç',
                or_fill_manually: '‡§Ø‡§æ ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤‡•Ä ‡§≠‡§∞‡•á‡§Ç',
                scene_assessment: '‡§∏‡•Ä‡§® ‡§Ö‡§∏‡•á‡§∏‡§Æ‡•á‡§Ç‡§ü',
                avpu_label: 'AVPU ‡§∏‡•ç‡§ï‡•á‡§≤',
                bleeding_toggle: '‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§∞‡§ï‡•ç‡§§‡§∏‡•ç‡§∞‡§æ‡§µ?',
                injury_location: '‡§ö‡•ã‡§ü ‡§ï‡§æ ‡§∏‡•ç‡§•‡§æ‡§®',
                mechanism_of_injury: '‡§ö‡•ã‡§ü ‡§ï‡§æ ‡§ï‡§æ‡§∞‡§£',
                clinical_assessment: '‡§ï‡•ç‡§≤‡§ø‡§®‡§ø‡§ï‡§≤ ‡§Ö‡§∏‡•á‡§∏‡§Æ‡•á‡§Ç‡§ü',
                severity_level: '‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ (1-5)',
                requires_icu: 'ICU ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï',
                specialty_required: '‡§∏‡•ç‡§™‡•á‡§∂‡§≤‡§ø‡§ü‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï',
                location: '‡§∏‡•ç‡§•‡§æ‡§® ‡§î‡§∞ ‡§∏‡•Ä‡§Æ‡§æ‡§è‡§Ç',
                current_lat: '‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Ö‡§ï‡•ç‡§∑‡§æ‡§Ç‡§∂',
                current_lng: '‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§¶‡•á‡§∂‡§æ‡§Ç‡§§‡§∞',
                max_distance: '‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§¶‡•Ç‡§∞‡•Ä (‡§ï‡§ø.‡§Æ‡•Ä.)',
                ai_scan_injury: 'AI ‡§∏‡•ç‡§ï‡•à‡§® ‡§ö‡•ã‡§ü',
                find_best_hospitals: '‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡•á ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§ñ‡•ã‡§ú‡•á‡§Ç',
                select_dest_hospital: '‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç',
                rank: '‡§∞‡•à‡§Ç‡§ï',
                hospital: '‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤',
                distance_eta: '‡§¶‡•Ç‡§∞‡•Ä / ETA',
                score: '‡§∏‡•ç‡§ï‡•ã‡§∞',
                action: '‡§ï‡§æ‡§∞‡•ç‡§Ø',
                cancel_case: '‡§ï‡•á‡§∏ ‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
                hospital_selected: '‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§ö‡§Ø‡§®‡§ø‡§§',
                dest_confirmed: '‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø ‡§™‡•Å‡§∑‡•ç‡§ü',
                target: '‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø',
                start_route: '‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
                en_route_to_hospital: '‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§ï‡•Ä ‡§ì‡§∞ ‡§∞‡§æ‡§∏‡•ç‡§§‡•á ‡§Æ‡•á‡§Ç',
                patient_manifest: '‡§Æ‡§∞‡•Ä‡§ú‡§º ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§™‡§§‡•ç‡§∞',
                mark_arrived: '‡§™‡§π‡•Å‡§Å‡§ö‡§æ ‡§π‡•Å‡§Ü ‡§ö‡§ø‡§π‡•ç‡§®‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
                arrived_at_hospital: '‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§™‡§π‡•Å‡§Å‡§ö ‡§ó‡§è',
                patient_admitted: '‡§Æ‡§∞‡•Ä‡§ú‡§º ‡§≠‡§∞‡•ç‡§§‡•Ä',
                mission_complete: '‡§Æ‡§ø‡§∂‡§® ‡§™‡•Ç‡§∞‡•ç‡§£',
                patient_success: '‡§Æ‡§∞‡•Ä‡§ú‡§º ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§≠‡§∞‡•ç‡§§‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ‡•§',
                complete_return: '‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ü‡§á‡§°‡§≤ ‡§≤‡•å‡§ü‡•á‡§Ç',
                emergency_breakdown_protocol: '‡§á‡§Æ‡§∞‡§ú‡•á‡§Ç‡§∏‡•Ä ‡§¨‡•ç‡§∞‡•á‡§ï‡§°‡§æ‡§â‡§® ‡§™‡•ç‡§∞‡•ã‡§ü‡•ã‡§ï‡•â‡§≤',
                report_breakdown: '‡§¨‡•ç‡§∞‡•á‡§ï‡§°‡§æ‡§â‡§® ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü',
            },

            ur: {
                header_title: 'ÿß€åŸÖÿ®ŸàŸÑ€åŸÜÿ≥ ⁄àÿ≥Ÿæ€å⁄Ü ¬∑ ÿß€åŸÖÿ±ÿ¨ŸÜÿ≥€å ŸÅ€åŸÑ ÿßŸàŸàÿ±',
                failover_enabled: 'ŸÅ€åŸÑ ÿßŸàŸàÿ± ŸÅÿπÿßŸÑ',
                local_time: 'ŸÖŸÇÿßŸÖ€å ŸàŸÇÿ™',
                ambulance_login: 'ÿß€åŸÖÿ®ŸàŸÑ€åŸÜÿ≥ ŸÑÿß⁄Ø ÿßŸÜ',
                enter_credentials: '⁄àÿ≥Ÿæ€å⁄Ü ÿ™⁄© ÿ±ÿ≥ÿßÿ¶€å ⁄©€í ŸÑ€å€í ÿ™ŸÅÿµ€åŸÑÿßÿ™ ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫',
                username: 'ÿµÿßÿ±ŸÅ ŸÜÿßŸÖ',
                password: 'Ÿæÿßÿ≥ Ÿàÿ±⁄à',
                login: 'ŸÑÿß⁄Ø ÿßŸÜ',
                register_new_amb: 'ŸÜÿ¶€å ÿß€åŸÖÿ®ŸàŸÑ€åŸÜÿ≥ ÿ±ÿ¨ÿ≥Ÿπÿ± ⁄©ÿ±€å⁄∫',
                register_ambulance: 'ÿß€åŸÖÿ®ŸàŸÑ€åŸÜÿ≥ ÿ±ÿ¨ÿ≥Ÿπÿ±',
                reg_number: 'ÿ±ÿ¨ÿ≥Ÿπÿ±€åÿ¥ŸÜ ŸÜŸÖÿ®ÿ±',
                organization: 'ÿ™ŸÜÿ∏€åŸÖ',
                gps_coordinates: 'GPS ⁄©Ÿàÿ¢ÿ±⁄à€åŸÜ€åŸπÿ≥',
                register_and_login: 'ÿ±ÿ¨ÿ≥Ÿπÿ± ÿßŸàÿ± ŸÑÿß⁄Ø ÿßŸÜ',
                reset: 'ÿ±€å ÿ≥€åŸπ',
                logout: 'ŸÑÿß⁄Ø ÿ¢ÿ§Ÿπ',
                start_new_case: 'ŸÜ€åÿß ⁄©€åÿ≥ ÿ¥ÿ±Ÿàÿπ ⁄©ÿ±€å⁄∫',
                voice_reporter: 'üéôÔ∏è Ÿàÿßÿ¶ÿ≥ ŸàÿßŸÇÿπ€Å ÿ±ŸæŸàÿ±Ÿπÿ±',
                voice_desc: 'ŸÖÿßÿ¶€å⁄© ÿØÿ®ÿßÿ¶€å⁄∫ ÿßŸàÿ± ŸàÿßŸÇÿπ€í ⁄©€å ÿ™ŸÅÿµ€åŸÑ ÿ®ÿ™ÿßÿ¶€å⁄∫€î ŸÜÿ∏ÿßŸÖ ÿ¥ÿπŸàÿ±ÿå ÿÆŸàŸÜ ÿ®€ÅŸÜÿßÿå ÿ¥ÿØÿ™ ÿÆŸàÿØ ÿ®ÿÆŸàÿØ ÿ¥ŸÜÿßÿÆÿ™ ⁄©ÿ±€í ⁄Øÿß€î',
                voice_tap_mic: 'ŸÖÿßÿ¶€å⁄© ÿØÿ®ÿßÿ¶€å⁄∫ ÿßŸàÿ± ŸàÿßŸÇÿπ€Å ÿ®€åÿßŸÜ ⁄©ÿ±€å⁄∫',
                consciousness: 'ÿ¥ÿπŸàÿ±',
                bleeding_label: 'ÿÆŸàŸÜ ÿ®€ÅŸÜÿß',
                severity: 'ÿ¥ÿØÿ™',
                condition: 'ÿ≠ÿßŸÑÿ™',
                apply_autofill: 'ŸÑÿß⁄ØŸà ⁄©ÿ±€å⁄∫ ÿßŸàÿ± ŸÅÿßÿ±ŸÖ ÿ®⁄æÿ±€å⁄∫',
                or_fill_manually: '€åÿß ÿÆŸàÿØ ÿ®⁄æÿ±€å⁄∫',
                scene_assessment: 'ÿ≥€åŸÜ ÿßÿ≥€åÿ≥ŸÖŸÜŸπ',
                avpu_label: 'AVPU ÿßÿ≥⁄©€åŸÑ',
                bleeding_toggle: 'ŸÅÿπÿßŸÑ ÿÆŸàŸÜ ÿ®€ÅŸÜÿßÿü',
                injury_location: '⁄ÜŸàŸπ ⁄©ÿß ŸÖŸÇÿßŸÖ',
                mechanism_of_injury: '⁄ÜŸàŸπ ⁄©€å Ÿàÿ¨€Å',
                clinical_assessment: '⁄©ŸÑ€åŸÜ€å⁄©ŸÑ ÿßÿ≥€åÿ≥ŸÖŸÜŸπ',
                severity_level: 'ÿ¥ÿØÿ™ (1-5)',
                requires_icu: 'ICU ÿ∂ÿ±Ÿàÿ±€å',
                specialty_required: 'ÿßÿ≥Ÿæ€åÿ¥ŸÑŸπ€å ÿ∂ÿ±Ÿàÿ±€å',
                location: 'ŸÖŸÇÿßŸÖ ÿßŸàÿ± ÿ≠ÿØŸàÿØ',
                current_lat: 'ŸÖŸàÿ¨ŸàÿØ€Å ÿπÿ±ÿ∂ ÿ®ŸÑÿØ',
                current_lng: 'ŸÖŸàÿ¨ŸàÿØ€Å ÿ∑ŸàŸÑ ÿ®ŸÑÿØ',
                max_distance: 'ÿ≤€åÿßÿØ€Å ÿ≥€í ÿ≤€åÿßÿØ€Å ŸÅÿßÿµŸÑ€Å (⁄©ŸÑŸàŸÖ€åŸπÿ±)',
                ai_scan_injury: 'AI ÿßÿ≥⁄©€åŸÜ ⁄ÜŸàŸπ',
                find_best_hospitals: 'ÿ®€Åÿ™ÿ±€åŸÜ €Åÿ≥Ÿæÿ™ÿßŸÑ ÿ™ŸÑÿßÿ¥ ⁄©ÿ±€å⁄∫',
                select_dest_hospital: 'ŸÖŸÜÿ≤ŸÑ €Åÿ≥Ÿæÿ™ÿßŸÑ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫',
                rank: 'ÿØÿ±ÿ¨€Å',
                hospital: '€Åÿ≥Ÿæÿ™ÿßŸÑ',
                distance_eta: 'ŸÅÿßÿµŸÑ€Å / ETA',
                score: 'ÿ≥⁄©Ÿàÿ±',
                action: '⁄©ÿßÿ±ÿ±Ÿàÿßÿ¶€å',
                cancel_case: '⁄©€åÿ≥ ŸÖŸÜÿ≥ŸàÿÆ ⁄©ÿ±€å⁄∫',
                hospital_selected: '€Åÿ≥Ÿæÿ™ÿßŸÑ ŸÖŸÜÿ™ÿÆÿ®',
                dest_confirmed: 'ŸÖŸÜÿ≤ŸÑ ⁄©€å ÿ™ÿµÿØ€åŸÇ',
                target: '€ÅÿØŸÅ',
                start_route: 'ÿ±ÿßÿ≥ÿ™€Å ÿ¥ÿ±Ÿàÿπ ⁄©ÿ±€å⁄∫',
                en_route_to_hospital: '€Åÿ≥Ÿæÿ™ÿßŸÑ ⁄©€å ÿ∑ÿ±ŸÅ ÿ±ÿßÿ≥ÿ™€í ŸÖ€å⁄∫',
                patient_manifest: 'ŸÖÿ±€åÿ∂ ⁄©€å ÿ™ŸÅÿµ€åŸÑÿßÿ™',
                mark_arrived: 'Ÿæ€ÅŸÜ⁄ÜŸÜ€í ⁄©€å ÿ™ÿµÿØ€åŸÇ',
                arrived_at_hospital: '€Åÿ≥Ÿæÿ™ÿßŸÑ Ÿæ€ÅŸÜ⁄Ü ⁄Øÿ¶€í',
                patient_admitted: 'ŸÖÿ±€åÿ∂ ÿØÿßÿÆŸÑ',
                mission_complete: 'ŸÖÿ¥ŸÜ ŸÖ⁄©ŸÖŸÑ',
                patient_success: 'ŸÖÿ±€åÿ∂ ⁄©ÿßŸÖ€åÿßÿ®€å ÿ≥€í ÿØÿßÿÆŸÑ €ÅŸà ⁄Ø€åÿß€î',
                complete_return: 'ŸÖ⁄©ŸÖŸÑ ⁄©ÿ±€å⁄∫ ÿßŸàÿ± ÿ¢ÿ¶€å⁄àŸÑ ŸàÿßŸæÿ≥',
                emergency_breakdown_protocol: 'ÿß€åŸÖÿ±ÿ¨ŸÜÿ≥€å ÿ®ÿ±€å⁄© ⁄àÿßÿ§ŸÜ Ÿæÿ±ŸàŸπŸà⁄©ŸàŸÑ',
                report_breakdown: 'ÿ®ÿ±€å⁄© ⁄àÿßÿ§ŸÜ ÿ±ŸæŸàÿ±Ÿπ',
            }
        };

        let currentLang = localStorage.getItem('amb_lang') || 'en';

        function toggleLangDropdown() {
            const dd = document.getElementById('langDropdown');
            dd.classList.toggle('open');
            setTimeout(() => {
                function close(e) {
                    if (!document.getElementById('langSwitcher').contains(e.target)) {
                        dd.classList.remove('open');
                        document.removeEventListener('click', close);
                    }
                }
                document.addEventListener('click', close);
            }, 10);
        }

        function switchLang(lang) {
            // Store originals before first translation
            if (_origTextCache.size === 0) {
                storeOriginalText(document.body);
            }

            currentLang = lang;
            localStorage.setItem('amb_lang', lang);

            // Update dropdown active state
            document.querySelectorAll('.lang-opt').forEach(opt => {
                opt.classList.toggle('active', opt.getAttribute('onclick')?.includes(`'${lang}'`));
            });

            // Update button label
            const labels = { en: 'EN', te: '‡∞§‡±Ü', hi: '‡§π‡§ø', ur: 'ÿßÿ±' };
            document.getElementById('currentLangLabel').textContent = labels[lang] || lang.toUpperCase();

            // RTL for Urdu
            document.documentElement.dir = lang === 'ur' ? 'rtl' : 'ltr';

            // Apply translations
            applyTranslations();

            // Close dropdown
            document.getElementById('langDropdown').classList.remove('open');
        }

        function applyTranslations() {
            const dict = I18N[currentLang] || I18N.en;
            // 1. Translate data-i18n keyed elements (legacy support)
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (dict[key]) el.textContent = dict[key];
            });

            if (currentLang === 'en') {
                // Restore English: reload the page state (simplest approach for EN)
                // We only need to re-apply data-i18n which is done above
                // For full EN restoration, we store original text on first run
                restoreOriginalText();
                return;
            }

            // 2. Full DOM text node translation using FULL_TEXT_MAP
            const textMap = FULL_TEXT_MAP[currentLang];
            if (!textMap) return;

            translateTextNodes(document.body, textMap);

            // 3. Translate placeholders
            const phMap = PLACEHOLDER_MAP[currentLang];
            if (phMap) {
                document.querySelectorAll('[placeholder]').forEach(el => {
                    const orig = el.getAttribute('data-orig-placeholder') || el.getAttribute('placeholder');
                    if (!el.getAttribute('data-orig-placeholder')) {
                        el.setAttribute('data-orig-placeholder', orig);
                    }
                    if (phMap[orig]) el.setAttribute('placeholder', phMap[orig]);
                });
            }

            // 4. Translate table headers (they may be dynamically created)
            translateTableHeaders(textMap);
        }

        // Store originals on first load
        const _origTextCache = new Map();

        function storeOriginalText(node) {
            if (node.nodeType === Node.TEXT_NODE) {
                const trimmed = node.textContent.trim();
                if (trimmed && !_origTextCache.has(node)) {
                    _origTextCache.set(node, node.textContent);
                }
            } else if (node.nodeType === Node.ELEMENT_NODE) {
                // Skip script/style/input
                const tag = node.tagName;
                if (tag === 'SCRIPT' || tag === 'STYLE' || tag === 'INPUT' || tag === 'TEXTAREA') return;
                node.childNodes.forEach(child => storeOriginalText(child));
            }
        }

        function translateTextNodes(rootEl, textMap) {
            const walker = document.createTreeWalker(rootEl, NodeFilter.SHOW_TEXT, {
                acceptNode(node) {
                    const parent = node.parentElement;
                    if (!parent) return NodeFilter.FILTER_REJECT;
                    const tag = parent.tagName;
                    if (tag === 'SCRIPT' || tag === 'STYLE') return NodeFilter.FILTER_REJECT;
                    return NodeFilter.FILTER_ACCEPT;
                }
            });

            const toUpdate = [];
            while (walker.nextNode()) {
                const node = walker.currentNode;
                const trimmed = node.textContent.trim();
                if (!trimmed) continue;
                // Store original if not stored
                if (!_origTextCache.has(node)) {
                    _origTextCache.set(node, node.textContent);
                }
                if (textMap[trimmed]) {
                    toUpdate.push([node, textMap[trimmed]]);
                }
            }
            toUpdate.forEach(([node, translated]) => {
                // Preserve leading/trailing whitespace
                const orig = node.textContent;
                const leading = orig.match(/^\s*/)[0];
                const trailing = orig.match(/\s*$/)[0];
                node.textContent = leading + translated + trailing;
            });
        }

        function restoreOriginalText() {
            _origTextCache.forEach((origText, node) => {
                if (node.parentElement) {
                    node.textContent = origText;
                }
            });
            // Restore placeholders
            document.querySelectorAll('[data-orig-placeholder]').forEach(el => {
                el.setAttribute('placeholder', el.getAttribute('data-orig-placeholder'));
            });
        }

        function translateTableHeaders(textMap) {
            document.querySelectorAll('#resultsTable th').forEach(th => {
                const orig = th.getAttribute('data-orig-text') || th.textContent.trim();
                if (!th.getAttribute('data-orig-text')) th.setAttribute('data-orig-text', orig);
                if (textMap[orig]) th.textContent = textMap[orig];
                else if (currentLang === 'en') th.textContent = orig;
            });
        }

        // Store all original text nodes before any translation (run once at load)
        document.addEventListener('DOMContentLoaded', () => {
            storeOriginalText(document.body);
        }, { once: true });

        // Apply saved language on load
        if (currentLang !== 'en') {
            switchLang(currentLang);
        }
    </script>

</body>

</html>